#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

////////////////////////////////////////////////////////////////////////////////
// ПРОГРАММНЫЙ ИНТЕРФЕЙС

Процедура СформироватьОтчет(Знач ПараметрыОтчета, АдресХранилища) Экспорт
	
	Результат = Новый ТабличныйДокумент;
	
	СформироватьОтчетПроверки(Результат, ПараметрыОтчета);
	
	ПоместитьВоВременноеХранилище(Новый Структура("Результат", Результат), АдресХранилища);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ


////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

Процедура СформироватьОтчетПроверки(ТабличныйДокумент, ПараметрыОтчета)
	
	ЗначениеТаймера = ОценкаПроизводительности.НачатьЗамерВремени();
	
	ВремТабДокумент   = Новый ТабличныйДокумент;
	ВидимостьОбластей = Новый Структура;
	
	КолВыполняемыхПроверок = 0;
	КолВыполненныхПроверок = 0;
	КолПроверокСОшибками   = 0;
	
	ВысотаОбластей = ПараметрыОтчета.ВысотаОбластей;
	Макет   = Обработки.ЭкспрессПроверкаВеденияУчета.ПолучитьМакет("МакетОтчета");
	ВысотаОбластей.Вставить("Шапка", 			  	   Макет.ПолучитьОбласть("Шапка").ВысотаТаблицы);
	ВысотаОбластей.Вставить("Заголовок", 			   Макет.ПолучитьОбласть("Заголовок").ВысотаТаблицы);
	ВысотаОбластей.Вставить("РазделУчета", 			   Макет.ПолучитьОбласть("РазделУчета").ВысотаТаблицы);
	ВысотаОбластей.Вставить("Проверка", 			   Макет.ПолучитьОбласть("Проверка").ВысотаТаблицы);
	ВысотаОбластей.Вставить("ПредметКонтроля", 		   Макет.ПолучитьОбласть("ПредметКонтроля").ВысотаТаблицы);
	ВысотаОбластей.Вставить("КомментарийРезультата",   Макет.ПолучитьОбласть("КомментарийРезультата").ВысотаТаблицы);
	ВысотаОбластей.Вставить("ПричиныОшибок", 		   Макет.ПолучитьОбласть("ПричиныОшибок").ВысотаТаблицы);
	ВысотаОбластей.Вставить("Рекомендации", 		   Макет.ПолучитьОбласть("Рекомендации").ВысотаТаблицы);
	ВысотаОбластей.Вставить("ПодвалПроверки",	 	   Макет.ПолучитьОбласть("ПодвалПроверки").ВысотаТаблицы);
	ВысотаОбластей.Вставить("РазделительРазделаУчета", Макет.ПолучитьОбласть("РазделительРазделаУчета").ВысотаТаблицы);
	
	ЦветФонаОшибок       = Новый Цвет(253, 236, 229); // светло-розовый
	ЦветТекстаОшибок     = Новый Цвет(83, 23, 22);    // темно-коричневый
	ЦветФонаКолОшибок    = Новый Цвет(240, 54, 0);    // красный
	ЦветТекстаКолОшибок  = Новый Цвет(255, 240, 96);  // ярко-желтый
	ЦветФонаБезОшибок    = Новый Цвет(249, 255, 236); // светло-зеленый

	ДеревоПроверок = ПараметрыОтчета.ДеревоПроверок;
	
	// Общее количество выполняемых проверок показываем в заголовке отчета и в строке состояния
	МассивВыполняемыхСтрокДерева = ДеревоПроверок.Строки.НайтиСтроки(Новый Структура("Включить", 1), Истина);
	Для каждого СтрокаДерева Из МассивВыполняемыхСтрокДерева Цикл
		Если НЕ СтрокаДерева.ЭтоГруппа Тогда
			КолВыполняемыхПроверок = КолВыполняемыхПроверок + 1;
		КонецЕсли;
	КонецЦикла;
		
	Если ПараметрыОтчета.ВыполнятьПроверки Тогда
		
		КонецДатаКон = КонецДня(ПараметрыОтчета.ДатаКон);
		
		// Очищаем результаты прошлых вычислений, которые делали проверки, чтобы они не влияли на текущий цикл
		ПараметрыОтчета.ИсходящиеДанные = Новый Структура;
		
	КонецЕсли;
	
	Макет = Обработки.ЭкспрессПроверкаВеденияУчета.ПолучитьМакет("МакетОтчета");
	
	// Общая ширина колонок для вывода детальных отчетов
	ОбщаяШиринаКолонокОтчета = 0;
	НомПервойКолонкиДетальногоОтчета = 6;
	Для НомКолонки = НомПервойКолонкиДетальногоОтчета По Макет.ШиринаТаблицы Цикл
		ОбщаяШиринаКолонокОтчета = ОбщаяШиринаКолонокОтчета + Макет.Область( , НомКолонки, , НомКолонки).ШиринаКолонки;
	КонецЦикла;
	
	ОбластьШапкиМакета              = Макет.ПолучитьОбласть("Шапка");
	ОбластьЗаголовкаМакета          = Макет.ПолучитьОбласть("Заголовок");
	ОбластьРазделаУчетаМакета       = Макет.ПолучитьОбласть("РазделУчета");
	ОбластьПроверкиМакета           = Макет.ПолучитьОбласть("Проверка");
	ОбластьПредметаКонтроляМакета   = Макет.ПолучитьОбласть("ПредметКонтроля");
	ОбластьКомментарияМакета        = Макет.ПолучитьОбласть("КомментарийРезультата");
	ОбластьПричинОшибокМакета       = Макет.ПолучитьОбласть("ПричиныОшибок");
	ОбластьРекомендацийМакета       = Макет.ПолучитьОбласть("Рекомендации");
	ОбластьПодвалаПроверкиМакета    = Макет.ПолучитьОбласть("ПодвалПроверки");
	ОбластьРазделителяРазделаМакета = Макет.ПолучитьОбласть("РазделительРазделаУчета");
	
	// Выводим шапку и заголовок отчета
	НазваниеОрганизации = ПараметрыОтчета.Организация.НаименованиеПолное;
	Если ПустаяСтрока(НазваниеОрганизации) Тогда
		НазваниеОрганизации = ПараметрыОтчета.Организация.Наименование;
	КонецЕсли;
	ОбластьШапкиМакета.Параметры.НазваниеОрганизации = НазваниеОрганизации;
	ОбластьШапкиМакета.Параметры.ПериодПроверки      = ПараметрыОтчета.ПериодПроверкиСтрокой;
	ТабличныйДокумент.Вывести(ОбластьШапкиМакета);
	
	// Шапку скрываем
	ОбластьШапки = ТабличныйДокумент.Область(1, , ТабличныйДокумент.ВысотаТаблицы, );
	ОбластьШапки.Видимость = Ложь;
	
	ТабличныйДокумент.Вывести(ОбластьЗаголовкаМакета);
	
	ОбластьНадписиОПроверках 	  = ТабличныйДокумент.Область(ТабличныйДокумент.ВысотаТаблицы - 1, 2, ТабличныйДокумент.ВысотаТаблицы - 1, 2);
	ОбластьНадписиОбОшибках  	  = ТабличныйДокумент.Область(ТабличныйДокумент.ВысотаТаблицы, 2, ТабличныйДокумент.ВысотаТаблицы, 2);
	ОбластьСтрокиНадписиОбОшибках = ТабличныйДокумент.Область(ТабличныйДокумент.ВысотаТаблицы, 2, ТабличныйДокумент.ВысотаТаблицы, ТабличныйДокумент.ШиринаТаблицы);
	
	ОбластьНадписиОПроверках.Текст = "Проведено проверок: 0 из " + КолВыполняемыхПроверок;
	ОбластьСтрокиНадписиОбОшибках.ЦветФона = ЦветФонаБезОшибок;
	
	// При открытии формы в отчете показываются только 2 верхние строки с количеством проверок
	Если НЕ ПараметрыОтчета.ВыполнятьПроверки Тогда
		Возврат;
	КонецЕсли;
	
	РезультатПроверки = ?(ПараметрыОтчета.ВыполнятьПроверки, "Выполняется проверка...", "Проверка не выполнялась");
	
	НомерТекПроверки = 0;
	
	Для каждого СтрокаРаздела Из ДеревоПроверок.Строки Цикл
		
		//Полностью отключенные разделы пропускаем
		Если СтрокаРаздела.Включить = 0 Тогда
			Продолжить;
		КонецЕсли;
		
		ЗначениеТаймераСтрокаРаздела = ОценкаПроизводительности.НачатьЗамерВремени();
		
		// Отделяем наименование раздела от проверок предыдущих разделов
		ТабличныйДокумент.Вывести(ОбластьРазделителяРазделаМакета, 1);
		
		ЗаполнитьЗначенияСвойств(ОбластьРазделаУчетаМакета.Параметры, СтрокаРаздела);
		ОбластьРазделаУчетаМакета.Параметры.РезультатПроверки = РезультатПроверки;
		ТабличныйДокумент.Вывести(ОбластьРазделаУчетаМакета, 1);
		
		//Задаем области раздела документа-результата имя - идентификатор раздела
		ОбластьРазделаУчета = ТабличныйДокумент.Область(ТабличныйДокумент.ВысотаТаблицы - ВысотаОбластей.РазделУчета + 1, , ТабличныйДокумент.ВысотаТаблицы, );
		ОбластьРазделаУчета.Имя = СтрокаРаздела.Идентификатор;
		Если ПараметрыОтчета.ВыполнятьПроверки Тогда
			// Выделяем выполняющийся раздел курсивом
			Курсив = Истина;
			ОбластьРазделаУчета.Шрифт = Новый Шрифт(ОбластьРазделаУчета.Шрифт, , , Курсив);
			
			ПроведеныПроверкиВРазделе = Ложь;
			КолОшибокВРазделе         = 0;
		КонецЕсли;
		
		РаскрыватьПроверкиРаздела = Ложь;
		ТабличныйДокумент.НачатьГруппуСтрок(, РаскрыватьПроверкиРаздела); // Заголовки проверок
		
		// Отделяем наименование раздела от проверок
		ТабличныйДокумент.Вывести(ОбластьРазделителяРазделаМакета, 2);
		
		Для каждого СтрокаПроверки Из СтрокаРаздела.Строки Цикл
			
			Если СтрокаПроверки.Включить = 0 Тогда
				Продолжить;
			КонецЕсли;
			
			ЗначениеТаймераСтрокаПроверки = ОценкаПроизводительности.НачатьЗамерВремени();
			
			НомерТекПроверки = НомерТекПроверки + 1;
			НомерПервойСтрокиПроверки = ТабличныйДокумент.ВысотаТаблицы + 1;
			// Выводим область заголовка проверки
			ЗаполнитьЗначенияСвойств(ОбластьПроверкиМакета.Параметры, СтрокаПроверки);
			ОбластьПроверкиМакета.Параметры.РезультатПроверки = РезультатПроверки;
			ТабличныйДокумент.Вывести(ОбластьПроверкиМакета, 2);
			ОбластьСостоянияПроверки = ТабличныйДокумент.Область(НомерПервойСтрокиПроверки, 11, НомерПервойСтрокиПроверки, 13);
			
			РаскрыватьДеталиПроверки = Ложь;
			ТабличныйДокумент.НачатьГруппуСтрок(, РаскрыватьДеталиПроверки); // Детали проверки
			
			НомерПервойСтрокиДеталейПроверки = ТабличныйДокумент.ВысотаТаблицы + 1;
			// Выводим область предмета контроля
			ЗаполнитьЗначенияСвойств(ОбластьПредметаКонтроляМакета.Параметры, СтрокаПроверки);
			ТабличныйДокумент.Вывести(ОбластьПредметаКонтроляМакета, 3);
			
			ОбластьПроверки        = ТабличныйДокумент.Область(НомерПервойСтрокиПроверки, , ТабличныйДокумент.ВысотаТаблицы, );
			ОбластьДеталейПроверки = ТабличныйДокумент.Область(НомерПервойСтрокиДеталейПроверки, , ТабличныйДокумент.ВысотаТаблицы, );
			
			Если ПараметрыОтчета.ВыполнятьПроверки Тогда
				
				ОбластьЗаголовкаПроверки = ТабличныйДокумент.Область(НомерПервойСтрокиПроверки, , НомерПервойСтрокиПроверки, );
				Курсив = Истина;
				ОбластьЗаголовкаПроверки.Шрифт = Новый Шрифт(ОбластьЗаголовкаПроверки.Шрифт, , , Курсив);
				
				Если РаскрыватьПроверкиРаздела Тогда
					ТабличныйДокумент.ТекущаяОбласть = ТабличныйДокумент.Область(ОбластьПроверки.Низ, 1, ОбластьПроверки.Низ, 1);
				КонецЕсли; 
				
				// Выполняем проверку правила
				ПроверитьПравило(СтрокаПроверки, ПараметрыОтчета); 
				ПроверкаВыполнена = СтрокаПроверки.ПроверкаВыполнена;
				ОбнаруженыОшибки  = СтрокаПроверки.ОбнаруженыОшибки;
				
				Если ОбнаруженыОшибки Тогда
					КолПроверокСОшибками = КолПроверокСОшибками + 1;
					КолОшибокВРазделе    = КолОшибокВРазделе + 1;
				КонецЕсли;
				Если ПроверкаВыполнена Тогда
					КолВыполненныхПроверок = КолВыполненныхПроверок + 1;
					ПроведеныПроверкиВРазделе = Истина;
				КонецЕсли;
				
				Курсив = Ложь;
				ОбластьЗаголовкаПроверки.Шрифт = Новый Шрифт(ОбластьЗаголовкаПроверки.Шрифт, , , Курсив);
				
				Если ПроверкаВыполнена И ОбнаруженыОшибки Тогда
					
					// Выделяем проверку с ошибками цветом фона
					ОбластьОшибки = ТабличныйДокумент.Область(ОбластьЗаголовкаПроверки.Верх, 2, 
									ОбластьЗаголовкаПроверки.Низ, ОбластьСостоянияПроверки.Лево - 1);
					ОбластьОшибки.ЦветФона   = ЦветФонаОшибок;
					ОбластьОшибки.ЦветТекста = ЦветТекстаОшибок;
					ОбластьСостоянияПроверки.Текст      = "Обнаружены ошибки";
					ОбластьСостоянияПроверки.ЦветФона   = ЦветФонаКолОшибок;
					ОбластьСостоянияПроверки.ЦветТекста = ЦветТекстаКолОшибок;
					
					// Добавляем комментарий результата
					ОбластьКомментарияМакета.Параметры.КомментарийРезультата = СтрокаПроверки.КомментарийРезультата;
					ТабличныйДокумент.Вывести(ОбластьКомментарияМакета);
					ОбластьКомментария = ТабличныйДокумент.Область(ТабличныйДокумент.ВысотаТаблицы - ВысотаОбластей.КомментарийРезультата + 1, 2, 
										 ТабличныйДокумент.ВысотаТаблицы, ТабличныйДокумент.ШиринаТаблицы);
					ОбластьКомментария.ЦветФона = ЦветФонаОшибок;
					
					// Добавляем возможные причины ошибок 
					ОбластьПричинОшибокМакета.Параметры.ПричиныОшибок = СтрокаПроверки.ПричиныОшибокРезультата;
					ТабличныйДокумент.Вывести(ОбластьПричинОшибокМакета);
					
					// Добавляем рекомендации по устранению ошибок
					ОбластьРекомендацийМакета.Параметры.Рекомендации = СтрокаПроверки.РекомендацииРезультата;
					ТабличныйДокумент.Вывести(ОбластьРекомендацийМакета);
					
					// Добавляем детальный отчет об ошибках
					ВремТабДокумент = Новый ТабличныйДокумент;
					СформироватьДетальныйОтчет(СтрокаПроверки, ВремТабДокумент, ПараметрыОтчета);
					
					Если ВремТабДокумент.ВысотаТаблицы > 0 Тогда
						
						ТабличныйДокумент.НачатьГруппуСтрок( , Ложь);
						
						ОбластьДетальногоОтчета      = ВремТабДокумент.Область(1, 1, 
													   ВремТабДокумент.ВысотаТаблицы, ВремТабДокумент.ШиринаТаблицы);
													   
													   
						ОбластьДетальногоОтчетаТаблица = ВремТабДокумент.Область(1, 2, 
												  		 ВремТабДокумент.ВысотаТаблицы, ВремТабДокумент.ШиринаТаблицы);
														 
						ОбластьДетальногоОтчетаТаблица.ГраницаСверху = Новый Линия(ТипЛинииЯчейкиТабличногоДокумента.Сплошная);
						ОбластьДетальногоОтчетаТаблица.ГраницаСнизу  = Новый Линия(ТипЛинииЯчейкиТабличногоДокумента.Сплошная);
						ОбластьДетальногоОтчетаТаблица.ГраницаСлева  = Новый Линия(ТипЛинииЯчейкиТабличногоДокумента.Сплошная);
						ОбластьДетальногоОтчетаТаблица.ГраницаСправа = Новый Линия(ТипЛинииЯчейкиТабличногоДокумента.Сплошная);
						
						НомПервойСтрокиНовогоФормата = ТабличныйДокумент.ВысотаТаблицы + 1;
						ОбластьНовогоФорматаСтрок    = ТабличныйДокумент.Область(НомПервойСтрокиНовогоФормата, , 
													   НомПервойСтрокиНовогоФормата + ВремТабДокумент.ВысотаТаблицы, );
						ОбластьНовогоФорматаСтрок.СоздатьФорматСтрок();
						ОбщаяШиринаКолонокДетальногоОтчета = 0;
						Для НомКолонки = 2 По ВремТабДокумент.ШиринаТаблицы Цикл
							ШиринаТекКолонки = ВремТабДокумент.Область(1, НомКолонки).ШиринаКолонки;
							ОбщаяШиринаКолонокДетальногоОтчета = ОбщаяШиринаКолонокДетальногоОтчета + ШиринаТекКолонки;
						КонецЦикла;
						
						КоэффИзмененияШирины = ?(ОбщаяШиринаКолонокДетальногоОтчета = 0, 1, ОбщаяШиринаКолонокОтчета / ОбщаяШиринаКолонокДетальногоОтчета);
						
						ИзменятьШиринуКолонок = КоэффИзмененияШирины <= 1.2;
						НоваяОбщаяШирина = 0;
						Для НомКолонки = 2 По ВремТабДокумент.ШиринаТаблицы - 1 Цикл
							ШиринаТекКолонки = ВремТабДокумент.Область(1, НомКолонки).ШиринаКолонки;
							Если ИзменятьШиринуКолонок Тогда
								НужнаяШирина = Окр(ШиринаТекКолонки * КоэффИзмененияШирины,0);
							Иначе
								НужнаяШирина = ШиринаТекКолонки;
							КонецЕсли;
							ТабличныйДокумент.Область(НомПервойСтрокиНовогоФормата, НомКолонки + 4).ШиринаКолонки = НужнаяШирина;
							НоваяОбщаяШирина = НоваяОбщаяШирина + НужнаяШирина;
						КонецЦикла;
						
						ПоследняяЯчейка = ТабличныйДокумент.Область(НомПервойСтрокиНовогоФормата, ВремТабДокумент.ШиринаТаблицы + 4);
						Если ИзменятьШиринуКолонок Тогда
							ПоследняяЯчейка.ШиринаКолонки = ОбщаяШиринаКолонокОтчета - НоваяОбщаяШирина;
						Иначе
							ШиринаПоследнейКолонки = ВремТабДокумент.Область(1, ВремТабДокумент.ШиринаТаблицы).ШиринаКолонки;
							ПоследняяЯчейка.ШиринаКолонки = ШиринаПоследнейКолонки;
						КонецЕсли;
						
						ОбластьЗаголовка = ТабличныйДокумент.Область(НомПервойСтрокиНовогоФормата, 6, НомПервойСтрокиНовогоФормата, 6);
						ОбластьЗаголовка.Текст = "Детальный отчет об ошибках";
						ОбластьЗаголовка.Шрифт = Новый Шрифт(ОбластьЗаголовка.Шрифт, , 8, Истина);
						
						ОбластьПриемник = ТабличныйДокумент.Область(НомПервойСтрокиНовогоФормата + 1, 5);
						
						ТабличныйДокумент.ВставитьОбласть(ОбластьДетальногоОтчета, ОбластьПриемник);
						
						ТабличныйДокумент.ЗакончитьГруппуСтрок();
					КонецЕсли;
					
				ИначеЕсли НЕ ПроверкаВыполнена Тогда
					
					ОбластьСостоянияПроверки.Текст      = НСтр("ru = 'Проверка не выполнена'");
					
					// Добавляем комментарий результата
					ОбластьКомментарияМакета.Параметры.КомментарийРезультата = СтрокаПроверки.КомментарийРезультата;
					ТабличныйДокумент.Вывести(ОбластьКомментарияМакета);
					
				Иначе // ПроверкаВыполнена И НЕ ОбнаруженыОшибки
					
					ОбластьСостоянияПроверки.Текст      = НСтр("ru = 'Ошибок не обнаружено'");
					
					// Добавляем комментарий результата
					ОбластьКомментарияМакета.Параметры.КомментарийРезультата = СтрокаПроверки.КомментарийРезультата;
					ТабличныйДокумент.Вывести(ОбластьКомментарияМакета);
					
				КонецЕсли;
				
				// Переопределяем область проверки и область деталей проверки - включаем добавленные строки
				ОбластьПроверки        = ТабличныйДокумент.Область(НомерПервойСтрокиПроверки, , ТабличныйДокумент.ВысотаТаблицы, );
				ОбластьДеталейПроверки = ТабличныйДокумент.Область(НомерПервойСтрокиДеталейПроверки, , ТабличныйДокумент.ВысотаТаблицы, );
				
			КонецЕсли;
			
			// Добавляем область - разделитель
			ТабличныйДокумент.Вывести(ОбластьПодвалаПроверкиМакета);
			
			ТабличныйДокумент.ЗакончитьГруппуСтрок(); // Строки деталей проверки
			
			ОбластьПроверки.Имя = СтрокаПроверки.Идентификатор;
			ОбластьДеталейПроверки.Имя = "Детали"+СтрокаПроверки.Идентификатор;
				
			Если ПараметрыОтчета.ВыполнятьПроверки Тогда
				Если РаскрыватьПроверкиРаздела Тогда
					ТабличныйДокумент.ТекущаяОбласть = ТабличныйДокумент.Область(ТабличныйДокумент.ВысотаТаблицы, 1, ТабличныйДокумент.ВысотаТаблицы, 1);
				КонецЕсли;
				
				ОбластьНадписиОПроверках.Текст = "Проведено проверок: " + КолВыполненныхПроверок +" из " + КолВыполняемыхПроверок;
				ОбластьНадписиОбОшибках.Текст = "Обнаружено ошибок: " + КолПроверокСОшибками;
				Если КолПроверокСОшибками > 0 Тогда
					ОбластьСтрокиНадписиОбОшибках.ЦветФона = ЦветФонаОшибок;
				Иначе
					ОбластьСтрокиНадписиОбОшибках.ЦветФона = ЦветФонаБезОшибок;
				КонецЕсли;
				
				НомерПоследнейСтрокиПроверки = ТабличныйДокумент.ВысотаТаблицы;
				ТабличныйДокумент.Область(НомерПервойСтрокиПроверки, ,НомерПоследнейСтрокиПроверки, ).Видимость = Ложь;
				
			КонецЕсли; 
			
			КлючеваяОперация = "Экспресс проверка ведения учета" + " - " + НРег(СтрокаРаздела.Наименование) + " - " + НРег(СтрокаПроверки.Наименование);
			ОценкаПроизводительности.ЗакончитьЗамерВремени(КлючеваяОперация, ЗначениеТаймераСтрокаПроверки);
			
		КонецЦикла;
		
		ТабличныйДокумент.ЗакончитьГруппуСтрок(); // Строки проверок раздела
		
		Если ПараметрыОтчета.ВыполнятьПроверки Тогда
			
			СтрокаРаздела.ОбнаруженыОшибки = КолОшибокВРазделе > 0;
			
			Курсив = Ложь;
			ОбластьРазделаУчета.Шрифт = Новый Шрифт(ОбластьРазделаУчета.Шрифт, , , Курсив);
			
			ОбластьСостоянияРаздела = ТабличныйДокумент.Область(ОбластьРазделаУчета.Верх, 11, ОбластьРазделаУчета.Верх, 13);
			Если СтрокаРаздела.ОбнаруженыОшибки Тогда
				// Выделяем раздел с ошибками цветом
				ОбластьОшибки = ТабличныйДокумент.Область(ОбластьРазделаУчета.Верх, 2, ОбластьРазделаУчета.Низ, ОбластьСостоянияРаздела.Лево - 1);
				ОбластьОшибки.ЦветФона   = ЦветФонаОшибок;
				ОбластьОшибки.ЦветТекста = ЦветТекстаОшибок;
				ОбластьСостоянияРаздела.Текст  = "Обнаружены ошибки (" + КолОшибокВРазделе + ")";
				ОбластьСостоянияРаздела.ЦветФона   = ЦветФонаКолОшибок;
				ОбластьСостоянияРаздела.ЦветТекста = ЦветТекстаКолОшибок;
			ИначеЕсли ПроведеныПроверкиВРазделе Тогда
				ОбластьСостоянияРаздела.Текст = "Ошибок не обнаружено";
			Иначе
				ОбластьСостоянияРаздела.Текст = "Проверка не выполнена";
			КонецЕсли;
			
		КонецЕсли;
		
		КлючеваяОперация = "Экспресс проверка ведения учета" + " - " + НРег(СтрокаРаздела.Наименование);
		ОценкаПроизводительности.ЗакончитьЗамерВремени(КлючеваяОперация, ЗначениеТаймераСтрокаРаздела);
		
	КонецЦикла;
	
	КлючеваяОперация = "Обработка ""Экспресс проверка ведения учета""";
	ОценкаПроизводительности.ЗакончитьЗамерВремени(КлючеваяОперация, ЗначениеТаймера);
	
	ТабличныйДокумент.ТолькоПросмотр = Истина;
	ТабличныйДокумент.ФиксацияСверху = ВысотаОбластей.Шапка + ВысотаОбластей.Заголовок;
	ТабличныйДокумент.ПовторятьПриПечатиСтроки = ТабличныйДокумент.Область(ВысотаОбластей.Шапка + 1, , ВысотаОбластей.Шапка + ВысотаОбластей.Заголовок);
	ТабличныйДокумент.ОбластьПечати = ТабличныйДокумент.Область(1, 2, ТабличныйДокумент.ВысотаТаблицы, ТабличныйДокумент.ШиринаТаблицы);
	ТабличныйДокумент.ИмяПараметровПечати = "ЭкспрессПроверкаВеденияУчета";
	
	ТабличныйДокумент.ТекущаяОбласть = ТабличныйДокумент.Область(1, 1, 1, 1);
	
КонецПроцедуры

// Универсальная процедура 
Процедура СформироватьДетальныйОтчет(СтрокаПравила, ТабДокумент, ПараметрыОтчета)
	
	ИдентификаторПравила = СтрокаПравила.Идентификатор;
	
	СохраненРезультатЗапросаПроверки = ПараметрыОтчета.ИсходящиеДанные.Свойство(ИдентификаторПравила+"РезультатЗапроса");
	СохраненаТаблицаОшибокПроверки   = ПараметрыОтчета.ИсходящиеДанные.Свойство(ИдентификаторПравила+"ТаблицаЗначений");
	СохраненИсточникДанныхПроверки	 = ПараметрыОтчета.ИсходящиеДанные.Свойство(ИдентификаторПравила+"ИсточникДанных");
	
	Если СохраненРезультатЗапросаПроверки Тогда
		ИсточникДанных = ПараметрыОтчета.ИсходящиеДанные[ИдентификаторПравила+"РезультатЗапроса"];
		Если ТипЗнч(ИсточникДанных) <> Тип("РезультатЗапроса") Тогда
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru='Неправильный тип значения %1 ""%2"".'"),
				ИдентификаторПравила,
				"РезультатЗапроса!");
			ОбщегоНазначения.СообщитьПользователю(ТекстСообщения);
			Возврат;
		КонецЕсли;
	ИначеЕсли СохраненаТаблицаОшибокПроверки Тогда
		ИсточникДанных = ПараметрыОтчета.ИсходящиеДанные[ИдентификаторПравила+"ТаблицаЗначений"];
		Если ТипЗнч(ИсточникДанных) <> Тип("ТаблицаЗначений") Тогда
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru='Неправильный тип значения %1 ""%2"".'"),
				ИдентификаторПравила,
				"ТаблицаЗначений!");
			ОбщегоНазначения.СообщитьПользователю(ТекстСообщения);
			Возврат;
		КонецЕсли;		
	ИначеЕсли СохраненИсточникДанныхПроверки Тогда
		ОписаниеИсточникаДанных = ПараметрыОтчета.ИсходящиеДанные[ИдентификаторПравила+"ИсточникДанных"];
		Если ТипЗнч(ОписаниеИсточникаДанных) <> Тип("ОписаниеИсточникаДанных") Тогда
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru='Неправильный тип значения %1 ""%2"".'"),
				ИдентификаторПравила,
				"ОписаниеИсточникаДанных!");
			ОбщегоНазначения.СообщитьПользователю(ТекстСообщения);
			Возврат;
		КонецЕсли;
	Иначе	
		Возврат;
	КонецЕсли;
	
	Если НЕ СохраненИсточникДанныхПроверки Тогда 
		ОписаниеИсточникаДанных = Новый ОписаниеИсточникаДанных(ИсточникДанных);
	КонецЕсли;	
	
	ЕстьСтруктураЗаголовков    = ПараметрыОтчета.ИсходящиеДанные.Свойство(ИдентификаторПравила+"СтруктураЗаголовков");
	Если ЕстьСтруктураЗаголовков Тогда
		СтруктураЗаголовков = ПараметрыОтчета.ИсходящиеДанные[ИдентификаторПравила+"СтруктураЗаголовков"];
	Иначе
		СтруктураЗаголовков = Новый Структура;
	КонецЕсли;
	ЕстьСтруктураФорматаПолей = ПараметрыОтчета.ИсходящиеДанные.Свойство(ИдентификаторПравила+"СтруктураФорматаПолей");
	Если ЕстьСтруктураФорматаПолей Тогда
		СтруктураФорматаПолей = ПараметрыОтчета.ИсходящиеДанные[ИдентификаторПравила+"СтруктураФорматаПолей"];
	Иначе
		СтруктураФорматаПолей = Новый Структура;
	КонецЕсли;
	ЕстьСтруктураШириныКолонок = ПараметрыОтчета.ИсходящиеДанные.Свойство(ИдентификаторПравила+"СтруктураШириныКолонок");
	Если ЕстьСтруктураШириныКолонок Тогда
		СтруктураШириныКолонок = ПараметрыОтчета.ИсходящиеДанные[ИдентификаторПравила+"СтруктураШириныКолонок"];
	Иначе
		СтруктураШириныКолонок = Новый Структура;
	КонецЕсли;
	ЕстьСтруктураРасшифровки  = ПараметрыОтчета.ИсходящиеДанные.Свойство(ИдентификаторПравила+"СтруктураРасшифровки");
	Если ЕстьСтруктураРасшифровки Тогда
		СтруктураРасшифровки  = ПараметрыОтчета.ИсходящиеДанные[ИдентификаторПравила+"СтруктураРасшифровки"];
	Иначе
		СтруктураРасшифровки  = Новый Структура;
	КонецЕсли;
		
	ЕстьМакет = ПараметрыОтчета.ИсходящиеДанные.Свойство(ИдентификаторПравила+"МакетОформления");	
	Если ЕстьМакет Тогда
		МакетОформления = ПараметрыОтчета.ИсходящиеДанные[ИдентификаторПравила+"МакетОформления"];	
	КонецЕсли;	
	
	Если ТипЗнч(ТабДокумент) <> Тип("ТабличныйДокумент") Тогда
		ТабДокумент = Новый ТабличныйДокумент;
	КонецЕсли;
	
	Построитель = Новый ПостроительОтчета;
	
	Построитель.ИсточникДанных = ОписаниеИсточникаДанных;
	Построитель.ЗаполнитьНастройки();
	Построитель.РазмещениеИзмеренийВСтроках = ТипРазмещенияИзмерений.Вместе;
	
	Построитель.Выполнить();
		
	Построитель.ВыводитьЗаголовокОтчета = Ложь;
	Построитель.ВыводитьПодвалТаблицы   = Ложь;
	Построитель.ВыводитьПодвалОтчета    = Ложь;
	
	ЦветФонаОшибок       = Новый Цвет(253, 236, 229); // светло-розовый

	Если ЕстьМакет Тогда
		Макет = ПолучитьМакет(МакетОформления);		
	Иначе	
		Построитель.ОформитьМакет();		
		
		Макет = Построитель.Макет;
				
		ШапкаТаблицыМакета = Макет.Область("ШапкаТаблицы");
		Для НомСтроки = ШапкаТаблицыМакета.Верх По ШапкаТаблицыМакета.Низ Цикл
			Для НомКолонки = 2 По Макет.ШиринаТаблицы Цикл
				ТекОбласть = Макет.Область(НомСтроки, НомКолонки, НомСтроки, НомКолонки);
				ТекОбласть.РазмещениеТекста = ТипРазмещенияТекстаТабличногоДокумента.Переносить;
				ТекОбласть.Шрифт = Новый Шрифт(ТекОбласть.Шрифт, ,8);
				ТекОбласть.ЦветРамки = WebЦвета.Серый;
				ТекОбласть.ЦветФона  = ЦветФонаОшибок;
				
				ТекЗаголовок = ТекОбласть.Текст;
				Если СтруктураШириныКолонок.Свойство(ТекЗаголовок) Тогда
					ТекОбласть.ШиринаКолонки = СтруктураШириныКолонок[ТекЗаголовок];
				КонецЕсли;
				
				Если СтруктураЗаголовков.Свойство(ТекЗаголовок) Тогда
					ТекОбласть.Текст = СтруктураЗаголовков[ТекЗаголовок];
				КонецЕсли;
				
			КонецЦикла;
		КонецЦикла;
		
		ДеталиМакета = Макет.Область("Детали");
		ШапкаТаблицыМакета = Макет.Область("ШапкаТаблицы");
		Для НомСтроки = ДеталиМакета.Верх По ДеталиМакета.Низ Цикл
			Для НомКолонки = 2 По Макет.ШиринаТаблицы Цикл
				ТекОбласть = Макет.Область(НомСтроки, НомКолонки, НомСтроки, НомКолонки);
				ТекОбласть.ЦветРамки = WebЦвета.Серый;
				ТекИмяПараметра = ТекОбласть.Параметр;
				
				Если ТекИмяПараметра = Неопределено Тогда
					Продолжить;
				КонецЕсли;	
				
				Если СтруктураФорматаПолей.Свойство(ТекИмяПараметра) Тогда
					ТекОбласть.Формат = СтруктураФорматаПолей[ТекИмяПараметра];
				КонецЕсли;
				
				Если СтруктураРасшифровки.Свойство(ТекИмяПараметра) Тогда
					ТекОбласть.ПараметрРасшифровки = СтруктураРасшифровки[ТекИмяПараметра];
				КонецЕсли;   			
			КонецЦикла;
		КонецЦикла;
		
	КонецЕсли;

	Построитель.Макет = Макет;	
	Построитель.Вывести(ТабДокумент);
	
КонецПроцедуры

// Учетная политика

Процедура ПроверитьПравилоНаличиеУчПБухУчет(СтрокаПравила, ПараметрыОтчета)
	
	Перем Отказ;
	
	УчетнаяПолитикаБухУчет = УчетнаяПолитикаСервер.Существует(ПараметрыОтчета.Организация, ПараметрыОтчета.ДатаНач, "БУ",Истина);
	ПараметрыОтчета.ИсходящиеДанные.Вставить("УчетнаяПолитикаБухУчет", УчетнаяПолитикаБухУчет);
	НетУчетнойПолитики = НЕ УчетнаяПолитикаБухУчет;
	
	СтрокаПравила.ОбнаруженыОшибки  = НетУчетнойПолитики;
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
КонецПроцедуры

Процедура ПроверитьПравилоНаличиеУчПНалУчет(СтрокаПравила, ПараметрыОтчета)
	
	Перем Отказ;
	
	УчетнаяПолитикаНалУчет =  УчетнаяПолитикаСервер.Существует(ПараметрыОтчета.Организация, ПараметрыОтчета.ДатаНач, "НУ", Истина);
	ПараметрыОтчета.ИсходящиеДанные.Вставить("УчетнаяПолитикаНалУчет", УчетнаяПолитикаНалУчет);
	НетУчетнойПолитики = НЕ УчетнаяПолитикаНалУчет;
	
	СтрокаПравила.ОбнаруженыОшибки  = НетУчетнойПолитики;
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
КонецПроцедуры
        
Процедура ПроверитьПравилоНаличиеУчП_Перс(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос(
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Организации.Ссылка КАК Организация,
	|	УчетнаяПолитикаПоПерсоналу.ВестиУчетПоГоловнойОрганизации
	|ИЗ
	|	Справочник.Организации КАК Организации
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаПоПерсоналуОрганизаций КАК УчетнаяПолитикаПоПерсоналу
	|		ПО Организации.Ссылка = УчетнаяПолитикаПоПерсоналу.Организация
	|ГДЕ
	|	Организации.Ссылка = &Организация");
	
	Запрос.УстановитьПараметр("парамПустаяОрганизация", Справочники.Организации.ПустаяСсылка());
	Запрос.УстановитьПараметр("Организация", ПараметрыОтчета.Организация);
	Результат = Запрос.Выполнить();
	НетУчетнойПолитикиПоПерсоналу = Результат.Пустой();
	
	Если НетУчетнойПолитикиПоПерсоналу Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("УчетнаяПолитикаПоПерсоналу", Неопределено);
	Иначе
		Выборка = Результат.Выбрать();
		Выборка.Следующий();
		
		УчетнаяПолитикаПоПерсоналу = Новый Структура;
		УчетнаяПолитикаПоПерсоналу.Вставить("ВестиУчетПоГоловнойОрганизации", Выборка.ВестиУчетПоГоловнойОрганизации);
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("УчетнаяПолитикаПоПерсоналу", УчетнаяПолитикаПоПерсоналу);
	КонецЕсли;
	
	СтрокаПравила.ОбнаруженыОшибки  = НетУчетнойПолитикиПоПерсоналу;
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
КонецПроцедуры

// Касса

Процедура ПроверитьПравилоНепроведенныеПКО_РКО(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ПриходныйКассовыйОрдер.Ссылка КАК Документ,
	|	ПриходныйКассовыйОрдер.Дата КАК Дата,
	|	ПриходныйКассовыйОрдер.Номер,
	|	ПриходныйКассовыйОрдер.ВидОперации,
	|	ПриходныйКассовыйОрдер.СуммаДокумента,
	|	ПриходныйКассовыйОрдер.Ответственный
	|ИЗ
	|	Документ.ПриходныйКассовыйОрдер КАК ПриходныйКассовыйОрдер
	|ГДЕ
	|	ПриходныйКассовыйОрдер.Проведен = ЛОЖЬ
	|	И ПриходныйКассовыйОрдер.ПометкаУдаления = ЛОЖЬ
	|	И ПриходныйКассовыйОрдер.Дата МЕЖДУ &ДатаНач И &ДатаКон
	|	И ПриходныйКассовыйОрдер.Организация = &Организация
	|	И ПриходныйКассовыйОрдер.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ 
	|	РасходныйКассовыйОрдер.Ссылка,
	|	РасходныйКассовыйОрдер.Дата,
	|	РасходныйКассовыйОрдер.Номер,
	|	РасходныйКассовыйОрдер.ВидОперации,
	|	РасходныйКассовыйОрдер.СуммаДокумента,
	|	РасходныйКассовыйОрдер.Ответственный
	|ИЗ
	|	Документ.РасходныйКассовыйОрдер КАК РасходныйКассовыйОрдер
	|ГДЕ
	|	РасходныйКассовыйОрдер.Проведен = ЛОЖЬ
	|	И РасходныйКассовыйОрдер.ПометкаУдаления = ЛОЖЬ
	|	И РасходныйКассовыйОрдер.Дата МЕЖДУ &ДатаНач И &ДатаКон
	|	И РасходныйКассовыйОрдер.Организация = &Организация
	|	И РасходныйКассовыйОрдер.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение
	|
	|УПОРЯДОЧИТЬ ПО
	|	Дата,
	|	Документ
	|АВТОУПОРЯДОЧИВАНИЕ";
	
	Запрос.УстановитьПараметр("ДатаНач", 				  ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", 				  КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация", 			  ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
	
	Результат = Запрос.Выполнить();
	
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("НепроведенныеПКО_РКОРезультатЗапроса", Результат);
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("ВидОперации", "Вид операции");
		СтруктураЗаголовков.Вставить("СуммаДокумента", "Сумма документа");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("НепроведенныеПКО_РКОСтруктураЗаголовков", СтруктураЗаголовков);
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("Документ" , 40);
		СтруктураШириныКолонок.Вставить("Дата", 20);
		СтруктураШириныКолонок.Вставить("Номер"  , 25);
		СтруктураШириныКолонок.Вставить("ВидОперации" , 25);
		СтруктураШириныКолонок.Вставить("СуммаДокумента"   , 25);
		СтруктураШириныКолонок.Вставить("Ответственный"   , 25);
		ПараметрыОтчета.ИсходящиеДанные.Вставить("НепроведенныеПКО_РКОСтруктураШириныКолонок", СтруктураШириныКолонок);
	   	СтруктураРасшифровки = Новый Структура;
	   	СтруктураРасшифровки.Вставить("Документ", "Документ");
    	ПараметрыОтчета.ИсходящиеДанные.Вставить("НепроведенныеПКО_РКОСтруктураРасшифровки", СтруктураРасшифровки);
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоМинусыПоКассе(СтрокаПравила, ПараметрыОтчета)

	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ТиповойОстаткиИОбороты.Период КАК Период,
	               |	ТиповойОстаткиИОбороты.Субконто1 КАК Касса,
	               |	ТиповойОстаткиИОбороты.СуммаКонечныйОстатокДт КАК Остаток
	               |ИЗ
	               |	РегистрБухгалтерии.Типовой.ОстаткиИОбороты(&ДатаНач, &ДатаКон, День, ДвиженияИГраницыПериода, Счет В ИЕРАРХИИ (&СчетКассы), , Организация = &Организация И СтруктурноеПодразделение = &СтруктурноеПодразделение) КАК ТиповойОстаткиИОбороты
	               |ГДЕ
	               |	ТиповойОстаткиИОбороты.СуммаКонечныйОстатокДт < 0
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Период,
	               |	Касса";
	
	Запрос.УстановитьПараметр("ДатаНач", 				  ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", 				  КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("СчетКассы", 				  ПланыСчетов.Типовой.ДенежныеСредстваВКассе);
	Запрос.УстановитьПараметр("Организация", 			  ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
	
	Результат = Запрос.Выполнить();
	
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("МинусыПоКассеРезультатЗапроса", Результат);
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоЛимитРасчетовСЮрЛицами(СтрокаПравила, ПараметрыОтчета)
	
	ДатаНачЛимитаДляИП = НачалоДня(Дата(2018, 01, 01));

	ОрганизацияЯвляетсяФизЛицом = ПараметрыОтчета.Организация.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ФизЛицо;
	ОрганизацияПлательщикНДС    = ПроцедурыНалоговогоУчета.ПолучитьПризнакПлательщикаНДС(ПараметрыОтчета.Организация, КонецДня(ПараметрыОтчета.ДатаКон));
	
	Если ОрганизацияЯвляетсяФизЛицом И КонецДня(ПараметрыОтчета.ДатаКон) < ДатаНачЛимитаДляИП Тогда
	
		СтрокаПравила.ОбнаруженыОшибки  = Ложь;
		СтрокаПравила.ПроверкаВыполнена = Истина;
		СтрокаПравила.КомментарийРезультата = "Проверяемая организация является физическим лицом, поэтому лимит расчетов "
											+ " между юридическими лицами на нее не распространяется";
		Возврат;
	
	КонецЕсли;

	Если ОрганизацияЯвляетсяФизЛицом И КонецДня(ПараметрыОтчета.ДатаКон) >= ДатаНачЛимитаДляИП И НЕ ОрганизацияПлательщикНДС Тогда
	
		СтрокаПравила.ОбнаруженыОшибки  = Ложь;
		СтрокаПравила.ПроверкаВыполнена = Истина;
		СтрокаПравила.КомментарийРезультата = "Проверяемая организация является физическим лицом и не плательщиком НДС, поэтому лимит расчетов "
											+ " между юридическими лицами и индивидуальными предпринимателями на нее не распространяется";
		Возврат;
	
	КонецЕсли;
	
	ДатаИзмененияЛимитаРасчетов = НачалоДня(Дата(2012, 09, 24));
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ДатаНач", ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("ДатаНачЛимитаДляИП", МАКС(ПараметрыОтчета.ДатаНач, ДатаНачЛимитаДляИП));
	
	РазмерМРП = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	            |	РасчетныеПоказатели.Период,
	            |	ЕСТЬNULL(РасчетныеПоказатели.РазмерМРП, 0) * 1000 КАК Предел1000,
	            |	ЕСТЬNULL(РасчетныеПоказатели.РазмерМРП, 0) * 4000 КАК Предел4000
	            |ИЗ
	            |	РегистрСведений.РегламентированныеРасчетныеПоказатели.СрезПоследних(&ДатаНач, ) КАК РасчетныеПоказатели
	            |ГДЕ
	            |	ЕСТЬNULL(РасчетныеПоказатели.РазмерМРП, 0) <> 0
	            |
	            |ОБЪЕДИНИТЬ
	            |
	            |ВЫБРАТЬ
	            |	РасчетныеПоказатели.Период,
	            |	ЕСТЬNULL(РасчетныеПоказатели.РазмерМРП, 0) * 1000,
	            |	ЕСТЬNULL(РасчетныеПоказатели.РазмерМРП, 0) * 4000
	            |ИЗ
	            |	РегистрСведений.РегламентированныеРасчетныеПоказатели КАК РасчетныеПоказатели
	            |ГДЕ
	            |	РасчетныеПоказатели.Период МЕЖДУ &ДатаНач И &ДатаКон
	            |	И ЕСТЬNULL(РасчетныеПоказатели.РазмерМРП, 0) <> 0";
			
	Запрос.Текст = РазмерМРП;		
	ТаблицаМРП = Запрос.Выполнить().Выгрузить();
	
	Если ТаблицаМРП.Количество() <> 0 Тогда
		Запрос.УстановитьПараметр("ДатаИзмененияЛимитаРасчетов", ДатаИзмененияЛимитаРасчетов);
		ТаблицаМРП.Сортировать("Период Убыв");
		Условие = " ГДЕ ВЫБОР ";
		НомерСтроки = 0;
		Для каждого СтрокаМРП Из ТаблицаМРП Цикл
			НомерСтроки = НомерСтроки + 1;
			ДатаМРП   = "ДатаМРП"    + Строка(НомерСтроки);
			Лимит1000 = "Лимит1000_" + Строка(НомерСтроки);
			Лимит4000 = "Лимит4000_" + Строка(НомерСтроки);
			Условие = Условие + " КОГДА ТиповойОбороты.Период >= &" + ДатаМРП + "
			        | ТОГДА ВЫБОР
					| КОГДА ТиповойОбороты.Период < &ДатаИзмененияЛимитаРасчетов
				    | ТОГДА ТиповойОбороты.СуммаОборотДт > &" + Лимит4000 + " 
				    | ИЛИ ТиповойОбороты.СуммаОборотКт > &"   + Лимит4000 + "
			        | КОГДА ТиповойОбороты.Период >= &ДатаИзмененияЛимитаРасчетов
				    | ТОГДА ТиповойОбороты.СуммаОборотДт > &" + Лимит1000 + " 
				    | ИЛИ ТиповойОбороты.СуммаОборотКт > &"   + Лимит1000 + "
		            | КОНЕЦ ";		      
			Запрос.УстановитьПараметр(ДатаМРП, СтрокаМРП.Период);
			Запрос.УстановитьПараметр(Лимит1000, СтрокаМРП.Предел1000);
			Запрос.УстановитьПараметр(Лимит4000, СтрокаМРП.Предел4000);
		КонецЦикла;
		Условие = Условие + " КОНЕЦ ";	
	Иначе
		СтрокаПравила.ОбнаруженыОшибки  = Истина;
		СтрокаПравила.ПроверкаВыполнена = Истина;
		СтрокаПравила.КомментарийРезультата = "В регистре сведений ""Регламентированные расчетные показатели"" не задано значение МРП. Проверка не может быть осуществлена.";
	    СтрокаПравила.ПричиныОшибокРезультата = "В регистре сведений ""Регламентированные расчетные показатели"" не задано значение " 
				+ " минимального расчетного показателя на дату: " + КонецДня(ПараметрыОтчета.ДатаКон);
		СтрокаПравила.РекомендацииРезультата = "Задать значение минимального расчетного показателя.";
		Возврат;
	КонецЕсли;
		
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ТиповойОбороты.Период КАК Дата,
	|	ТиповойОбороты.Регистратор КАК Документ,
	|	ТиповойОбороты.Субконто1 КАК Контрагент,
	|	ТиповойОбороты.Субконто2 КАК Договор,
	|	ТиповойОбороты.СуммаОборотДт КАК Выдано,
	|	ТиповойОбороты.СуммаОборотКт КАК Получено
	|ИЗ
	|	РегистрБухгалтерии.Типовой.Обороты(
	|			&ДатаНач,
	|			&ДатаКон,
	|			Регистратор,
	|			,
	|			&ВидыСубконтоКонтрагентыДоговоры,
	|			&Организация = Организация
	|				И Субконто1.ЮрФизЛицо = &ЮрЛицо
	|				И СтруктурноеПодразделение = &СтруктурноеПодразделение
	|				И СтруктурноеПодразделениеКор = &СтруктурноеПодразделениеКор,
	|			КорСчет В ИЕРАРХИИ (&СчетКассы),
	|			) КАК ТиповойОбороты" + Условие + "
	|АВТОУПОРЯДОЧИВАНИЕ";
	
	ТекстЗапросаИП =
	"ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ТиповойОбороты.Период КАК Дата,
	|	ТиповойОбороты.Регистратор КАК Документ,
	|	ТиповойОбороты.Субконто1 КАК Контрагент,
	|	ТиповойОбороты.Субконто2 КАК Договор,
	|	ТиповойОбороты.СуммаОборотДт КАК Выдано,
	|	ТиповойОбороты.СуммаОборотКт КАК Получено
	|ИЗ
	|	РегистрБухгалтерии.Типовой.Обороты(
	|			&ДатаНачЛимитаДляИП,
	|			&ДатаКон,
	|			Регистратор,
	|			,
	|			&ВидыСубконтоКонтрагентыДоговоры,
	|			&Организация = Организация
	|				И Субконто1.ЮрФизЛицо = &ФизЛицо И Субконто1.ИндивидуальныйПредпринимательАдвокатЧастныйНотариус 
	|				И СтруктурноеПодразделение = &СтруктурноеПодразделение
	|				И СтруктурноеПодразделениеКор = &СтруктурноеПодразделениеКор,
	|			КорСчет В ИЕРАРХИИ (&СчетКассы),
	|			) КАК ТиповойОбороты
	|ГДЕ
	|	ТиповойОбороты.СуммаОборотДт > &" + Лимит1000 + " 
	|	ИЛИ ТиповойОбороты.СуммаОборотКт > &" + Лимит1000 + "
	|АВТОУПОРЯДОЧИВАНИЕ";
	
	ДополнениеКомментарияИП = "";
	Если ПараметрыОтчета.ДатаНач >= ДатаНачЛимитаДляИП И ДатаНачЛимитаДляИП <= КонецДня(ПараметрыОтчета.ДатаКон) Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "АВТОУПОРЯДОЧИВАНИЕ", ТекстЗапросаИП);
		ДополнениеКомментарияИП = " (инд. предпринимателями, плательщиками НДС)";
	КонецЕсли;
	          	
	Запрос.УстановитьПараметр("СчетКассы", ПланыСчетов.Типовой.ДенежныеСредстваВКассе);
	ВидыСубконтоКонтрагентыДоговоры = Новый Массив;
	ВидыСубконтоКонтрагентыДоговоры.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.Контрагенты);
	ВидыСубконтоКонтрагентыДоговоры.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.Договоры);
	Запрос.УстановитьПараметр("ВидыСубконтоКонтрагентыДоговоры", ВидыСубконтоКонтрагентыДоговоры);
	Запрос.УстановитьПараметр("СчетКассы"					   , ПланыСчетов.Типовой.ДенежныеСредстваВКассе);
	Запрос.УстановитьПараметр("Организация"				   	   , ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("ЮрЛицо"					       , Перечисления.ЮрФизЛицо.ЮрЛицо);
	Запрос.УстановитьПараметр("ФизЛицо"					       , Перечисления.ЮрФизЛицо.ФизЛицо);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение"       , ПараметрыОтчета.СтруктурноеПодразделение);
	Запрос.УстановитьПараметр("СтруктурноеПодразделениеКор"    , ПараметрыОтчета.СтруктурноеПодразделение);
	
	Результат = Запрос.Выполнить();
	
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если ДатаИзмененияЛимитаРасчетов > ПараметрыОтчета.ДатаНач И ДатаИзмененияЛимитаРасчетов > КонецДня(ПараметрыОтчета.ДатаКон) Тогда
		ДополнениеКомментария = "Лимит расчетов между юр.лицами установлен в размере 4000 МРП. ";  
	ИначеЕсли ДатаИзмененияЛимитаРасчетов >= ПараметрыОтчета.ДатаНач И ДатаИзмененияЛимитаРасчетов < КонецДня(ПараметрыОтчета.ДатаКон) Тогда	
		ДополнениеКомментария = "До 24.09.2012 лимит расчетов между юр.лицами установлен в размере 4000 МРП. "  
							  + "С 24.09.2012 лимит расчетов между юр.лицами установлен в размере 1000 МРП. ";  
	ИначеЕсли ДатаИзмененияЛимитаРасчетов < ПараметрыОтчета.ДатаНач И ДатаИзмененияЛимитаРасчетов < КонецДня(ПараметрыОтчета.ДатаКон) Тогда	
		ДополнениеКомментария = "Лимит расчетов между юр.лицами" + ДополнениеКомментарияИП + " установлен в размере 1000 МРП. "; 
	КонецЕсли;						  
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		СтрокаПравила.КомментарийРезультата = ДополнениеКомментария + СтрокаПравила.КомментарийРезультатаОшибка;
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ЛимитРасчетовСЮрЛицамиРезультатЗапроса", Результат);
		
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Контрагент", "Контрагент");
		СтруктураРасшифровки.Вставить("Договор", "Договор");
	   	СтруктураРасшифровки.Вставить("Документ", "Документ");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ЛимитРасчетовСЮрЛицамиСтруктураРасшифровки", СтруктураРасшифровки);
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("Дата", 20);
		СтруктураШириныКолонок.Вставить("Документ" , 40);		
		СтруктураШириныКолонок.Вставить("Контрагент"  , 30);
		СтруктураШириныКолонок.Вставить("Договор" , 30);
		СтруктураШириныКолонок.Вставить("Выдано"   , 25);
		СтруктураШириныКолонок.Вставить("Получено"   , 25);
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ЛимитРасчетовСЮрЛицамиСтруктураШириныКолонок", СтруктураШириныКолонок);
	Иначе
		СтрокаПравила.КомментарийРезультата = ДополнениеКомментария + СтрокаПравила.КомментарийРезультатаНетОшибок;
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоНумерацияПКО_РКО(СтрокаПравила, ПараметрыОтчета)
	
	ТаблицаНарушений = Новый ТаблицаЗначений;
	ТаблицаНарушений.Колонки.Добавить("НомерДокумента");
	ТаблицаНарушений.Колонки.Добавить("ДатаДокумента");
	ТаблицаНарушений.Колонки.Добавить("Документ");
	ТаблицаНарушений.Колонки.Добавить("НомерСледующего");
	ТаблицаНарушений.Колонки.Добавить("ДатаСледующего");
	ТаблицаНарушений.Колонки.Добавить("СледДокумент");
	
	// Сначала проверяем последовательность нумерации приходных кассовых ордеров
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ПриходныйКассовыйОрдер.Ссылка КАК Документ,
	|	ПриходныйКассовыйОрдер.Дата КАК Дата,
	|	ПриходныйКассовыйОрдер.Номер
	|ИЗ
	|	Документ.ПриходныйКассовыйОрдер КАК ПриходныйКассовыйОрдер
	|ГДЕ
	|	ПриходныйКассовыйОрдер.ПометкаУдаления = ЛОЖЬ
	|	И ПриходныйКассовыйОрдер.Дата МЕЖДУ &ДатаНач И &ДатаКон
	|	И ПриходныйКассовыйОрдер.Организация = &Организация
	|	И ПриходныйКассовыйОрдер.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение";
	
	Запрос.УстановитьПараметр("ДатаНач"					, ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон"					, КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация"				, ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
	
	
	Результат = Запрос.Выполнить();
	ТаблицаРезультата = Результат.Выгрузить();
	ТаблицаРезультата.Колонки.Добавить("НомерЧислом");
	
	Для каждого СтрокаТаблицы Из ТаблицаРезультата Цикл
		СтрокаТаблицы.НомерЧислом = ПолучитьНомерЧислом(СтрокаТаблицы.Номер);
	КонецЦикла;
	ТаблицаРезультата.Сортировать("НомерЧислом ВОЗР, Дата ВОЗР");
	
	Для ИндексСтроки = 1 По ТаблицаРезультата.Количество() - 1 Цикл
		
		ДатаТекущейСтроки    = ТаблицаРезультата[ИндексСтроки].Дата;
		ДатаПредыдущейСтроки = ТаблицаРезультата[ИндексСтроки - 1].Дата;
		НарушенаНумерация    = ДатаТекущейСтроки < ДатаПредыдущейСтроки;
		
		Если НарушенаНумерация Тогда
			
			СтрокаНарушения = ТаблицаНарушений.Добавить();
			СтрокаНарушения.НомерДокумента  = ТаблицаРезультата[ИндексСтроки].Номер;
			СтрокаНарушения.ДатаДокумента   = ТаблицаРезультата[ИндексСтроки].Дата;
			СтрокаНарушения.Документ        = ТаблицаРезультата[ИндексСтроки].Документ;
			СтрокаНарушения.НомерСледующего = ТаблицаРезультата[ИндексСтроки - 1].Номер;
			СтрокаНарушения.ДатаСледующего  = ТаблицаРезультата[ИндексСтроки - 1].Дата;
			СтрокаНарушения.СледДокумент    = ТаблицаРезультата[ИндексСтроки - 1].Документ;
		
		КонецЕсли; 
	КонецЦикла;
	
	// Затем проверяем последовательность нумерации расходных кассовых ордеров
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	РасходныйКассовыйОрдер.Ссылка КАК Документ,
	|	РасходныйКассовыйОрдер.Дата КАК Дата,
	|	РасходныйКассовыйОрдер.Номер
	|ИЗ
	|	Документ.РасходныйКассовыйОрдер КАК РасходныйКассовыйОрдер
	|ГДЕ
	|	РасходныйКассовыйОрдер.ПометкаУдаления = ЛОЖЬ
	|	И РасходныйКассовыйОрдер.Дата МЕЖДУ &ДатаНач И &ДатаКон
	|	И РасходныйКассовыйОрдер.Организация = &Организация
	|	И РасходныйКассовыйОрдер.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение";
	
	Запрос.УстановитьПараметр("ДатаНач"					, ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон"					, КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация"				, ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
	
	
	Результат = Запрос.Выполнить();
	ТаблицаРезультата = Результат.Выгрузить();
	ТаблицаРезультата.Колонки.Добавить("НомерЧислом");
	
	Для каждого СтрокаТаблицы Из ТаблицаРезультата Цикл
		СтрокаТаблицы.НомерЧислом = ПолучитьНомерЧислом(СтрокаТаблицы.Номер);
	КонецЦикла;
	ТаблицаРезультата.Сортировать("НомерЧислом ВОЗР, Дата ВОЗР");
	
	Для ИндексСтроки = 1 По ТаблицаРезультата.Количество() - 1 Цикл
		
		ДатаТекущейСтроки    = ТаблицаРезультата[ИндексСтроки].Дата;
		ДатаПредыдущейСтроки = ТаблицаРезультата[ИндексСтроки - 1].Дата;
		НарушенаНумерация    = ДатаТекущейСтроки < ДатаПредыдущейСтроки;
		
		Если НарушенаНумерация Тогда
			
			СтрокаНарушения = ТаблицаНарушений.Добавить();
			СтрокаНарушения.НомерДокумента  = ТаблицаРезультата[ИндексСтроки].Номер;
			СтрокаНарушения.ДатаДокумента   = ТаблицаРезультата[ИндексСтроки].Дата;
			СтрокаНарушения.Документ        = ТаблицаРезультата[ИндексСтроки].Документ;
			СтрокаНарушения.НомерСледующего = ТаблицаРезультата[ИндексСтроки - 1].Номер;
			СтрокаНарушения.ДатаСледующего  = ТаблицаРезультата[ИндексСтроки - 1].Дата;
			СтрокаНарушения.СледДокумент    = ТаблицаРезультата[ИндексСтроки - 1].Документ;
		
		КонецЕсли; 
	КонецЦикла;
	
	СтрокаПравила.ОбнаруженыОшибки  = ТаблицаНарушений.Количество() > 0;
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("НумерацияПКО_РКОТаблицаЗначений", ТаблицаНарушений);
		
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("НомерДокумента" , "Номер документа");
		СтруктураЗаголовков.Вставить("ДатаДокумента"  , "Дата документа");
		СтруктураЗаголовков.Вставить("Документ"  , 		"Документ");
		СтруктураЗаголовков.Вставить("НомерСледующего", "Номер след. документа");
		СтруктураЗаголовков.Вставить("ДатаСледующего" , "Дата след. документа");
		СтруктураЗаголовков.Вставить("СледДокумент"   , "Следующий документ");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("НумерацияПКО_РКОСтруктураЗаголовков", СтруктураЗаголовков);
		
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("НомерДокумента" , 25);
		СтруктураШириныКолонок.Вставить("НомерСледующего", 25);
		СтруктураШириныКолонок.Вставить("ДатаДокумента"  , 20);
		СтруктураШириныКолонок.Вставить("Документ"  	 , 40);
		СтруктураШириныКолонок.Вставить("ДатаСледующего" , 20);
		СтруктураШириныКолонок.Вставить("СледДокумент"   , 40);
		ПараметрыОтчета.ИсходящиеДанные.Вставить("НумерацияПКО_РКОСтруктураШириныКолонок", СтруктураШириныКолонок);
		
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("СледДокумент", "СледДокумент");
	   	СтруктураРасшифровки.Вставить("Документ"	, "Документ");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("НумерацияПКО_РКОСтруктураРасшифровки", СтруктураРасшифровки);
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоРазницаКурсовВБанковскихДокументах(СтрокаПравила, ПараметрыОтчета)
	
	МенеджерВТ = Новый МенеджерВременныхТаблиц;
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВТ;
		
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ПлатежныеДокументы.Ссылка,
	|	ПлатежныеДокументы.ВалютаДокумента,
	|	ПлатежныеДокументы.КурсВзаиморасчетов,
	|	ПлатежныеДокументы.Дата КАК Дата,
	|	ПлатежныеДокументы.НомерСтроки
	|ПОМЕСТИТЬ БанковскиеДокументы
	|ИЗ
	|	(ВЫБРАТЬ
	|		ПлатежныйОрдерПоступлениеДС.Ссылка КАК Ссылка,
	|		ВЫБОР
	|			КОГДА ПлатежныйОрдерПоступлениеДС.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПоступленияОтПродажиИностраннойВалюты)
	|					ИЛИ ПлатежныйОрдерПоступлениеДС.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПриобретениеИностраннойВалюты)
	|				ТОГДА ПлатежныйОрдерПоступлениеДС.Ссылка.КурсНаДатуПриобретенияРеализацииВалюты
	|			ИНАЧЕ ПлатежныйОрдерПоступлениеДС.КурсВзаиморасчетов
	|		КОНЕЦ КАК КурсВзаиморасчетов,
	|		ПлатежныйОрдерПоступлениеДС.Ссылка.Дата КАК Дата,
	|		ПлатежныйОрдерПоступлениеДС.НомерСтроки КАК НомерСтроки,
	|		ПлатежныйОрдерПоступлениеДС.Ссылка.ВалютаДокумента КАК ВалютаДокумента
	|	ИЗ
	|		Документ.ПлатежныйОрдерПоступлениеДенежныхСредств.РасшифровкаПлатежа КАК ПлатежныйОрдерПоступлениеДС
	|	ГДЕ
	|		ПлатежныйОрдерПоступлениеДС.Ссылка.Дата МЕЖДУ &НачПериода И &КонПериода
	|		И ПлатежныйОрдерПоступлениеДС.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПрочееПоступлениеБезналичныхДенежныхСредств)
	|		И ПлатежныйОрдерПоступлениеДС.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ИнкассацияДенежныхСредств)
	|		И ПлатежныйОрдерПоступлениеДС.Ссылка.Проведен
	|		И ПлатежныйОрдерПоступлениеДС.Ссылка.Организация = &Организация
	|		И ПлатежныйОрдерПоступлениеДС.Ссылка.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение
	|		И ПлатежныйОрдерПоступлениеДС.Ссылка.ВалютаДокумента <> &ВалютаРегламентированногоУчета
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ПлатОрдерСписаниеДС.Ссылка,
	|		ПлатОрдерСписаниеДС.КурсВзаиморасчетов,
	|		ПлатОрдерСписаниеДС.Ссылка.Дата,
	|		ПлатОрдерСписаниеДС.НомерСтроки,
	|		ПлатОрдерСписаниеДС.Ссылка.ВалютаДокумента
	|	ИЗ
	|		Документ.ПлатежныйОрдерСписаниеДенежныхСредств.РасшифровкаПлатежа КАК ПлатОрдерСписаниеДС
	|	ГДЕ
	|		ПлатОрдерСписаниеДС.Ссылка.Дата МЕЖДУ &НачПериода И &КонПериода
	|		И ПлатОрдерСписаниеДС.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ПрочееСписаниеБезналичныхДенежныхСредств)
	|		И ПлатОрдерСписаниеДС.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ПеречислениеЗаработнойПлаты)
	|		И ПлатОрдерСписаниеДС.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ПереводНаДругойСчет)
	|		И ПлатОрдерСписаниеДС.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ПеречислениеНалога)
	|		И ПлатОрдерСписаниеДС.Ссылка.Проведен
	|		И ПлатОрдерСписаниеДС.Ссылка.Организация = &Организация
	|		И ПлатОрдерСписаниеДС.Ссылка.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение
	|		И ПлатОрдерСписаниеДС.Ссылка.ВалютаДокумента <> &ВалютаРегламентированногоУчета
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ПлатежноеПоручениеВходящее.Ссылка,
	|		ВЫБОР
	|			КОГДА ПлатежноеПоручениеВходящее.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПоступленияОтПродажиИностраннойВалюты)
	|					ИЛИ ПлатежноеПоручениеВходящее.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПриобретениеИностраннойВалюты)
	|				ТОГДА ПлатежноеПоручениеВходящее.Ссылка.КурсНаДатуПриобретенияРеализацииВалюты
	|			ИНАЧЕ ПлатежноеПоручениеВходящее.КурсВзаиморасчетов
	|		КОНЕЦ,
	|		ПлатежноеПоручениеВходящее.Ссылка.Дата,
	|		ПлатежноеПоручениеВходящее.НомерСтроки,
	|		ПлатежноеПоручениеВходящее.Ссылка.ВалютаДокумента
	|	ИЗ
	|		Документ.ПлатежноеПоручениеВходящее.РасшифровкаПлатежа КАК ПлатежноеПоручениеВходящее
	|	ГДЕ
	|		ПлатежноеПоручениеВходящее.Ссылка.Дата МЕЖДУ &НачПериода И &КонПериода
	|		И ПлатежноеПоручениеВходящее.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПрочееПоступлениеБезналичныхДенежныхСредств)
	|		И ПлатежноеПоручениеВходящее.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ВозвратЗаработнойПлаты)
	|		И ПлатежноеПоручениеВходящее.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ВозвратПенсионныхВзносов)
	|		И ПлатежноеПоручениеВходящее.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ВозвратСоциальныхОтчислений)
	|		И ПлатежноеПоручениеВходящее.Ссылка.Проведен
	|		И ПлатежноеПоручениеВходящее.Ссылка.ВалютаДокумента <> &ВалютаРегламентированногоУчета
	|		И ПлатежноеПоручениеВходящее.Ссылка.Организация = &Организация
	|		И ПлатежноеПоручениеВходящее.Ссылка.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ПлатПорИсхРасшифровкаПлатежа.Ссылка,
	|		ПлатПорИсхРасшифровкаПлатежа.КурсВзаиморасчетов,
	|		ПлатПорИсхРасшифровкаПлатежа.Ссылка.Дата,
	|		ПлатПорИсхРасшифровкаПлатежа.НомерСтроки,
	|		ПлатПорИсхРасшифровкаПлатежа.Ссылка.ВалютаДокумента
	|	ИЗ
	|		Документ.ПлатежноеПоручениеИсходящее.РасшифровкаПлатежа КАК ПлатПорИсхРасшифровкаПлатежа
	|	ГДЕ
	|		ПлатПорИсхРасшифровкаПлатежа.Ссылка.Дата МЕЖДУ &НачПериода И &КонПериода
	|		И (ПлатПорИсхРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийППИсходящее.ОплатаПоставщику)
	|				ИЛИ ПлатПорИсхРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийППИсходящее.ВозвратДенежныхСредствПокупателю)
	|				ИЛИ ПлатПорИсхРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийППИсходящее.ОплатаСтруктурномуПодразделению)
	|				ИЛИ ПлатПорИсхРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийППИсходящее.ПрочиеРасчетыСКонтрагентами)
	|				ИЛИ ПлатПорИсхРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийППИсходящее.РасчетыПоКредитамИЗаймамСКонтрагентами))
	|		И ПлатПорИсхРасшифровкаПлатежа.Ссылка.Проведен
	|		И ПлатПорИсхРасшифровкаПлатежа.Ссылка.Организация = &Организация
	|		И ПлатПорИсхРасшифровкаПлатежа.Ссылка.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение
	|		И ПлатПорИсхРасшифровкаПлатежа.Ссылка.ВалютаДокумента <> &ВалютаРегламентированногоУчета
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ПКОРасшифровкаПлатежа.Ссылка,
	|		ПКОРасшифровкаПлатежа.КурсВзаиморасчетов,
	|		ПКОРасшифровкаПлатежа.Ссылка.Дата,
	|		ПКОРасшифровкаПлатежа.НомерСтроки,
	|		ПКОРасшифровкаПлатежа.Ссылка.ВалютаДокумента
	|	ИЗ
	|		Документ.ПриходныйКассовыйОрдер.РасшифровкаПлатежа КАК ПКОРасшифровкаПлатежа
	|	ГДЕ
	|		ПКОРасшифровкаПлатежа.Ссылка.Проведен
	|		И ПКОРасшифровкаПлатежа.Ссылка.Дата МЕЖДУ &НачПериода И &КонПериода
	|		И ПКОРасшифровкаПлатежа.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПКО.ПолучениеНаличныхДенежныхСредствВБанке)
	|		И ПКОРасшифровкаПлатежа.Ссылка.ВидОперации <> ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПКО.ПриходДенежныхСредствПрочее)
	|		И ПКОРасшифровкаПлатежа.Ссылка.Организация = &Организация
	|		И ПКОРасшифровкаПлатежа.Ссылка.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение
	|		И ПКОРасшифровкаПлатежа.Ссылка.ВалютаДокумента <> &ВалютаРегламентированногоУчета
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		РКОРасшифровкаПлатежа.Ссылка,
	|		РКОРасшифровкаПлатежа.КурсВзаиморасчетов,
	|		РКОРасшифровкаПлатежа.Ссылка.Дата,
	|		РКОРасшифровкаПлатежа.НомерСтроки,
	|		РКОРасшифровкаПлатежа.Ссылка.ВалютаДокумента
	|	ИЗ
	|		Документ.РасходныйКассовыйОрдер.РасшифровкаПлатежа КАК РКОРасшифровкаПлатежа
	|	ГДЕ
	|		РКОРасшифровкаПлатежа.Ссылка.Дата МЕЖДУ &НачПериода И &КонПериода
	|		И (РКОРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРКО.ОплатаПоставщику)
	|				ИЛИ РКОРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРКО.ВозвратДенежныхСредствПокупателю)
	|				ИЛИ РКОРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРКО.ОплатаСтруктурномуПодразделению)
	|				ИЛИ РКОРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРКО.РасчетыПоДоходуОтРазовыхВыплатСКонтрагентами)
	|				ИЛИ РКОРасшифровкаПлатежа.Ссылка.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРКО.РасчетыПоКредитамИЗаймамСКонтрагентами))
	|		И РКОРасшифровкаПлатежа.Ссылка.Проведен
	|		И РКОРасшифровкаПлатежа.Ссылка.Организация = &Организация
	|		И РКОРасшифровкаПлатежа.Ссылка.СтруктурноеПодразделениеОтправитель = &СтруктурноеПодразделение
	|		И РКОРасшифровкаПлатежа.Ссылка.ВалютаДокумента <> &ВалютаРегламентированногоУчета) КАК ПлатежныеДокументы
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ПлатежныеДокументы.Ссылка КАК Документ,
	|	ПлатежныеДокументы.НомерСтроки,
	|	ПлатежныеДокументы.ВалютаДокумента,
	|	ПлатежныеДокументы.КурсВзаиморасчетов,
	|	ЕСТЬNULL(КурсыВалют.Курс, 1) КАК УстановленныйКурс
	|ИЗ
	|	БанковскиеДокументы КАК ПлатежныеДокументы
	|		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			Док.Ссылка КАК Ссылка,
	|			Док.ВалютаДокумента КАК ВалютаДокумента,
	|			МАКСИМУМ(КурсыВалют.Период) КАК Период
	|		ИЗ
	|			БанковскиеДокументы КАК Док
	|				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют КАК КурсыВалют
	|				ПО Док.Дата >= КурсыВалют.Период
	|					И Док.ВалютаДокумента = КурсыВалют.Валюта
	|		
	|		СГРУППИРОВАТЬ ПО
	|			Док.Ссылка,
	|			Док.ВалютаДокумента) КАК ВложенныйЗапрос
	|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют КАК КурсыВалют
	|			ПО ВложенныйЗапрос.Период = КурсыВалют.Период
	|				И ВложенныйЗапрос.ВалютаДокумента = КурсыВалют.Валюта
	|		ПО ПлатежныеДокументы.Ссылка = ВложенныйЗапрос.Ссылка
	|ГДЕ
	|	КурсыВалют.Курс <> ПлатежныеДокументы.КурсВзаиморасчетов
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПлатежныеДокументы.Дата";
	   
	Запрос.УстановитьПараметр("ВалютаРегламентированногоУчета", Константы.ВалютаРегламентированногоУчета.Получить());
	Запрос.УстановитьПараметр("НачПериода"					  , ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("КонПериода"					  , КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация"					  , ПараметрыОтчета.Организация); 
	Запрос.УстановитьПараметр("СтруктурноеПодразделение"	  , ПараметрыОтчета.СтруктурноеПодразделение); 

	Результат = Запрос.Выполнить();
	
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("РазницаКурсовВБанковскихДокументахРезультатЗапроса", Результат);
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("НомерСтроки", "Номер строки в ТЧ ""Расшифровка платежа""");
		СтруктураЗаголовков.Вставить("КурсВзаиморасчетов", "Курс взаиморасчетов из документа");
		СтруктураЗаголовков.Вставить("УстановленныйКурс",  "Установленный курс из регистра сведений ""Курсы валют""");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("РазницаКурсовВБанковскихДокументахСтруктураЗаголовков", СтруктураЗаголовков);
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Документ", "Документ");			
		ПараметрыОтчета.ИсходящиеДанные.Вставить("РазницаКурсовВБанковскихДокументахСтруктураРасшифровки", СтруктураРасшифровки);
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоСоответствиеСтатейДДСПоВидамОпераций(СтрокаПравила, ПараметрыОтчета)
		
	Запрос = Новый Запрос;
	
	Запрос.Текст="ВЫБРАТЬ РАЗРЕШЕННЫЕ
	             |	ТиповойОбороты.Субконто1 КАК СтатьяДДС,
	             |	ТиповойОбороты.Счет КАК СЧЕТ,
	             |	ТиповойОбороты.Регистратор КАК Документ,
	             |	ТиповойОбороты.Субконто1.ВидДвижения КАК ВидДвиженияПоРегистратору,
	             |	ВЫБОР
	             |		КОГДА ТиповойОбороты.Счет.Валютный
	             |					И НЕ ЕСТЬNULL(ТиповойОбороты.ВалютнаяСуммаОборотДт, 0) = 0
	             |				ИЛИ НЕ ТиповойОбороты.Счет.Валютный
	             |					И НЕ ЕСТЬNULL(ТиповойОбороты.СуммаОборотДт, 0) = 0
	             |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийДенежныхСредств.Поступление)
	             |		КОГДА ТиповойОбороты.Счет.Валютный
	             |					И НЕ ЕСТЬNULL(ТиповойОбороты.ВалютнаяСуммаОборотКт, 0) = 0
	             |				ИЛИ НЕ ТиповойОбороты.Счет.Валютный
	             |					И НЕ ЕСТЬNULL(ТиповойОбороты.СуммаОборотКт, 0) = 0
	             |			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийДенежныхСредств.Выбытие)
	             |	КОНЕЦ КАК ВидДвиженияПравильный
	             |ИЗ
	             |	РегистрБухгалтерии.Типовой.Обороты(
	             |			&ДатаНач,
	             |			&ДатаКон,
	             |			Регистратор,
	             |			Счет В ИЕРАРХИИ (&ДенежныеСредства),
	             |			&СтатьяДвиженияДенежныхСредств,
	             |			Организация = &Организация
	             |				И СтруктурноеПодразделение = &СтруктурноеПодразделение
	             |				И СтруктурноеПодразделениеКор = &СтруктурноеПодразделениеКор,
	             |			,
	             |			) КАК ТиповойОбороты
	             |ГДЕ
	             |	ТиповойОбороты.Субконто1.ВидДвижения <> ВЫБОР
	             |			КОГДА ТиповойОбороты.Счет.Валютный
	             |						И НЕ ЕСТЬNULL(ТиповойОбороты.ВалютнаяСуммаОборотДт, 0) = 0
	             |					ИЛИ НЕ ТиповойОбороты.Счет.Валютный
	             |						И НЕ ЕСТЬNULL(ТиповойОбороты.СуммаОборотДт, 0) = 0
	             |				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийДенежныхСредств.Поступление)
	             |			КОГДА ТиповойОбороты.Счет.Валютный
	             |						И НЕ ЕСТЬNULL(ТиповойОбороты.ВалютнаяСуммаОборотКт, 0) = 0
	             |					ИЛИ НЕ ТиповойОбороты.Счет.Валютный
	             |						И НЕ ЕСТЬNULL(ТиповойОбороты.СуммаОборотКт, 0) = 0
	             |				ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийДенежныхСредств.Выбытие)
	             |		КОНЕЦ"; 
				 
	Запрос.УстановитьПараметр("ДенежныеСредства"			 , ПланыСчетов.Типовой.ДенежныеСредства);
	Запрос.УстановитьПараметр("ДатаНач"						 , ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон"						 , КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("СтатьяДвиженияДенежныхСредств", ПланыВидовХарактеристик.ВидыСубконтоТиповые.СтатьиДвиженияДенежныхСредств);
	Запрос.УстановитьПараметр("Организация"					 , ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение"	 , ПараметрыОтчета.СтруктурноеПодразделение);
	Запрос.УстановитьПараметр("СтруктурноеПодразделениеКор"	 , ПараметрыОтчета.СтруктурноеПодразделение);
	
	Результат = Запрос.Выполнить();
	
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("СоответствиеСтатейДДСПоВидамОперацийРезультатЗапроса", Результат);
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("СтатьяДДС", "Статья ДДС");
		СтруктураЗаголовков.Вставить("ВидДвиженияПоРегистратору", "Вид движения, указанный в статье ДДС");
		СтруктураЗаголовков.Вставить("ВидДвиженияПравильный",  "Вид движения, который необходимо установить в статье ДДС");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("СоответствиеСтатейДДСПоВидамОперацийСтруктураЗаголовков", СтруктураЗаголовков);
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Документ", "Документ");			
		ПараметрыОтчета.ИсходящиеДанные.Вставить("СоответствиеСтатейДДСПоВидамОперацийСтруктураРасшифровки", СтруктураРасшифровки);
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоЗаполнениеРеквизитаСтатьяДДСВДокументах(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
		
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ТиповойОбороты.Регистратор КАК Документ
	|ИЗ
	|	РегистрБухгалтерии.Типовой.Обороты(
	|			&ДатаНач,
	|			&ДатаКон,
	|			Регистратор,
	|			Счет В ИЕРАРХИИ (&ДенежныеСредства),
	|			&СтатьяДвиженияДенежныхСредств,
	|			Организация = &Организация
	|				И СтруктурноеПодразделение = &СтруктурноеПодразделение
	|				И СтруктурноеПодразделениеКор = &СтруктурноеПодразделениеКор,
	|			,
	|			) КАК ТиповойОбороты
	|ГДЕ
	|	ТиповойОбороты.Субконто1 = ЗНАЧЕНИЕ(Справочник.СтатьиДвиженияДенежныхСредств.ПустаяСсылка)
	|	И ТИПЗНАЧЕНИЯ(ТиповойОбороты.Регистратор) <> ТИП(Документ.ЗакрытиеМесяца)
	|	И ТИПЗНАЧЕНИЯ(ТиповойОбороты.Регистратор) <> ТИП(Документ.ЧекККМ)";
	
	// В документе ЗакрытиеМесяца при переоценки валютных сумм бывают ситуации,
	// когда не заполняются статьи движения денежных средств. Данные ситуации являются корректными.
	// Поэтому документы ЗакрытиеМесяца исключаются из проверки.
	
	Запрос.УстановитьПараметр("ДенежныеСредства"			 , ПланыСчетов.Типовой.ДенежныеСредства);
	Запрос.УстановитьПараметр("ДатаНач"						 , ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон"						 , КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("СтатьяДвиженияДенежныхСредств", ПланыВидовХарактеристик.ВидыСубконтоТиповые.СтатьиДвиженияДенежныхСредств);
	Запрос.УстановитьПараметр("Организация"					 , ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение"	 , ПараметрыОтчета.СтруктурноеПодразделение);
	Запрос.УстановитьПараметр("СтруктурноеПодразделениеКор"	 , ПараметрыОтчета.СтруктурноеПодразделение);
	
	Результат = Запрос.Выполнить();
	
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ЗаполнениеРеквизитаСтатьяДДСВДокументахРезультатЗапроса", Результат);	
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Документ", "Документ");			
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ЗаполнениеРеквизитаСтатьяДДСВДокументахСтруктураРасшифровки", СтруктураРасшифровки);

	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоЗаполнениеРеквизитовВСправочникеСтатьиДДС(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
		
	Запрос.Текст= "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	              |	СтатьиДвиженияДенежныхСредств.Ссылка КАК Элемент,
	              |	ВЫБОР
	              |		КОГДА СтатьиДвиженияДенежныхСредств.Наименование = """"
	              |			ТОГДА ""-""
	              |		ИНАЧЕ ""+""
	              |	КОНЕЦ КАК Наименование,
	              |	ВЫБОР
	              |		КОГДА СтатьиДвиженияДенежныхСредств.РазрезДеятельности = ЗНАЧЕНИЕ(Перечисление.РазрезыДеятельности.ПустаяСсылка)
	              |			ТОГДА ""-""
	              |		ИНАЧЕ ""+""
	              |	КОНЕЦ КАК РазрезДеятельности,
	              |	ВЫБОР
	              |		КОГДА СтатьиДвиженияДенежныхСредств.ВидДвижения = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийДенежныхСредств.ПустаяСсылка)
	              |			ТОГДА ""-""
	              |		ИНАЧЕ ""+""
	              |	КОНЕЦ КАК ВидДвижения,
	              |	ВЫБОР
	              |		КОГДА СтатьиДвиженияДенежныхСредств.ДвижениеДенежныхСредств = ЗНАЧЕНИЕ(Справочник.ДвиженияДенежныхСредств.ПустаяССылка)
	              |			ТОГДА ""-""
	              |		ИНАЧЕ ""+""
	              |	КОНЕЦ КАК ДвижениеДенежныхСредств
	              |ИЗ
	              |	Справочник.СтатьиДвиженияДенежныхСредств КАК СтатьиДвиженияДенежныхСредств
	              |ГДЕ
	              |	НЕ СтатьиДвиженияДенежныхСредств.ЭтоГруппа
	              |	И НЕ СтатьиДвиженияДенежныхСредств.ПометкаУдаления
	              |	И (ВЫБОР
	              |				КОГДА СтатьиДвиженияДенежныхСредств.Наименование = """"
	              |					ТОГДА ИСТИНА
	              |				ИНАЧЕ ЛОЖЬ
	              |			КОНЕЦ
	              |			ИЛИ ВЫБОР
	              |				КОГДА СтатьиДвиженияДенежныхСредств.РазрезДеятельности = ЗНАЧЕНИЕ(Перечисление.РазрезыДеятельности.ПустаяСсылка)
	              |					ТОГДА ИСТИНА
	              |				ИНАЧЕ ЛОЖЬ
	              |			КОНЕЦ
	              |			ИЛИ ВЫБОР
	              |				КОГДА СтатьиДвиженияДенежныхСредств.ВидДвижения = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийДенежныхСредств.ПустаяСсылка)
	              |					ТОГДА ИСТИНА
	              |				ИНАЧЕ ЛОЖЬ
	              |			КОНЕЦ
	              |			ИЛИ ВЫБОР
	              |				КОГДА СтатьиДвиженияДенежныхСредств.ДвижениеДенежныхСредств = ЗНАЧЕНИЕ(Справочник.ДвиженияДенежныхСредств.ПустаяССылка)
	              |					ТОГДА ИСТИНА
	              |				ИНАЧЕ ЛОЖЬ
	              |			КОНЕЦ)";
	             			 
	Результат = Запрос.Выполнить();
	
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ЗаполнениеРеквизитовВСправочникеСтатьиДДСРезультатЗапроса", Результат);		
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("РазрезДеятельности", "Заполнен реквизит ""Разрез деятельности""");
		СтруктураЗаголовков.Вставить("ВидДвижения",       "Заполнен реквизит ""Вид движения""");
		СтруктураЗаголовков.Вставить("ДвижениеДенежныхСредств",  "Заполнен реквизит ""Движение денежных средств""");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ЗаполнениеРеквизитовВСправочникеСтатьиДДССтруктураЗаголовков", СтруктураЗаголовков);

	КонецЕсли; 
	
КонецПроцедуры

// Зарплата

Процедура ПроверитьПравилоЗаполненностьРегКалендаря(СтрокаПравила, ПараметрыОтчета)
	
	КалендарьЗаполнен = ПроцедурыУправленияПерсоналомСервер.РегламентированныйКалендарьЗаполнен(НачалоМесяца(ПараметрыОтчета.ДатаНач), КонецМесяца(ПараметрыОтчета.ДатаКон));
	
	ПараметрыОтчета.ИсходящиеДанные.Вставить("ЗаполненностьРегКалендаря", КалендарьЗаполнен);
		
	СтрокаПравила.ОбнаруженыОшибки  = НЕ КалендарьЗаполнен;
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
КонецПроцедуры

Процедура ПроверитьПравилоОтражениеЗПРегУч(СтрокаПравила, ПараметрыОтчета)
	
	МенеджерВТ = Новый МенеджерВременныхТаблиц;
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВТ;
	Налоги = Справочники.НалогиСборыОтчисления;
	Типовой = ПланыСчетов.Типовой;
	
	Запрос.УстановитьПараметр("СчетСО", ?(НЕ ЗначениеЗаполнено(Налоги.ОбязательныеСоциальныеОтчисления.СчетУчетаРасчетовСКонтрагентомБУ), Типовой.ОбязательстваПоСоциальномуСтрахованию, Налоги.ОбязательныеСоциальныеОтчисления.СчетУчетаРасчетовСКонтрагентомБУ));
	Запрос.УстановитьПараметр("СчетОПВ", ?(НЕ ЗначениеЗаполнено(Налоги.ОбязательныеПенсионныеВзносы.СчетУчетаРасчетовСКонтрагентомБУ), Типовой.ОбязательстваПоПенсионнымОтчислениям, Налоги.ОбязательныеПенсионныеВзносы.СчетУчетаРасчетовСКонтрагентомБУ));
	Запрос.УстановитьПараметр("СчетИПН", ?(НЕ ЗначениеЗаполнено(Налоги.ИндивидуальныйПодоходныйНалог.СчетУчетаРасчетовСКонтрагентомБУ), Типовой.ИндивидуальныйПодоходныйНалог, Налоги.ИндивидуальныйПодоходныйНалог.СчетУчетаРасчетовСКонтрагентомБУ));
	Запрос.УстановитьПараметр("СчетСН", ?(НЕ ЗначениеЗаполнено(Налоги.СоциальныйНалог.СчетУчетаРасчетовСКонтрагентомБУ), Типовой.СоциальныйНалог, Налоги.СоциальныйНалог.СчетУчетаРасчетовСКонтрагентомБУ));
	Запрос.УстановитьПараметр("СчетОППВ", ?(НЕ ЗначениеЗаполнено(Налоги.ОбязательныеПрофессиональныеПенсионныеВзносы.СчетУчетаРасчетовСКонтрагентомБУ), Типовой.ОбязательстваПоПенсионнымОтчислениям, Налоги.ОбязательныеПрофессиональныеПенсионныеВзносы.СчетУчетаРасчетовСКонтрагентомБУ));
	Запрос.УстановитьПараметр("СчетВОСМС", ?(НЕ ЗначениеЗаполнено(Налоги.ВзносыОбязательноеСоциальноеМедицинскоеСтрахование.СчетУчетаРасчетовСКонтрагентомБУ), Типовой.ОбязательстваПоВзносамОСМС, Налоги.ВзносыОбязательноеСоциальноеМедицинскоеСтрахование.СчетУчетаРасчетовСКонтрагентомБУ));
	Запрос.УстановитьПараметр("СчетООСМС", ?(НЕ ЗначениеЗаполнено(Налоги.ОтчисленияОбязательноеСоциальноеМедицинскоеСтрахование.СчетУчетаРасчетовСКонтрагентомБУ), Типовой.ОбязательстваПоОтчислениямОСМС, Налоги.ОтчисленияОбязательноеСоциальноеМедицинскоеСтрахование.СчетУчетаРасчетовСКонтрагентомБУ));
	
	Запрос.УстановитьПараметр("ДатаНач", ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация", 	ПараметрыОтчета.Организация);
	
	ДанныеЗПТекст = 
	"ВЫБРАТЬ
	|	Начисления.Ссылка.Организация КАК Организация,
	|	Начисления.Ссылка.ПериодРегистрации КАК ПериодРегистрации,
	|	Начисления.Физлицо КАК Физлицо,
	|	Начисления.Результат КАК Начислено,
	|	0 КАК НачисленоБух,
	|	Начисления.Результат КАК РазностьНачислено,
	|	0 КАК ИПН,
	|	0 КАК ИПНБух,
	|	0 КАК РазностьИПН,
	|	0 КАК ОПВ,
	|	0 КАК ОПВБух,
	|	0 КАК РазностьОПВ,
	|	0 КАК Удержано,
	|	0 КАК УдержаноБух,
	|	0 КАК РазностьУдержано,
	|	0 КАК СоциальныеОтчисления,
	|	0 КАК СоциальныеОтчисленияБух,
	|	0 КАК РазностьСоциальныеОтчисления,
	|	0 КАК СоциальныйНалог,
	|	0 КАК СоциальныйНалогБух,
	|	0 КАК РазностьСоциальныйНалог,
	|	0 КАК ОППВ,
	|	0 КАК ОППВБух,
	|	0 КАК РазностьОППВ,
	|	0 КАК ВОСМС,
	|	0 КАК ВОСМСБух,
	|	0 КАК РазностьВОСМС,
	|	0 КАК ООСМС,
	|	0 КАК ООСМСБух,
	|	0 КАК РазностьООСМС,
	|	0 КАК ПениОПВ,
	|	0 КАК ПениОПВБух,
	|	0 КАК РазностьПениОПВ,
	|	0 КАК ПениСО,
	|	0 КАК ПениСОБух,
	|	0 КАК РазностьПениСО,
	|	0 КАК ПениОППВ,
	|	0 КАК ПениОППВБух,
	|	0 КАК РазностьПениОППВ,
	|	0 КАК ПениВОСМС,
	|	0 КАК ПениВОСМСБух,
	|	0 КАК РазностьПениВОСМС,
	|	0 КАК ПениООСМС,
	|	0 КАК ПениООСМСБух,
	|	0 КАК РазностьПениООСМС
	|ПОМЕСТИТЬ ДанныеЗП
	|ИЗ
	|	Документ.НачислениеЗарплатыРаботникамОрганизаций.Начисления КАК Начисления
	|ГДЕ
	|	Начисления.Ссылка.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	|	И Начисления.Ссылка.Проведен
	|	И Начисления.Результат <> 0
	|	И Начисления.Ссылка.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ИПНСведенияОДоходах.Организация,
	|	НАЧАЛОПЕРИОДА(ИПНСведенияОДоходах.ПериодРегистрации, МЕСЯЦ),
	|	ИПНСведенияОДоходах.ФизЛицо,
	|	ИПНСведенияОДоходах.СуммаДохода,
	|	0,
	|	ИПНСведенияОДоходах.СуммаДохода,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	РегистрНакопления.ИПНСведенияОДоходах КАК ИПНСведенияОДоходах
	|ГДЕ
	|	ИПНСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	|	И ИПНСведенияОДоходах.Регистратор ССЫЛКА Документ.РегистрацияПрочихДоходовВЦеляхНалогообложения
	|	И ИПНСведенияОДоходах.Регистратор.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияПрочихДоходов.ДоходыКонтрагентов)
	|	И ИПНСведенияОДоходах.ФизЛицо ССЫЛКА Справочник.Контрагенты
	|	И ИПНСведенияОДоходах.СуммаДохода <> 0
	|	И ИПНСведенияОДоходах.Организация В (&Организация)	
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Удержания.Ссылка.Организация,
	|	Удержания.Ссылка.ПериодРегистрации,
	|	Удержания.ФизЛицо,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	Удержания.Результат,
	|	0,
	|	Удержания.Результат,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	Документ.РасчетУдержанийРаботниковОрганизаций.Удержания КАК Удержания
	|ГДЕ
	|	Удержания.Ссылка.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	|	И Удержания.Ссылка.Проведен
	|	И Удержания.Результат <> 0
	|	И Удержания.Ссылка.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Удержания.Ссылка.Организация,
	|	Удержания.Ссылка.ПериодРегистрации,
	|	Удержания.Физлицо,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	Удержания.Результат,
	|	0,
	|	Удержания.Результат,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	Документ.РегистрацияРазовыхУдержанийРаботниковОрганизаций.Удержания КАК Удержания
	|ГДЕ
	|	Удержания.Ссылка.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	|	И Удержания.Ссылка.Проведен
	|	И Удержания.Результат <> 0
	|	И Удержания.Ссылка.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ИПНРасчетыСБюджетом.Организация,
	|	НАЧАЛОПЕРИОДА(ИПНРасчетыСБюджетом.Период, МЕСЯЦ),
	|	ИПНРасчетыСБюджетом.ФизЛицо,
	|	0,
	|	0,
	|	0,
	|	ИПНРасчетыСБюджетом.Налог,
	|	0,
	|	ИПНРасчетыСБюджетом.Налог,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	РегистрНакопления.ИПНРасчетыСБюджетом КАК ИПНРасчетыСБюджетом
	|ГДЕ
	|	ИПНРасчетыСБюджетом.Период МЕЖДУ &ДатаНач И &ДатаКон
	|	И ИПНРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И ИПНРасчетыСБюджетом.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
	|	И НЕ ИПНРасчетыСБюджетом.НеОтражатьВРеглУчете
	|	И ИПНРасчетыСБюджетом.Налог <> 0
	|	И ИПНРасчетыСБюджетом.Организация В (&Организация)
	
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОПВРасчетыСФондами.Организация,
	|	НАЧАЛОПЕРИОДА(ОПВРасчетыСФондами.Период, МЕСЯЦ),
	|	ОПВРасчетыСФондами.ФизЛицо,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА ОПВРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОПВРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОПВРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОПВРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА ОПВРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОПВРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОПВРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОПВРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	РегистрНакопления.ОПВРасчетыСФондами КАК ОПВРасчетыСФондами
	|ГДЕ
	|	ОПВРасчетыСФондами.Период МЕЖДУ &ДатаНач И &ДатаКон
	|	И ОПВРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И ОПВРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
	|	И НЕ ОПВРасчетыСФондами.НеОтражатьВРеглУчете
	|	И ОПВРасчетыСФондами.Взнос <> 0
	|	И ОПВРасчетыСФондами.Организация В (&Организация)	
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СОРасчетыСФондами.Организация,
	|	НАЧАЛОПЕРИОДА(СОРасчетыСФондами.Период, МЕСЯЦ),
	|	СОРасчетыСФондами.ФизЛицо,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА СОРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА СОРасчетыСФондами.Отчисление
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА СОРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА СОРасчетыСФондами.Отчисление
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА СОРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА СОРасчетыСФондами.Отчисление
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА СОРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА СОРасчетыСФондами.Отчисление
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	РегистрНакопления.СОРасчетыСФондами КАК СОРасчетыСФондами
	|ГДЕ
	|	СОРасчетыСФондами.Период МЕЖДУ &ДатаНач И &ДатаКон
	|	И СОРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И СОРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
	|	И СОРасчетыСФондами.Отчисление <> 0
	|	И СОРасчетыСФондами.Организация В (&Организация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СНИсчисленный.Организация,
	|	НАЧАЛОПЕРИОДА(СНИсчисленный.Период, МЕСЯЦ),
	|	СНИсчисленный.ФизЛицо,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	СНИсчисленный.Налог,
	|	0,
	|	СНИсчисленный.Налог,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	РегистрНакопления.СНИсчисленный КАК СНИсчисленный
	|ГДЕ
	|	СНИсчисленный.Период МЕЖДУ &ДатаНач И &ДатаКон
	|	И НЕ СНИсчисленный.НеОтражатьВРеглУчете
	|	И СНИсчисленный.Налог <> 0
	|	И СНИсчисленный.Организация В (&Организация)	
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОППВРасчетыСФондами.Организация,
	|	НАЧАЛОПЕРИОДА(ОППВРасчетыСФондами.Период, МЕСЯЦ),
	|	ОППВРасчетыСФондами.ФизЛицо,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА ОППВРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОППВРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОППВРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОППВРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА ОППВРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОППВРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОППВРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОППВРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	РегистрНакопления.ОППВРасчетыСФондами КАК ОППВРасчетыСФондами
	|ГДЕ
	|	ОППВРасчетыСФондами.Период МЕЖДУ &ДатаНач И &ДатаКон
	|	И ОППВРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И ОППВРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
	|	И ОППВРасчетыСФондами.Взнос <> 0
	|	И ОППВРасчетыСФондами.Организация В (&Организация)	
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВОСМСРасчетыСФондами.Организация,
	|	НАЧАЛОПЕРИОДА(ВОСМСРасчетыСФондами.Период, МЕСЯЦ),
	|	ВОСМСРасчетыСФондами.ФизЛицо,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА ВОСМСРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ВОСМСРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ВОСМСРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ВОСМСРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА ВОСМСРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ВОСМСРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ВОСМСРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ВОСМСРасчетыСФондами.Взнос
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	РегистрНакопления.ВОСМСРасчетыСФондами КАК ВОСМСРасчетыСФондами
	|ГДЕ
	|	ВОСМСРасчетыСФондами.Период МЕЖДУ &ДатаНач И &ДатаКон
	|	И ВОСМСРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И ВОСМСРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
	|	И НЕ ВОСМСРасчетыСФондами.НеОтражатьВРеглУчете
	|	И ВОСМСРасчетыСФондами.Взнос <> 0
	|	И ВОСМСРасчетыСФондами.Организация В (&Организация)	
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ООСМСРасчетыСФондами.Организация,
	|	НАЧАЛОПЕРИОДА(ООСМСРасчетыСФондами.Период, МЕСЯЦ),
	|	ООСМСРасчетыСФондами.ФизЛицо,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА ООСМСРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ООСМСРасчетыСФондами.Отчисление
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ООСМСРасчетыСФондами.ВидПлатежа = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ООСМСРасчетыСФондами.Отчисление
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	0,
	|	ВЫБОР
	|		КОГДА ООСМСРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ООСМСРасчетыСФондами.Отчисление
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ООСМСРасчетыСФондами.ВидПлатежа <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ООСМСРасчетыСФондами.Отчисление
	|		ИНАЧЕ 0
	|	КОНЕЦ
	|ИЗ
	|	РегистрНакопления.ООСМСРасчетыСФондами КАК ООСМСРасчетыСФондами
	|ГДЕ
	|	ООСМСРасчетыСФондами.Период МЕЖДУ &ДатаНач И &ДатаКон
	|	И ООСМСРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	И ООСМСРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
	|	И ООСМСРасчетыСФондами.Отчисление <> 0
	|	И ООСМСРасчетыСФондами.Организация В (&Организация)
	
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ОтражениеВУчете.Ссылка.Организация,
	|	НАЧАЛОПЕРИОДА(ОтражениеВУчете.Ссылка.ПериодРегистрации, МЕСЯЦ),
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СубконтоДт1 ССЫЛКА Справочник.Контрагенты
	|				И ОтражениеВУчете.СубконтоДт1 <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ВЫРАЗИТЬ(ОтражениеВУчете.СубконтоДт1 КАК Справочник.Контрагенты)
	|		КОГДА ОтражениеВУчете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СубконтоКт1 ССЫЛКА Справочник.Контрагенты
	|				И ОтражениеВУчете.СубконтоКт1 <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ВЫРАЗИТЬ(ОтражениеВУчете.СубконтоКт1 КАК Справочник.Контрагенты)
	|		ИНАЧЕ ОтражениеВУчете.ФизЛицо
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		КОГДА ОтражениеВУчете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СубконтоКт1 ССЫЛКА Справочник.Контрагенты
	|				И ОтражениеВУчете.СубконтоКт1 <> НЕОПРЕДЕЛЕНО
	|				И ОтражениеВУчете.СубконтоКт1 <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		КОГДА ОтражениеВУчете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СубконтоКт1 ССЫЛКА Справочник.Контрагенты
	|				И ОтражениеВУчете.СубконтоКт1 <> НЕОПРЕДЕЛЕНО
	|				И ОтражениеВУчете.СубконтоКт1 <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетИПН
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетИПН
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.ФизЛицо = ОтражениеВУчете.Ссылка.Организация.ИндивидуальныйПредприниматель
	|				И ОтражениеВУчете.СчетКт = &СчетОПВ
	|				И ОтражениеВУчете.СубконтоКт2 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		КОГДА ОтражениеВУчете.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт = &СчетОПВ
	|				И ОтражениеВУчете.СубконтоКт2 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		КОГДА ОтражениеВУчете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт = &СчетОПВ
	|				И ОтражениеВУчете.СубконтоКт2 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|				И ОтражениеВУчете.СубконтоДт1 ССЫЛКА Справочник.Контрагенты
	|				И ОтражениеВУчете.СубконтоДт1 <> НЕОПРЕДЕЛЕНО
	|				И ОтражениеВУчете.СубконтоДт1 <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.ФизЛицо = ОтражениеВУчете.Ссылка.Организация.ИндивидуальныйПредприниматель
	|				И ОтражениеВУчете.СчетКт = &СчетОПВ
	|				И ОтражениеВУчете.СубконтоКт2 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		КОГДА ОтражениеВУчете.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт = &СчетОПВ
	|				И ОтражениеВУчете.СубконтоКт2 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		КОГДА ОтражениеВУчете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт = &СчетОПВ
	|				И ОтражениеВУчете.СубконтоКт2 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|				И ОтражениеВУчете.СубконтоДт1 ССЫЛКА Справочник.Контрагенты
	|				И ОтражениеВУчете.СубконтоДт1 <> НЕОПРЕДЕЛЕНО
	|				И ОтражениеВУчете.СубконтоДт1 <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт <> &СчетОПВ
	|				И ОтражениеВУчете.СчетКт <> &СчетИПН
	|				И ОтражениеВУчете.СчетКт <> &СчетВОСМС
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетДт = ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт <> &СчетОПВ
	|				И ОтражениеВУчете.СчетКт <> &СчетИПН
	|				И ОтражениеВУчете.СчетКт <> &СчетВОСМС
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетСО
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетСО
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетСН
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетСН
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт = &СчетОППВ
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеПрофессиональныеПенсионныеВзносы)
	|				И ОтражениеВУчете.СубконтоКт2 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетДт <> ЗНАЧЕНИЕ(ПланСчетов.Типовой.КраткосрочнаяЗадолженностьПоОплатеТруда)
	|				И ОтражениеВУчете.СчетКт = &СчетОППВ
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеПрофессиональныеПенсионныеВзносы)
	|				И ОтражениеВУчете.СубконтоКт2 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетВОСМС
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетВОСМС
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетООСМС
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетООСМС
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетОПВ
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеПенсионныеВзносы)
	|				И ОтражениеВУчете.СубконтоКт2 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетОПВ
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеПенсионныеВзносы)
	|				И ОтражениеВУчете.СубконтоКт2 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетСО
	|				И ОтражениеВУчете.СубконтоКт1 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетСО
	|				И ОтражениеВУчете.СубконтоКт1 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетОППВ
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеПрофессиональныеПенсионныеВзносы)
	|				И ОтражениеВУчете.СубконтоКт2 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетОППВ
	|				И ОтражениеВУчете.СубконтоКт1 = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.ОбязательныеПрофессиональныеПенсионныеВзносы)
	|				И ОтражениеВУчете.СубконтоКт2 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетВОСМС
	|				И ОтражениеВУчете.СубконтоКт1 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетВОСМС
	|				И ОтражениеВУчете.СубконтоКт1 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	0,
	|	ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетООСМС
	|				И ОтражениеВУчете.СубконтоКт1 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ,
	|	-ВЫБОР
	|		КОГДА ОтражениеВУчете.СчетКт = &СчетООСМС
	|				И ОтражениеВУчете.СубконтоКт1 <> ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВБюджетИФонды.Налог)
	|			ТОГДА ОтражениеВУчете.Сумма
	|		ИНАЧЕ 0
	|	КОНЕЦ
	|ИЗ
	|	Документ.ОтражениеЗарплатыВРеглУчете.ОтражениеВУчете КАК ОтражениеВУчете
	|ГДЕ
	|	ОтражениеВУчете.Ссылка.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	|	И ОтражениеВУчете.Ссылка.Проведен
	|	И ОтражениеВУчете.Ссылка.Организация В (&Организация)
	|	И ОтражениеВУчете.Сумма <> 0";
	
	
	Запрос.Текст = ДанныеЗПТекст;
	Запрос.Выполнить();
	
	ДанныеЗПТекст = "ДанныеЗП";
	
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	СУММА(Данные.Начислено) КАК Начислено,
	|	СУММА(Данные.НачисленоБух) КАК НачисленоБух,
	|	СУММА(Данные.РазностьНачислено) КАК РазностьНачислено,
	|	СУММА(Данные.ИПН) КАК ИПН,
	|	СУММА(Данные.ИПНБух) КАК ИПНБух,
	|	СУММА(Данные.РазностьИПН) КАК РазностьИПН,
	|	СУММА(Данные.ОПВ) КАК ОПВ,
	|	СУММА(Данные.ОПВБух) КАК ОПВБух,
	|	СУММА(Данные.РазностьОПВ) КАК РазностьОПВ,
	|	СУММА(Данные.Удержано) КАК Удержано,
	|	СУММА(Данные.УдержаноБух) КАК УдержаноБух,
	|	СУММА(Данные.РазностьУдержано) КАК РазностьУдержано,
	|	СУММА(Данные.СоциальныеОтчисления) КАК СоциальныеОтчисления,
	|	СУММА(Данные.СоциальныеОтчисленияБух) КАК СоциальныеОтчисленияБух,
	|	СУММА(Данные.РазностьСоциальныеОтчисления) КАК РазностьСоциальныеОтчисления,
	|	СУММА(Данные.СоциальныйНалог) КАК СоциальныйНалог,
	|	СУММА(Данные.СоциальныйНалогБух) КАК СоциальныйНалогБух,
	|	СУММА(Данные.РазностьСоциальныйНалог) КАК РазностьСоциальныйНалог,
	|	СУММА(Данные.ОППВ) КАК ОППВ,
	|	СУММА(Данные.ОППВБух) КАК ОППВБух,
	|	СУММА(Данные.РазностьОППВ) КАК РазностьОППВ,
	|	СУММА(Данные.ВОСМС) КАК ВОСМС,
	|	СУММА(Данные.ВОСМСБух) КАК ВОСМСБух,
	|	СУММА(Данные.РазностьВОСМС) КАК РазностьВОСМС,
	|	СУММА(Данные.ООСМС) КАК ООСМС,
	|	СУММА(Данные.ООСМСБух) КАК ООСМСБух,
	|	СУММА(Данные.РазностьООСМС) КАК РазностьООСМС,
	|	СУММА(Данные.ПениОПВ) КАК ПениОПВ,
	|	СУММА(Данные.ПениОПВБух) КАК ПениОПВБух,
	|	СУММА(Данные.РазностьПениОПВ) КАК РазностьПениОПВ,
	|	СУММА(Данные.ПениСО) КАК ПениСО,
	|	СУММА(Данные.ПениСОБух) КАК ПениСОБух,
	|	СУММА(Данные.РазностьПениСО) КАК РазностьПениСО,
	|	СУММА(Данные.ПениОППВ) КАК ПениОППВ,
	|	СУММА(Данные.ПениОППВБух) КАК ПениОППВБух,
	|	СУММА(Данные.РазностьПениОППВ) КАК РазностьПениОППВ,
	|	СУММА(Данные.ПениВОСМС) КАК ПениВОСМС,
	|	СУММА(Данные.ПениВОСМСБух) КАК ПениВОСМСБух,
	|	СУММА(Данные.РазностьПениВОСМС) КАК РазностьПениВОСМС,
	|	СУММА(Данные.ПениООСМС) КАК ПениООСМС,
	|	СУММА(Данные.ПениООСМСБух) КАК ПениООСМСБух,
	|	СУММА(Данные.РазностьПениООСМС) КАК РазностьПениООСМС,
	|	Данные.ФизЛицо КАК ФизЛицо,
	|	Данные.ПериодРегистрации КАК ПериодРегистрации
	|{ВЫБРАТЬ
	|	Данные.Организация КАК Организация,
	|	Данные.ПериодРегистрации КАК ПериодРегистрации,
	|	Данные.ФизЛицо КАК ФизЛицо}
	|ИЗ
	|	ДанныеЗП КАК Данные
	|{ГДЕ
	|	Данные.Организация КАК Организация,
	|	Данные.ПериодРегистрации КАК ПериодРегистрации,
	|	Данные.ФизЛицо КАК ФизЛицо}
	|
	|СГРУППИРОВАТЬ ПО
	|	Данные.ФизЛицо,
	|	Данные.ПериодРегистрации
	|{УПОРЯДОЧИТЬ ПО
	|	Данные.Организация КАК Организация,
	|	Данные.ПериодРегистрации КАК ПериодРегистрации,
	|	Данные.ФизЛицо КАК ФизЛицо}
	|ИТОГИ
	|	СУММА(Начислено),
	|	СУММА(НачисленоБух),
	|	СУММА(РазностьНачислено),
	|	СУММА(ИПН),
	|	СУММА(ИПНБух),
	|	СУММА(РазностьИПН),
	|	СУММА(ОПВ),
	|	СУММА(ОПВБух),
	|	СУММА(РазностьОПВ),
	|	СУММА(Удержано),
	|	СУММА(УдержаноБух),
	|	СУММА(РазностьУдержано),
	|	СУММА(СоциальныеОтчисления),
	|	СУММА(СоциальныеОтчисленияБух),
	|	СУММА(РазностьСоциальныеОтчисления),
	|	СУММА(СоциальныйНалог),
	|	СУММА(СоциальныйНалогБух),
	|	СУММА(РазностьСоциальныйНалог),
	|	СУММА(ОППВ),
	|	СУММА(ОППВБух),
	|	СУММА(РазностьОППВ),
	|	СУММА(ВОСМС),
	|	СУММА(ВОСМСБух),
	|	СУММА(РазностьВОСМС),
	|	СУММА(ООСМС),
	|	СУММА(ООСМСБух),
	|	СУММА(РазностьООСМС),
	|	СУММА(ПениОПВ),
	|	СУММА(ПениОПВБух),
	|	СУММА(РазностьПениОПВ),
	|	СУММА(ПениСО),
	|	СУММА(ПениСОБух),
	|	СУММА(РазностьПениСО),
	|	СУММА(ПениОППВ),
	|	СУММА(ПениОППВБух),
	|	СУММА(РазностьПениОППВ),
	|	СУММА(ПениВОСМС),
	|	СУММА(ПениВОСМСБух),
	|	СУММА(РазностьПениВОСМС),
	|	СУММА(ПениООСМС),
	|	СУММА(ПениООСМСБух),
	|	СУММА(РазностьПениООСМС)
	|ПО
	|	ОБЩИЕ,
	|	Данные.ПериодРегистрации,
	|	Данные.ФизЛицо
	|{ИТОГИ ПО
	|	Данные.Организация КАК Организация,
	|	Данные.ПериодРегистрации КАК ПериодРегистрации,
	|	Данные.ФизЛицо КАК ФизЛицо}";
	
	Результат = Запрос.Выполнить();	
	ДеревоРез = Результат.Выгрузить(ОбходРезультатаЗапроса.ПоГруппировкамСИерархией);
	
	ТаблицаРез = Новый ТаблицаЗначений;
	ЗаполнитьЗначенияСвойств(ТаблицаРез.Колонки, Результат.Колонки);
	Если ДеревоРез.Строки.Количество() <> 0 Тогда
		СтрокаГруппы = ДеревоРез.Строки[0];
		Для Каждого Колонка Из Результат.Колонки Цикл
			ТаблицаРез.Колонки.Добавить(Колонка.Имя,Колонка.ТипЗначения,Колонка.Имя,Колонка.Ширина);		
		КонецЦикла;
		Для Каждого СтрокиПоПериодуРегистрации Из СтрокаГруппы.Строки Цикл
			Для Каждого Строка Из СтрокиПоПериодуРегистрации.Строки Цикл
				НовСтрока = ТаблицаРез.Добавить();
				ЗаполнитьЗначенияСвойств(НовСтрока,Строка);			
			КонецЦикла;
		КонецЦикла;
		
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = МенеджерВТ;
		Запрос.Текст = "ВЫБРАТЬ * ПОМЕСТИТЬ ТЧЗарПлата ИЗ &ВнешнийИсточник Как Внешний";
		Запрос.УстановитьПараметр("ВнешнийИсточник", ТаблицаРез);
		Результат = Запрос.Выполнить();
		
		ИтоговыйЗапрос = Новый Запрос;
		ИтоговыйЗапрос.МенеджерВременныхТаблиц = МенеджерВТ;
		
		ТекстЗап = "ВЫБРАТЬ 
		|       ИтогТаблица.Период,
		|       ИтогТаблица.Работник,
		|       ИтогТаблица.Показатель,
		|       ИтогТаблица.Разница
		|  ИЗ
		|(ВЫБРАТЬ 
		|  ТЧЗарПлата.ПериодРегистрации КАК Период,
		|  ТЧЗарПлата.ФизЛицо КАК Работник,
		|  ""Начисления"" КАК Показатель,
		|  ТЧЗарПлата.РазностьНачислено КАК Разница
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьНачислено <> 0
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""ИПН"",
		| ТЧЗарПлата.РазностьИПН
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьИПН <> 0
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""ОПВ"",
		| ТЧЗарПлата.РазностьОПВ
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьОПВ <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Прочие удержания"",
		| ТЧЗарПлата.РазностьУдержано
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьУдержано <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Социальные отчисления"",
		| ТЧЗарПлата.РазностьСоциальныеОтчисления
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьСоциальныеОтчисления <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Социальный налог"",
		| ТЧЗарПлата.РазностьСоциальныйНалог
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьСоциальныйНалог <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""ОППВ"",
		| ТЧЗарПлата.РазностьОППВ
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьОППВ <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Взносы ОСМС"",
		| ТЧЗарПлата.РазностьВОСМС
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьВОСМС <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Отчисления ОСМС"",
		| ТЧЗарПлата.РазностьООСМС
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьООСМС <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Пени по ОПВ"",
		| ТЧЗарПлата.РазностьПениОПВ
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьПениОПВ <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Пени по СО"",
		| ТЧЗарПлата.РазностьПениСО
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьПениСО <> 0 
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Пени по ОППВ"",
		| ТЧЗарПлата.РазностьПениОППВ
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьПениОППВ <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Пени по взносам ОСМС"",
		| ТЧЗарПлата.РазностьПениВОСМС
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьПениВОСМС <> 0				
		|
		| ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ 
		| ТЧЗарПлата.ПериодРегистрации,
		| ТЧЗарПлата.ФизЛицо,
		| ""Пени по отчислениям ОСМС"",
		| ТЧЗарПлата.РазностьПениООСМС
		|
		|ИЗ ТЧЗарПлата
		| ГДЕ ТЧЗарПлата.РазностьПениООСМС <> 0				
		|
		|)  КАК ИтогТаблица
		| УПОРЯДОЧИТЬ ПО ИтогТаблица.Период, ИтогТаблица.Работник.Наименование, ИтогТаблица.Показатель ";
		
		ИтоговыйЗапрос.Текст = ТекстЗап;
		
		Результат = ИтоговыйЗапрос.Выполнить();	
		
		СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
		СтрокаПравила.ПроверкаВыполнена = Истина;
	Иначе
		СтрокаПравила.ОбнаруженыОшибки  = Ложь;
		СтрокаПравила.ПроверкаВыполнена = Истина;
	КонецЕсли;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ОтражениеЗПРегУчРезультатЗапроса", Результат);
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("Разница", "Начислено(удержано) - отражено");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ОтражениеЗПРегУчСтруктураЗаголовков", СтруктураЗаголовков);
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Работник", "Работник");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ОтражениеЗПРегУчСтруктураРасшифровки", СтруктураРасшифровки);
		СтруктураФорматаПолей = Новый Структура;			
		СтруктураФорматаПолей.Вставить("Период", "ДФ = дд.ММ.гггг");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ОтражениеЗПРегУчСтруктураФорматаПолей", СтруктураФорматаПолей);
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("Период",   20);
		СтруктураШириныКолонок.Вставить("Работник", 60);
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ОтражениеЗПРегУчСтруктураШириныКолонок", СтруктураШириныКолонок);
	КонецЕсли; 	
	
КонецПроцедуры

Процедура ПроверитьПравилоУдержаниеИПНиОПВ(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;

	Запрос.УстановитьПараметр("Организация"				, ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
	
	УпрощенныйУчетИПНиОПВ = УчетнаяПолитикаСервер.УпрощенныйУчетИПНиОПВ(ПараметрыОтчета.Организация, КонецДня(ПараметрыОтчета.ДатаКон));
	
	Если НЕ УпрощенныйУчетИПНиОПВ Тогда
		
		// проверим за все ли месяцы в периоде проверки есть документы
		// Сначала базовая таблица периодов
		ТекстЗапросаПоМесяцам = "";
		МесяцНачала = Месяц(ПараметрыОтчета.ДатаНач);
		МесяцКонца  = Месяц(ПараметрыОтчета.ДатаКон);
		Для Счетчик = МесяцНачала по МесяцКонца Цикл
			Если Не ТекстЗапросаПоМесяцам = "" ТОгда
				ТекстЗапросаПоМесяцам = ТекстЗапросаПоМесяцам + "
				| ОБЪЕДИНИТЬ ВСЕ
				| ";
			КонецЕсли;
			ТекстЗапросаПоМесяцам = ТекстЗапросаПоМесяцам +  "
									|	ВЫБРАТЬ
									|	&Дата" + СокрЛП(Счетчик) + " как Период		                        
									| ";
			Запрос.УстановитьПараметр("Дата" + СокрЛП(Счетчик), НачалоМесяца(ДобавитьМесяц(ПараметрыОтчета.ДатаНач,Счетчик - Месяц(ПараметрыОтчета.ДатаНач))));	
		КонецЦикла;	
		
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
		               |	ИтоговаяТаблица.Период
		               |ИЗ
		               |	(ВЫБРАТЬ
		               |		ТаблицаПоМесяцам.Период КАК Период,
		               |		ДокУдержаниеИПНиОПВ.Ссылка КАК ДокументУдержание,
					   |		ДокУдержаниеИПНиОПВ.Организация КАК Организация,
					   |		ДокРасчетИПНиОПВ.Ссылка КАК ДокументНачисление
		               |	ИЗ
		               |		(" + ТекстЗапросаПоМесяцам + ") КАК ТаблицаПоМесяцам
		               |			ЛЕВОЕ СОЕДИНЕНИЕ Документ.УдержаниеИПНиОПВНУ КАК ДокУдержаниеИПНиОПВ
		               |			ПО ТаблицаПоМесяцам.Период = ДокУдержаниеИПНиОПВ.ПериодРегистрации
		               |				И (ДокУдержаниеИПНиОПВ.Организация = &Организация)
					   |				И (ДокУдержаниеИПНиОПВ.СтруктурноеПодразделение = &СтруктурноеПодразделение)
					   |				И ДокУдержаниеИПНиОПВ.Проведен = ИСТИНА
		               |			ЛЕВОЕ СОЕДИНЕНИЕ Документ.РасчетУдержанийРаботниковОрганизаций КАК ДокРасчетИПНиОПВ
		               |			ПО ТаблицаПоМесяцам.Период = ДокРасчетИПНиОПВ.ПериодРегистрации
		               |				И (ДокРасчетИПНиОПВ.Организация = &Организация)
					   |				И (ДокРасчетИПНиОПВ.СтруктурноеПодразделение = &СтруктурноеПодразделение)
					   |				И ДокРасчетИПНиОПВ.Проведен = ИСТИНА) КАК ИтоговаяТаблица
		               |ГДЕ
		               |	ИтоговаяТаблица.ДокументУдержание ЕСТЬ NULL И НЕ ИтоговаяТаблица.ДокументНачисление ЕСТЬ NULL";
					   
		Результат = Запрос.Выполнить();	
		
		СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
		СтрокаПравила.ПроверкаВыполнена = Истина;
		
		Если СтрокаПравила.ОбнаруженыОшибки Тогда
			ТаблицаРезультата = Результат.Выгрузить();
			ТаблицаИсходящихДанных = Новый ТаблицаЗначений;
			ТаблицаИсходящихДанных.Колонки.Добавить("Период");
			Для Каждого Строка Из ТаблицаРезультата Цикл 
				НоваяСтрока = ТаблицаИсходящихДанных.Добавить();
				НоваяСтрока.Период = Формат(Строка.Период, "ДФ='ММММ гггг'");
			КонецЦикла;
			ПараметрыОтчета.ИсходящиеДанные.Вставить("УдержаниеИПНиОПВТаблицаЗначений", ТаблицаИсходящихДанных);
			
			СтруктураЗаголовков = Новый Структура;
			СтруктураЗаголовков.Вставить("Период", "Период, в котором не обнаружено документов ""Удержание ИПН, ОПВ и ВОСМС по налоговому учету"".");
			ПараметрыОтчета.ИсходящиеДанные.Вставить("УдержаниеИПНиОПВСтруктураЗаголовков", СтруктураЗаголовков);			
			
			СтруктураШириныКолонок = Новый Структура;
			СтруктураШириныКолонок.Вставить("Период" , 150);
			ПараметрыОтчета.ИсходящиеДанные.Вставить("УдержаниеИПНиОПВСтруктураШириныКолонок", СтруктураШириныКолонок);
		КонецЕсли; 
				
	Иначе
		СтрокаПравила.ОбнаруженыОшибки  = Ложь;
		СтрокаПравила.ПроверкаВыполнена = Истина;
		СтрокаПравила.КомментарийРезультата = "В учетной политике используется упрощенный учет ИПН, ОПВ и ВОСМС, поэтому необходимости"
		                                       + " в создании документов ""Удержание ИПН, ОПВ и ВОСМС по налоговому учету"" нет.";
		
	КонецЕсли;	
	
КонецПроцедуры // ПроверитьПравилоУдержаниеИПНиОПВ()

Процедура ПроверитьПравилоРасчетНалогов(СтрокаПравила, ПараметрыОтчета)
	
	// проверим есть ли данные для проверки
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;	
	ТекстЗапроса = "ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	               |	ИПНСведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |	ИПНСведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации
	               |ИЗ
	               |	РегистрНакопления.ИПНСведенияОДоходах КАК ИПНСведенияОДоходах
	               |ГДЕ
	               |	ИПНСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |	И ИПНСведенияОДоходах.Организация = &Организация
	               |	И ИПНСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ОПВСведенияОДоходах.ФизЛицо,
	               |	ОПВСведенияОДоходах.ПериодРегистрации
	               |ИЗ
	               |	РегистрНакопления.ОПВСведенияОДоходах КАК ОПВСведенияОДоходах
	               |ГДЕ
	               |	ОПВСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |	И ОПВСведенияОДоходах.Организация = &Организация
	               |	И ОПВСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	СОСведенияОДоходах.ФизЛицо,
	               |	СОСведенияОДоходах.ПериодРегистрации
	               |ИЗ
	               |	РегистрНакопления.СОСведенияОДоходах КАК СОСведенияОДоходах
	               |ГДЕ
	               |	СОСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |	И СОСведенияОДоходах.Организация = &Организация
	               |	И СОСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	СНСведенияОДоходах.ФизЛицо,
	               |	СНСведенияОДоходах.ПериодРегистрации
	               |ИЗ
	               |	РегистрНакопления.СНСведенияОДоходах КАК СНСведенияОДоходах
	               |ГДЕ
	               |	СНСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |	И СНСведенияОДоходах.Организация = &Организация
	               |	И СНСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ОППВСведенияОДоходах.ФизЛицо,
	               |	ОППВСведенияОДоходах.ПериодРегистрации
	               |ИЗ
	               |	РегистрНакопления.ОППВСведенияОДоходах КАК ОППВСведенияОДоходах
	               |ГДЕ
	               |	ОППВСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |	И ОППВСведенияОДоходах.Организация = &Организация
	               |	И ОППВСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ВОСМССведенияОДоходах.ФизЛицо,
	               |	ВОСМССведенияОДоходах.ПериодРегистрации
	               |ИЗ
	               |	РегистрНакопления.ВОСМССведенияОДоходах КАК ВОСМССведенияОДоходах
	               |ГДЕ
	               |	ВОСМССведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |	И ВОСМССведенияОДоходах.Организация = &Организация
	               |	И ВОСМССведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ООСМССведенияОДоходах.ФизЛицо,
	               |	ООСМССведенияОДоходах.ПериодРегистрации
	               |ИЗ
	               |	РегистрНакопления.ООСМССведенияОДоходах КАК ООСМССведенияОДоходах
	               |ГДЕ
	               |	ООСМССведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |	И ООСМССведенияОДоходах.Организация = &Организация
	               |	И ООСМССведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)";
				   
	Запрос.УстановитьПараметр("ДатаНач",			 ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон",			 КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация", 		 ПараметрыОтчета.Организация);
	
	Запрос.Текст = ТекстЗапроса;
	
	Результат = Запрос.Выполнить();	
	
	Если Результат.Пустой() Тогда
		СтрокаПравила.ОбнаруженыОшибки  = Ложь;
		СтрокаПравила.ПроверкаВыполнена = Истина;
		СтрокаПравила.КомментарийРезультата = "Данных для проверки не обнаружено.";
		Возврат;
	КонецЕсли;	
			
	// ИПН
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	               |	ИПНСведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |	ИПНСведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации
	               |ПОМЕСТИТЬ ВТИПНСведенияОДоходах
	               |ИЗ
	               |	РегистрНакопления.ИПНСведенияОДоходах КАК ИПНСведенияОДоходах
	               |ГДЕ
	               |	ИПНСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |	И ИПНСведенияОДоходах.Организация = &Организация
	               |	И ИПНСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	               |	ИПНРасчетыСБюджетом.ФизЛицо КАК ФизЛицо,
	               |	ИПНРасчетыСБюджетом.Период КАК Период
	               |ПОМЕСТИТЬ ВТИПНРасчетыСБюджетом
	               |ИЗ
	               |	РегистрНакопления.ИПНРасчетыСБюджетом КАК ИПНРасчетыСБюджетом
	               |ГДЕ
	               |	ИПНРасчетыСБюджетом.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
	               |	И ИПНРасчетыСБюджетом.Организация = &Организация
	               |	И ИПНРасчетыСБюджетом.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ИПНСведенияОДоходахОбороты.ФизЛицо,
	               |	ИПНСведенияОДоходахОбороты.ПериодРегистрации
	               |ИЗ
	               |	РегистрНакопления.ИПНСведенияОДоходах.Обороты(, , Месяц, Организация = &Организация) КАК ИПНСведенияОДоходахОбороты
	               |ГДЕ
	               |	(ИПНСведенияОДоходахОбороты.ПримененныйВычетОборот <> 0
	               |			ИЛИ ИПНСведенияОДоходахОбороты.ПримененнаяЛьготаОборот <> 0)
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	СведенияОбИсчисленииВычетовИПНОбороты.ФизическоеЛицо,
	               |	СведенияОбИсчисленииВычетовИПНОбороты.ПериодРегистрации
	               |ИЗ
	               |	РегистрНакопления.СведенияОбИсчисленииВычетовИПН.Обороты(, , Месяц, Организация = &Организация) КАК СведенияОбИсчисленииВычетовИПНОбороты
	               |ГДЕ
	               |	СведенияОбИсчисленииВычетовИПНОбороты.ПримененныйВычетОборот <> 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ИПНСведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |	ИПНСведенияОДоходах.ПериодРегистрации,
	               |	""ИПН"" КАК ВидНалога
	               |ПОМЕСТИТЬ ВТ_НеИсчисленныйИПН
	               |ИЗ
	               |	ВТИПНСведенияОДоходах КАК ИПНСведенияОДоходах
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТИПНРасчетыСБюджетом КАК ИПНРасчетыСБюджетом
	               |		ПО ИПНСведенияОДоходах.ФизЛицо = ИПНРасчетыСБюджетом.ФизЛицо
	               |			И (НАЧАЛОПЕРИОДА(ИПНСведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ИПНРасчетыСБюджетом.Период, МЕСЯЦ))
	               |ГДЕ
	               |	ИПНРасчетыСБюджетом.Период ЕСТЬ NULL ";	
	
	Запрос.Выполнить();						
	
	НеИсчисленныйИПНТекст = "ВЫБРАТЬ
		                       |	ТаблицаИПН.ФизЛицо,
		                       |	ТаблицаИПН.ПериодРегистрации,
		                       |	ТаблицаИПН.ВидНалога
		                       |ИЗ
		                       |	ВТ_НеИсчисленныйИПН КАК ТаблицаИПН";
			
	// ОПВ						   
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ИтоговаяТаблица.ФизЛицо КАК ФизЛицо,
	               |	ИтоговаяТаблица.ПериодРегистрации КАК ПериодРегистрации,
	               |	ИтоговаяТаблица.ВидНалога КАК ВидНалога
	               |ПОМЕСТИТЬ ВТ_НеИсчисленныйОПВ
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ТаблицаСоСрезами.ФизЛицо КАК ФизЛицо,
	               |		ТаблицаСоСрезами.ПериодРегистрации КАК ПериодРегистрации,
	               |		ТаблицаСоСрезами.ВидНалога КАК ВидНалога,
	               |		ГражданствоФизЛиц.НеИмеетПравоНаПенсию КАК НеИмеетПравоНаПенсию,
	               |		СведенияОПенсионномОбеспеченииФизЛиц.Пенсионер КАК Пенсионер,
	               |		СведенияОбИнвалидностиФизлиц.ОтношениеКИнвалидности КАК ОтношениеКИнвалидности,
	               |		СведенияОбИнвалидностиФизлиц.ГруппаИнвалидности КАК ГруппаИнвалидности,
	               |		СведенияОбИнвалидностиФизлиц.СрокДействияСправки КАК СрокДействияСправки
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			НеИсчисленныйОПВ.ФизЛицо КАК ФизЛицо,
	               |			НеИсчисленныйОПВ.ПериодРегистрации КАК ПериодРегистрации,
	               |			НеИсчисленныйОПВ.ВидНалога КАК ВидНалога,
	               |			МАКСИМУМ(ГражданствоФизЛиц.Период) КАК ПериодСрезаГражданствоФизЛиц,
	               |			МАКСИМУМ(СведенияОПенсионномОбеспеченииФизЛиц.Период) КАК ПериодСрезаСведенияОПенсОбесп,
	               |			МАКСИМУМ(СведенияОбИнвалидностиФизлиц.Период) КАК ПериодСрезаСведенияОбИнвалидности
	               |		ИЗ
	               |			(ВЫБРАТЬ
	               |				ОПВСведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |				ОПВСведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации,
	               |				""ОПВ"" КАК ВидНалога
	               |			ИЗ
	               |				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |					ОПВСведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |					ОПВСведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации
	               |				ИЗ
	               |					РегистрНакопления.ОПВСведенияОДоходах КАК ОПВСведенияОДоходах
	               |				ГДЕ
	               |					ОПВСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |					И ОПВСведенияОДоходах.Организация = &Организация
	               |					И ОПВСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК ОПВСведенияОДоходах
	               |					ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |						ОПВРасчетыСФондами.ФизЛицо КАК ФизЛицо,
	               |						ОПВРасчетыСФондами.Период КАК Период
	               |					ИЗ
	               |						РегистрНакопления.ОПВРасчетыСФондами КАК ОПВРасчетыСФондами
	               |					ГДЕ
	               |						ОПВРасчетыСФондами.Организация = &Организация
	               |						И ОПВРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	               |						И ОПВРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)
	               |						И ОПВРасчетыСФондами.ВидПлатежа В(&ВидыПлатежей)) КАК ОПВРасчетыСФондами
	               |					ПО ОПВСведенияОДоходах.ФизЛицо = ОПВРасчетыСФондами.ФизЛицо
	               |						И (НАЧАЛОПЕРИОДА(ОПВСведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ОПВРасчетыСФондами.Период, МЕСЯЦ))
	               |			ГДЕ
	               |				ОПВРасчетыСФондами.Период ЕСТЬ NULL) КАК НеИсчисленныйОПВ
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
	               |				ПО (ВЫБОР
	               |						КОГДА НеИсчисленныйОПВ.ФизЛицо ССЫЛКА Справочник.Контрагенты
	               |							ТОГДА НеИсчисленныйОПВ.ФизЛицо.ФизЛицо
	               |						ИНАЧЕ НеИсчисленныйОПВ.ФизЛицо
	               |					КОНЕЦ = ГражданствоФизЛиц.ФизЛицо)
	               |					И (ГражданствоФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйОПВ.ПериодРегистрации, МЕСЯЦ))
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
	               |				ПО (ВЫБОР
	               |						КОГДА НеИсчисленныйОПВ.ФизЛицо ССЫЛКА Справочник.Контрагенты
	               |							ТОГДА НеИсчисленныйОПВ.ФизЛицо.ФизЛицо
	               |						ИНАЧЕ НеИсчисленныйОПВ.ФизЛицо
	               |					КОНЕЦ = СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо)
	               |					И (СведенияОПенсионномОбеспеченииФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйОПВ.ПериодРегистрации, МЕСЯЦ))
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОбИнвалидностиФизлиц КАК СведенияОбИнвалидностиФизлиц
	               |				ПО (ВЫБОР
	               |						КОГДА НеИсчисленныйОПВ.ФизЛицо ССЫЛКА Справочник.Контрагенты
	               |							ТОГДА НеИсчисленныйОПВ.ФизЛицо.ФизЛицо
	               |						ИНАЧЕ НеИсчисленныйОПВ.ФизЛицо
	               |					КОНЕЦ = СведенияОбИнвалидностиФизлиц.Физлицо)
	               |					И (СведенияОбИнвалидностиФизлиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйОПВ.ПериодРегистрации, МЕСЯЦ))
	               |		
	               |		СГРУППИРОВАТЬ ПО
	               |			НеИсчисленныйОПВ.ФизЛицо,
	               |			НеИсчисленныйОПВ.ПериодРегистрации,
	               |			НеИсчисленныйОПВ.ВидНалога) КАК ТаблицаСоСрезами
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаГражданствоФизЛиц = ГражданствоФизЛиц.Период
	               |				И (ВЫБОР
	               |					КОГДА ТаблицаСоСрезами.ФизЛицо ССЫЛКА Справочник.Контрагенты
	               |						ТОГДА ТаблицаСоСрезами.ФизЛицо.ФизЛицо
	               |					ИНАЧЕ ТаблицаСоСрезами.ФизЛицо
	               |				КОНЕЦ = ГражданствоФизЛиц.ФизЛицо)
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаСведенияОПенсОбесп = СведенияОПенсионномОбеспеченииФизЛиц.Период
	               |				И (ВЫБОР
	               |					КОГДА ТаблицаСоСрезами.ФизЛицо ССЫЛКА Справочник.Контрагенты
	               |						ТОГДА ТаблицаСоСрезами.ФизЛицо.ФизЛицо
	               |					ИНАЧЕ ТаблицаСоСрезами.ФизЛицо
	               |				КОНЕЦ = СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо)
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОбИнвалидностиФизлиц КАК СведенияОбИнвалидностиФизлиц
	               |			ПО (ВЫБОР
	               |					КОГДА ТаблицаСоСрезами.ФизЛицо ССЫЛКА Справочник.Контрагенты
	               |						ТОГДА ТаблицаСоСрезами.ФизЛицо.ФизЛицо
	               |					ИНАЧЕ ТаблицаСоСрезами.ФизЛицо
	               |				КОНЕЦ = СведенияОбИнвалидностиФизлиц.ФизЛицо)
	               |				И ТаблицаСоСрезами.ПериодСрезаСведенияОбИнвалидности = СведенияОбИнвалидностиФизлиц.Период) КАК ИтоговаяТаблица
	               |ГДЕ
	               |	(НЕ ИтоговаяТаблица.НеИмеетПравоНаПенсию
	               |			ИЛИ ИтоговаяТаблица.НеИмеетПравоНаПенсию ЕСТЬ NULL)
	               |	И (НЕ ИтоговаяТаблица.Пенсионер
	               |			ИЛИ ИтоговаяТаблица.Пенсионер ЕСТЬ NULL)
	               |	И (НЕ(ИтоговаяТаблица.ОтношениеКИнвалидности = &парамИнвалид
	               |					И ИтоговаяТаблица.ГруппаИнвалидности В (&парамСписокГруппИнвалидности)
	               |					И ИтоговаяТаблица.СрокДействияСправки = &парамПустаяДата)
	               |			ИЛИ ИтоговаяТаблица.ОтношениеКИнвалидности ЕСТЬ NULL)";	
							
	Запрос.УстановитьПараметр("Организация", ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("парамИнвалид", Перечисления.ОтношениеКИнвалидности.Инвалид);
	СписокГруппИнвалидности = Новый СписокЗначений;
	СписокГруппИнвалидности.Добавить("I");
	СписокГруппИнвалидности.Добавить("II");
	Запрос.УстановитьПараметр("парамСписокГруппИнвалидности",  СписокГруппИнвалидности);
	ВидыПлатежей = Новый СписокЗначений;
	ВидыПлатежей.Добавить(Перечисления.ВидыПлатежейВБюджетИФонды.Налог);
	ВидыПлатежей.Добавить(Перечисления.ВидыПлатежейВБюджетИФонды.НалогАкт);
	ВидыПлатежей.Добавить(Перечисления.ВидыПлатежейВБюджетИФонды.НалогСам);
	Запрос.УстановитьПараметр("ВидыПлатежей", ВидыПлатежей);
	Запрос.УстановитьПараметр("парамПустаяДата", '00010101');
	Запрос.Выполнить();
	НеИсчисленныйОПВТекст = "ВЫБРАТЬ
		                       |	ТаблицаОПВ.ФизЛицо,
		                       |	ТаблицаОПВ.ПериодРегистрации,
		                       |	ТаблицаОПВ.ВидНалога
		                       |ИЗ
		                       |	ВТ_НеИсчисленныйОПВ КАК ТаблицаОПВ";
	
	// СН						   
	ОрганизацияЯвляетсяПлательщикомСН = УчетнаяПолитикаСервер.ОрганизацияЯвляетсяПлательщикомСН(ПараметрыОтчета.Организация, ПараметрыОтчета.ДатаКон);

	Если ОрганизацияЯвляетсяПлательщикомСН Тогда
		
		// тоже самое как для ИПН, только регистр то оборотный...
		Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
		               |	СНСведенияОДоходах.ФизЛицо,
		               |	СНСведенияОДоходах.ПериодРегистрации,
		               |	""СН"" КАК ВидНалога
		               |ПОМЕСТИТЬ ВТ_НеИсчисленныйСН
		               |ИЗ
		               |	(ВЫБРАТЬ РАЗЛИЧНЫЕ
		               |		СНСведенияОДоходах.ФизЛицо КАК ФизЛицо,
		               |		СНСведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации
		               |	ИЗ
		               |		РегистрНакопления.СНСведенияОДоходах КАК СНСведенияОДоходах
		               |	ГДЕ
		               |		СНСведенияОДоходах.Организация = &Организация
		               |		И СНСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
		               |		И СНСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК СНСведенияОДоходах
		               |		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
		               |			СНИсчисленный.ФизЛицо КАК ФизЛицо,
		               |			СНИсчисленный.Период КАК Период
		               |		ИЗ
		               |			РегистрНакопления.СНИсчисленный КАК СНИсчисленный
		               |		ГДЕ
		               |			СНИсчисленный.Организация = &Организация) КАК СНИсчисленный
		               |		ПО СНСведенияОДоходах.ФизЛицо = СНИсчисленный.ФизЛицо
		               |			И (НАЧАЛОПЕРИОДА(СНСведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(СНИсчисленный.Период, МЕСЯЦ))
		               |ГДЕ
		               |	СНИсчисленный.Период ЕСТЬ NULL ";	
							   
		Запрос.Выполнить();					   
		НеИсчисленныйСНТекст = "ВЫБРАТЬ
		                       |	ТаблицаСН.ФизЛицо,
		                       |	ТаблицаСН.ПериодРегистрации,
		                       |	ТаблицаСН.ВидНалога
		                       |ИЗ
		                       |	ВТ_НеИсчисленныйСН КАК ТаблицаСН";
	КонецЕсли;
	
	// СО
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ИтоговаяТаблица.ФизЛицо,
	               |	ИтоговаяТаблица.ПериодРегистрации,
	               |	ИтоговаяТаблица.ВидНалога
	               |ПОМЕСТИТЬ ВТ_НеИсчисленныйСО
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ТаблицаСоСрезами.ФизЛицо КАК ФизЛицо,
	               |		ТаблицаСоСрезами.ПериодРегистрации КАК ПериодРегистрации,
	               |		ТаблицаСоСрезами.ВидНалога КАК ВидНалога,
	               |		ГражданствоФизЛиц.НеПодлежитСоциальномуСтрахованию КАК НеПодлежитСоциальномуСтрахованию,
	               |		СведенияОПенсионномОбеспеченииФизЛиц.Пенсионер КАК Пенсионер
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			НеИсчисленныйСО.ФизЛицо КАК ФизЛицо,
	               |			НеИсчисленныйСО.ПериодРегистрации КАК ПериодРегистрации,
	               |			НеИсчисленныйСО.ВидНалога КАК ВидНалога,
	               |			МАКСИМУМ(ГражданствоФизЛиц.Период) КАК ПериодСрезаГражданствоФизЛиц,
	               |			МАКСИМУМ(СведенияОПенсионномОбеспеченииФизЛиц.Период) КАК ПериодСрезаСведенияОПенсОбесп
	               |		ИЗ
	               |			(ВЫБРАТЬ
	               |				СОСведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |				СОСведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации,
	               |				""СО"" КАК ВидНалога
	               |			ИЗ
	               |				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |					СОСведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |					СОСведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации
	               |				ИЗ
	               |					РегистрНакопления.СОСведенияОДоходах КАК СОСведенияОДоходах
	               |				ГДЕ
	               |					СОСведенияОДоходах.Организация = &Организация
	               |					И СОСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |					И СОСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК СОСведенияОДоходах
	               |					ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |						СОРасчетыСФондами.ФизЛицо КАК ФизЛицо,
	               |						СОРасчетыСФондами.Период КАК Период
	               |					ИЗ
	               |						РегистрНакопления.СОРасчетыСФондами КАК СОРасчетыСФондами
	               |					ГДЕ
	               |						СОРасчетыСФондами.Организация = &Организация
	               |						И СОРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	               |						И СОРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)) КАК СОРасчетыСФондами
	               |					ПО СОСведенияОДоходах.ФизЛицо = СОРасчетыСФондами.ФизЛицо
	               |						И (НАЧАЛОПЕРИОДА(СОСведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(СОРасчетыСФондами.Период, МЕСЯЦ))
	               |			ГДЕ
	               |				СОРасчетыСФондами.Период ЕСТЬ NULL ) КАК НеИсчисленныйСО
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
	               |				ПО (ГражданствоФизЛиц.ФизЛицо = НеИсчисленныйСО.ФизЛицо)
	               |					И (ГражданствоФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйСО.ПериодРегистрации, МЕСЯЦ))
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
	               |				ПО (СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо = НеИсчисленныйСО.ФизЛицо)
	               |					И (СведенияОПенсионномОбеспеченииФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйСО.ПериодРегистрации, МЕСЯЦ))
	               |		
	               |		СГРУППИРОВАТЬ ПО
	               |			НеИсчисленныйСО.ФизЛицо,
	               |			НеИсчисленныйСО.ПериодРегистрации,
	               |			НеИсчисленныйСО.ВидНалога) КАК ТаблицаСоСрезами
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаГражданствоФизЛиц = ГражданствоФизЛиц.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = ГражданствоФизЛиц.ФизЛицо
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаСведенияОПенсОбесп = СведенияОПенсионномОбеспеченииФизЛиц.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо) КАК ИтоговаяТаблица
	               |ГДЕ
	               |	(НЕ ИтоговаяТаблица.НеПодлежитСоциальномуСтрахованию
	               |			ИЛИ ИтоговаяТаблица.НеПодлежитСоциальномуСтрахованию ЕСТЬ NULL )
	               |	И (НЕ ИтоговаяТаблица.Пенсионер
	               |			ИЛИ ИтоговаяТаблица.Пенсионер ЕСТЬ NULL )";
	
	Запрос.Выполнить();					   
	НеИсчисленныйСОТекст = "ВЫБРАТЬ
		                       |	ТаблицаСО.ФизЛицо,
		                       |	ТаблицаСО.ПериодРегистрации,
		                       |	ТаблицаСО.ВидНалога
		                       |ИЗ
		                       |	ВТ_НеИсчисленныйСО КАК ТаблицаСО";
	
	// ОППВ						   
  	ОрганизацияЯвляетсяВкладчикомОППВ = ПроцедурыНалоговогоУчета.ПолучитьПризнакВкладчикаПрофПенсионныхВзносов(ПараметрыОтчета.Организация, ПараметрыОтчета.ДатаКон);

	Если ОрганизацияЯвляетсяВкладчикомОППВ Тогда
		Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
		               |	ИтоговаяТаблица.ФизЛицо,
		               |	ИтоговаяТаблица.ПериодРегистрации,
		               |	ИтоговаяТаблица.ВидНалога
		               |ПОМЕСТИТЬ ВТ_НеИсчисленныйОППВ
		               |ИЗ
		               |	(ВЫБРАТЬ
		               |		ТаблицаСоСрезами.ФизЛицо КАК ФизЛицо,
		               |		ТаблицаСоСрезами.ПериодРегистрации КАК ПериодРегистрации,
		               |		ТаблицаСоСрезами.ВидНалога КАК ВидНалога,
		               |		ГражданствоФизЛиц.НеИмеетПравоНаПенсию КАК НеИмеетПравоНаПенсию,
		               |		СведенияОПенсионномОбеспеченииФизЛиц.Пенсионер КАК Пенсионер
		               |	ИЗ
		               |		(ВЫБРАТЬ
		               |			НеИсчисленныйОППВ.ФизЛицо КАК ФизЛицо,
		               |			НеИсчисленныйОППВ.ПериодРегистрации КАК ПериодРегистрации,
		               |			НеИсчисленныйОППВ.ВидНалога КАК ВидНалога,
		               |			МАКСИМУМ(ГражданствоФизЛиц.Период) КАК ПериодСрезаГражданствоФизЛиц,
		               |			МАКСИМУМ(СведенияОПенсионномОбеспеченииФизЛиц.Период) КАК ПериодСрезаСведенияОПенсОбесп
		               |		ИЗ
		               |			(ВЫБРАТЬ
		               |				ОППВСведенияОДоходах.ФизЛицо КАК ФизЛицо,
		               |				ОППВСведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации,
		               |				""ОППВ"" КАК ВидНалога
		               |			ИЗ
		               |				(ВЫБРАТЬ РАЗЛИЧНЫЕ
		               |					ОППВСведенияОДоходах.ФизЛицо КАК ФизЛицо,
		               |					ОППВСведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации
		               |				ИЗ
		               |					РегистрНакопления.ОППВСведенияОДоходах КАК ОППВСведенияОДоходах
		               |				ГДЕ
		               |					ОППВСведенияОДоходах.Организация = &Организация
		               |					И ОППВСведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
		               |					И ОППВСведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК ОППВСведенияОДоходах
		               |					ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
		               |						ОППВРасчетыСФондами.ФизЛицо КАК ФизЛицо,
		               |						ОППВРасчетыСФондами.Период КАК Период
		               |					ИЗ
		               |						РегистрНакопления.ОППВРасчетыСФондами КАК ОППВРасчетыСФондами
		               |					ГДЕ
		               |						ОППВРасчетыСФондами.Организация = &Организация
		               |						И ОППВРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		               |						И ОППВРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)) КАК ОППВРасчетыСФондами
		               |					ПО ОППВСведенияОДоходах.ФизЛицо = ОППВРасчетыСФондами.ФизЛицо
		               |						И (НАЧАЛОПЕРИОДА(ОППВСведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ОППВРасчетыСФондами.Период, МЕСЯЦ))
		               |			ГДЕ
		               |				ОППВРасчетыСФондами.Период ЕСТЬ NULL ) КАК НеИсчисленныйОППВ
		               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
		               |				ПО (ГражданствоФизЛиц.ФизЛицо = НеИсчисленныйОППВ.ФизЛицо)
		               |					И (ГражданствоФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйОППВ.ПериодРегистрации, МЕСЯЦ))
		               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
		               |				ПО (СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо = НеИсчисленныйОППВ.ФизЛицо)
		               |					И (СведенияОПенсионномОбеспеченииФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйОППВ.ПериодРегистрации, МЕСЯЦ))
		               |		
		               |		СГРУППИРОВАТЬ ПО
		               |			НеИсчисленныйОППВ.ФизЛицо,
		               |			НеИсчисленныйОППВ.ПериодРегистрации,
		               |			НеИсчисленныйОППВ.ВидНалога) КАК ТаблицаСоСрезами
		               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
		               |			ПО ТаблицаСоСрезами.ПериодСрезаГражданствоФизЛиц = ГражданствоФизЛиц.Период
		               |				И ТаблицаСоСрезами.ФизЛицо = ГражданствоФизЛиц.ФизЛицо
		               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
		               |			ПО ТаблицаСоСрезами.ПериодСрезаСведенияОПенсОбесп = СведенияОПенсионномОбеспеченииФизЛиц.Период
		               |				И ТаблицаСоСрезами.ФизЛицо = СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо) КАК ИтоговаяТаблица
		               |ГДЕ
		               |	(НЕ ИтоговаяТаблица.НеИмеетПравоНаПенсию
		               |			ИЛИ ИтоговаяТаблица.НеИмеетПравоНаПенсию ЕСТЬ NULL )
		               |	И (НЕ ИтоговаяТаблица.Пенсионер
		               |			ИЛИ ИтоговаяТаблица.Пенсионер ЕСТЬ NULL )";
	
	Запрос.Выполнить();					   
	НеИсчисленныйОППВТекст = "ВЫБРАТЬ
		                       |	ТаблицаОППВ.ФизЛицо,
		                       |	ТаблицаОППВ.ПериодРегистрации,
		                       |	ТаблицаОППВ.ВидНалога
		                       |ИЗ
		                       |	ВТ_НеИсчисленныйОППВ КАК ТаблицаОППВ";
	
	КонецЕсли;
	
	// ВОСМС
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ИтоговаяТаблица.ФизЛицо,
	               |	ИтоговаяТаблица.ПериодРегистрации,
	               |	ИтоговаяТаблица.ВидНалога
	               |ПОМЕСТИТЬ ВТ_НеИсчисленныйВОСМС
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ТаблицаСоСрезами.ФизЛицо КАК ФизЛицо,
	               |		ТаблицаСоСрезами.ПериодРегистрации КАК ПериодРегистрации,
	               |		ТаблицаСоСрезами.ВидНалога КАК ВидНалога,
	               |		ГражданствоФизЛиц.НеПодлежитСоциальномуМедицинскомуСтрахованию КАК НеПодлежитСоциальномуМедицинскомуСтрахованию,
	               |		СведенияОПенсионномОбеспеченииФизЛиц.Пенсионер КАК Пенсионер,
	               |		СведенияОбИнвалидностиФизлиц.ОтношениеКИнвалидности КАК ОтношениеКИнвалидности,
	               |		СведенияОФизлицахУчастникахВОВ.Статус КАК СтатусУчастникаВОВ
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			НеИсчисленныйВОСМС.ФизЛицо КАК ФизЛицо,
	               |			НеИсчисленныйВОСМС.ПериодРегистрации КАК ПериодРегистрации,
	               |			НеИсчисленныйВОСМС.ВидНалога КАК ВидНалога,
	               |			МАКСИМУМ(ГражданствоФизЛиц.Период) КАК ПериодСрезаГражданствоФизЛиц,
	               |			МАКСИМУМ(СведенияОПенсионномОбеспеченииФизЛиц.Период) КАК ПериодСрезаСведенияОПенсОбесп,
	               |			МАКСИМУМ(СведенияОбИнвалидностиФизлиц.Период) КАК ПериодСрезаСведенияОбИнвалидности,
	               |			МАКСИМУМ(СведенияОФизлицахУчастникахВОВ.Период) КАК ПериодСрезаСведенияОбУчастникахВОВ
	               |		ИЗ
	               |			(ВЫБРАТЬ
	               |				ВОСМССведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |				ВОСМССведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации,
	               |				""Взносы ОСМС"" КАК ВидНалога
	               |			ИЗ
	               |				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |					ВОСМССведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |					ВОСМССведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации
	               |				ИЗ
	               |					РегистрНакопления.ВОСМССведенияОДоходах КАК ВОСМССведенияОДоходах
	               |				ГДЕ
	               |					ВОСМССведенияОДоходах.Организация = &Организация
	               |					И ВОСМССведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |					И ВОСМССведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК ВОСМССведенияОДоходах
	               |					ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |						ВОСМСРасчетыСФондами.ФизЛицо КАК ФизЛицо,
	               |						ВОСМСРасчетыСФондами.Период КАК Период
	               |					ИЗ
	               |						РегистрНакопления.ВОСМСРасчетыСФондами КАК ВОСМСРасчетыСФондами
	               |					ГДЕ
	               |						ВОСМСРасчетыСФондами.Организация = &Организация
	               |						И ВОСМСРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	               |						И ВОСМСРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)) КАК ВОСМСРасчетыСФондами
	               |					ПО ВОСМССведенияОДоходах.ФизЛицо = ВОСМСРасчетыСФондами.ФизЛицо
	               |						И (НАЧАЛОПЕРИОДА(ВОСМССведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ВОСМСРасчетыСФондами.Период, МЕСЯЦ))
	               |			ГДЕ
	               |				ВОСМСРасчетыСФондами.Период ЕСТЬ NULL ) КАК НеИсчисленныйВОСМС
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
	               |				ПО (ГражданствоФизЛиц.ФизЛицо = НеИсчисленныйВОСМС.ФизЛицо)
	               |					И (ГражданствоФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйВОСМС.ПериодРегистрации, МЕСЯЦ))
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
	               |				ПО (СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо = НеИсчисленныйВОСМС.ФизЛицо)
	               |					И (СведенияОПенсионномОбеспеченииФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйВОСМС.ПериодРегистрации, МЕСЯЦ))
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОбИнвалидностиФизлиц КАК СведенияОбИнвалидностиФизлиц
	               |				ПО (СведенияОбИнвалидностиФизлиц.Физлицо = НеИсчисленныйВОСМС.ФизЛицо)
	               |					И (СведенияОбИнвалидностиФизлиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйВОСМС.ПериодРегистрации, МЕСЯЦ))
	               |					И (СведенияОбИнвалидностиФизлиц.СрокДействияСправки = ДАТАВРЕМЯ(1, 1, 1)
	               |						ИЛИ КОНЕЦПЕРИОДА(СведенияОбИнвалидностиФизлиц.СрокДействияСправки, ДЕНЬ) >= КОНЕЦПЕРИОДА(НеИсчисленныйВОСМС.ПериодРегистрации, МЕСЯЦ))
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОФизлицахУчастникахВОВ КАК СведенияОФизлицахУчастникахВОВ
	               |				ПО (СведенияОФизлицахУчастникахВОВ.Физлицо = НеИсчисленныйВОСМС.ФизЛицо)
	               |					И (СведенияОФизлицахУчастникахВОВ.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйВОСМС.ПериодРегистрации, МЕСЯЦ))
	               |		
	               |		СГРУППИРОВАТЬ ПО
	               |			НеИсчисленныйВОСМС.ФизЛицо,
	               |			НеИсчисленныйВОСМС.ПериодРегистрации,
	               |			НеИсчисленныйВОСМС.ВидНалога) КАК ТаблицаСоСрезами
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаГражданствоФизЛиц = ГражданствоФизЛиц.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = ГражданствоФизЛиц.ФизЛицо
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаСведенияОПенсОбесп = СведенияОПенсионномОбеспеченииФизЛиц.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОбИнвалидностиФизлиц КАК СведенияОбИнвалидностиФизлиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаСведенияОбИнвалидности = СведенияОбИнвалидностиФизлиц.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = СведенияОбИнвалидностиФизлиц.Физлицо
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОФизлицахУчастникахВОВ КАК СведенияОФизлицахУчастникахВОВ
	               |			ПО ТаблицаСоСрезами.ПериодСрезаСведенияОбУчастникахВОВ = СведенияОФизлицахУчастникахВОВ.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = СведенияОФизлицахУчастникахВОВ.Физлицо) КАК ИтоговаяТаблица
	               |ГДЕ
	               |	(НЕ ИтоговаяТаблица.НеПодлежитСоциальномуМедицинскомуСтрахованию
	               |			ИЛИ ИтоговаяТаблица.НеПодлежитСоциальномуМедицинскомуСтрахованию ЕСТЬ NULL )
	               |	И (НЕ ИтоговаяТаблица.Пенсионер
	               |			ИЛИ ИтоговаяТаблица.Пенсионер ЕСТЬ NULL )
	               |	И (ИтоговаяТаблица.ОтношениеКИнвалидности <> ЗНАЧЕНИЕ(Перечисление.ОтношениеКИнвалидности.Инвалид)
	               |			ИЛИ ИтоговаяТаблица.ОтношениеКИнвалидности ЕСТЬ NULL )
	               |	И (ИтоговаяТаблица.СтатусУчастникаВОВ <> ЗНАЧЕНИЕ(Перечисление.КатегорииФизлицУчастниковВОВ.УчастникВОВ)
	               |				И ИтоговаяТаблица.СтатусУчастникаВОВ <> ЗНАЧЕНИЕ(Перечисление.КатегорииФизлицУчастниковВОВ.ИнвалидВОВ)
	               |			ИЛИ ИтоговаяТаблица.СтатусУчастникаВОВ ЕСТЬ NULL )";
	
	Запрос.Выполнить();					   
	НеИсчисленныйВОСМСТекст = "ВЫБРАТЬ
		                       |	ТаблицаВОСМС.ФизЛицо,
		                       |	ТаблицаВОСМС.ПериодРегистрации,
		                       |	ТаблицаВОСМС.ВидНалога
		                       |ИЗ
		                       |	ВТ_НеИсчисленныйВОСМС КАК ТаблицаВОСМС";
							   
	// ООСМС
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ИтоговаяТаблица.ФизЛицо,
	               |	ИтоговаяТаблица.ПериодРегистрации,
	               |	ИтоговаяТаблица.ВидНалога
	               |ПОМЕСТИТЬ ВТ_НеИсчисленныйООСМС
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ТаблицаСоСрезами.ФизЛицо КАК ФизЛицо,
	               |		ТаблицаСоСрезами.ПериодРегистрации КАК ПериодРегистрации,
	               |		ТаблицаСоСрезами.ВидНалога КАК ВидНалога,
	               |		ГражданствоФизЛиц.НеПодлежитСоциальномуМедицинскомуСтрахованию КАК НеПодлежитСоциальномуМедицинскомуСтрахованию,
	               |		СведенияОПенсионномОбеспеченииФизЛиц.Пенсионер КАК Пенсионер,
	               |		СведенияОбИнвалидностиФизлиц.ОтношениеКИнвалидности КАК ОтношениеКИнвалидности,
	               |		СведенияОФизлицахУчастникахВОВ.Статус КАК СтатусУчастникаВОВ
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			НеИсчисленныйООСМС.ФизЛицо КАК ФизЛицо,
	               |			НеИсчисленныйООСМС.ПериодРегистрации КАК ПериодРегистрации,
	               |			НеИсчисленныйООСМС.ВидНалога КАК ВидНалога,
	               |			МАКСИМУМ(ГражданствоФизЛиц.Период) КАК ПериодСрезаГражданствоФизЛиц,
	               |			МАКСИМУМ(СведенияОПенсионномОбеспеченииФизЛиц.Период) КАК ПериодСрезаСведенияОПенсОбесп,
	               |			МАКСИМУМ(СведенияОбИнвалидностиФизлиц.Период) КАК ПериодСрезаСведенияОбИнвалидности,
	               |			МАКСИМУМ(СведенияОФизлицахУчастникахВОВ.Период) КАК ПериодСрезаСведенияОбУчастникахВОВ
	               |		ИЗ
	               |			(ВЫБРАТЬ
	               |				ООСМССведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |				ООСМССведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации,
	               |				""Отчисления ОСМС"" КАК ВидНалога
	               |			ИЗ
	               |				(ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |					ООСМССведенияОДоходах.ФизЛицо КАК ФизЛицо,
	               |					ООСМССведенияОДоходах.ПериодРегистрации КАК ПериодРегистрации
	               |				ИЗ
	               |					РегистрНакопления.ООСМССведенияОДоходах КАК ООСМССведенияОДоходах
	               |				ГДЕ
	               |					ООСМССведенияОДоходах.Организация = &Организация
	               |					И ООСМССведенияОДоходах.ПериодРегистрации МЕЖДУ &ДатаНач И &ДатаКон
	               |					И ООСМССведенияОДоходах.СпособНалогообложения <> ЗНАЧЕНИЕ(Справочник.СпособыНалогообложенияДоходов.НеОблагаетсяЦеликом)) КАК ООСМССведенияОДоходах
	               |					ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |						ООСМСРасчетыСФондами.ФизЛицо КАК ФизЛицо,
	               |						ООСМСРасчетыСФондами.Период КАК Период
	               |					ИЗ
	               |						РегистрНакопления.ООСМСРасчетыСФондами КАК ООСМСРасчетыСФондами
	               |					ГДЕ
	               |						ООСМСРасчетыСФондами.Организация = &Организация
	               |						И ООСМСРасчетыСФондами.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	               |						И ООСМСРасчетыСФондами.ВидСтроки = ЗНАЧЕНИЕ(Перечисление.РасчетыСБюджетомФондамиВидСтроки.Исчисление)) КАК ООСМСРасчетыСФондами
	               |					ПО ООСМССведенияОДоходах.ФизЛицо = ООСМСРасчетыСФондами.ФизЛицо
	               |						И (НАЧАЛОПЕРИОДА(ООСМССведенияОДоходах.ПериодРегистрации, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ООСМСРасчетыСФондами.Период, МЕСЯЦ))
	               |			ГДЕ
	               |				ООСМСРасчетыСФондами.Период ЕСТЬ NULL ) КАК НеИсчисленныйООСМС
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
	               |				ПО (ГражданствоФизЛиц.ФизЛицо = НеИсчисленныйООСМС.ФизЛицо)
	               |					И (ГражданствоФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйООСМС.ПериодРегистрации, МЕСЯЦ))
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
	               |				ПО (СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо = НеИсчисленныйООСМС.ФизЛицо)
	               |					И (СведенияОПенсионномОбеспеченииФизЛиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйООСМС.ПериодРегистрации, МЕСЯЦ))
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОбИнвалидностиФизлиц КАК СведенияОбИнвалидностиФизлиц
	               |				ПО (СведенияОбИнвалидностиФизлиц.Физлицо = НеИсчисленныйООСМС.ФизЛицо)
	               |					И (СведенияОбИнвалидностиФизлиц.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйООСМС.ПериодРегистрации, МЕСЯЦ))
	               |					И (СведенияОбИнвалидностиФизлиц.СрокДействияСправки = ДАТАВРЕМЯ(1, 1, 1)
	               |						ИЛИ КОНЕЦПЕРИОДА(СведенияОбИнвалидностиФизлиц.СрокДействияСправки, ДЕНЬ) >= КОНЕЦПЕРИОДА(НеИсчисленныйООСМС.ПериодРегистрации, МЕСЯЦ))
	               |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОФизлицахУчастникахВОВ КАК СведенияОФизлицахУчастникахВОВ
	               |				ПО (СведенияОФизлицахУчастникахВОВ.Физлицо = НеИсчисленныйООСМС.ФизЛицо)
	               |					И (СведенияОФизлицахУчастникахВОВ.Период <= КОНЕЦПЕРИОДА(НеИсчисленныйООСМС.ПериодРегистрации, МЕСЯЦ))
	               |		
	               |		СГРУППИРОВАТЬ ПО
	               |			НеИсчисленныйООСМС.ФизЛицо,
	               |			НеИсчисленныйООСМС.ПериодРегистрации,
	               |			НеИсчисленныйООСМС.ВидНалога) КАК ТаблицаСоСрезами
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГражданствоФизЛиц КАК ГражданствоФизЛиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаГражданствоФизЛиц = ГражданствоФизЛиц.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = ГражданствоФизЛиц.ФизЛицо
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОПенсионномОбеспеченииФизЛиц КАК СведенияОПенсионномОбеспеченииФизЛиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаСведенияОПенсОбесп = СведенияОПенсионномОбеспеченииФизЛиц.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = СведенияОПенсионномОбеспеченииФизЛиц.ФизЛицо
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОбИнвалидностиФизлиц КАК СведенияОбИнвалидностиФизлиц
	               |			ПО ТаблицаСоСрезами.ПериодСрезаСведенияОбИнвалидности = СведенияОбИнвалидностиФизлиц.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = СведенияОбИнвалидностиФизлиц.Физлицо
	               |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОФизлицахУчастникахВОВ КАК СведенияОФизлицахУчастникахВОВ
	               |			ПО ТаблицаСоСрезами.ПериодСрезаСведенияОбУчастникахВОВ = СведенияОФизлицахУчастникахВОВ.Период
	               |				И ТаблицаСоСрезами.ФизЛицо = СведенияОФизлицахУчастникахВОВ.Физлицо) КАК ИтоговаяТаблица
	               |ГДЕ
	               |	(НЕ ИтоговаяТаблица.НеПодлежитСоциальномуМедицинскомуСтрахованию
	               |			ИЛИ ИтоговаяТаблица.НеПодлежитСоциальномуМедицинскомуСтрахованию ЕСТЬ NULL )
	               |	И (НЕ ИтоговаяТаблица.Пенсионер
	               |			ИЛИ ИтоговаяТаблица.Пенсионер ЕСТЬ NULL )
	               |	И (ИтоговаяТаблица.ОтношениеКИнвалидности <> ЗНАЧЕНИЕ(Перечисление.ОтношениеКИнвалидности.Инвалид)
	               |			ИЛИ ИтоговаяТаблица.ОтношениеКИнвалидности ЕСТЬ NULL )
	               |	И (ИтоговаяТаблица.СтатусУчастникаВОВ <> ЗНАЧЕНИЕ(Перечисление.КатегорииФизлицУчастниковВОВ.УчастникВОВ)
	               |				И ИтоговаяТаблица.СтатусУчастникаВОВ <> ЗНАЧЕНИЕ(Перечисление.КатегорииФизлицУчастниковВОВ.ИнвалидВОВ)
	               |			ИЛИ ИтоговаяТаблица.СтатусУчастникаВОВ ЕСТЬ NULL )";
	
	Запрос.Выполнить();					   
	НеИсчисленныйООСМСТекст = "ВЫБРАТЬ
		                       |	ТаблицаООСМС.ФизЛицо,
		                       |	ТаблицаООСМС.ПериодРегистрации,
		                       |	ТаблицаООСМС.ВидНалога
		                       |ИЗ
		                       |	ВТ_НеИсчисленныйООСМС КАК ТаблицаООСМС";
	
	
	// ИТОГОВЫЙ ЗАПРОС
	ТекстЗапроса = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	                |	ИтоговаяТаблица.ФизЛицо,
					|	ИтоговаяТаблица.ПериодРегистрации,
					|	ИтоговаяТаблица.ВидНалога
					|ИЗ 
					| (" + НеИсчисленныйИПНТекст + "		
	                |
					|ОБЪЕДИНИТЬ ВСЕ
					|
					|" + НеИсчисленныйОПВТекст + ?(ОрганизацияЯвляетсяПлательщикомСН, "		
	                | 
					|ОБЪЕДИНИТЬ ВСЕ
					|
					|" + НеИсчисленныйСНТекст, "") + "		
	                | 
					|ОБЪЕДИНИТЬ ВСЕ
					|
					|" + НеИсчисленныйСОТекст + ?(ОрганизацияЯвляетсяВкладчикомОППВ, "		
	                | 
					|ОБЪЕДИНИТЬ ВСЕ
					|
					|" + НеИсчисленныйОППВТекст, "") + "		
	                | 
					|ОБЪЕДИНИТЬ ВСЕ
					|
					|" + НеИсчисленныйВОСМСТекст + "		
	                | 
					|ОБЪЕДИНИТЬ ВСЕ
					|
					|" + НеИсчисленныйООСМСТекст + ") КАК ИтоговаяТаблица
				    |  
				    |УПОРЯДОЧИТЬ ПО
	  			    |	ВидНалога, 
					|	ПериодРегистрации, 
					|	ФизЛицо";
														 
	Запрос.Текст = ТекстЗапроса;
	
	Результат = Запрос.Выполнить();	
		
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
		
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("РасчетНалоговРезультатЗапроса", Результат);
			
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("ФизЛицо","Работник");
		СтруктураЗаголовков.Вставить("ПериодРегистрации","Период регистрации");
		СтруктураЗаголовков.Вставить("ВидНалога","Вид налога");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("РасчетНалоговСтруктураЗаголовков", СтруктураЗаголовков);			
			
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("ФизЛицо", "ФизЛицо");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("РасчетНалоговСтруктураРасшифровки", СтруктураРасшифровки);
		
	КонецЕсли;
		
КонецПроцедуры // ПроверитьПравилоРасчетНалогов()

Процедура ПроверитьПравилоРегистрацияОблагаемыхДоходовЗаИП(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;

	Запрос.УстановитьПараметр("Организация"				, ПараметрыОтчета.Организация);
	
	Если ПараметрыОтчета.Организация.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ФизЛицо Тогда
		// проверим за все ли месяцы в периоде проверки есть документы
		// Сначала базовая таблица периодов
		ТекстЗапросаПоМесяцам = "";
		МесяцНачала = Месяц(ПараметрыОтчета.ДатаНач);
		МесяцКонца  = Месяц(ПараметрыОтчета.ДатаКон);
		Для Счетчик = МесяцНачала по МесяцКонца Цикл
			Если Не ТекстЗапросаПоМесяцам = "" Тогда
				ТекстЗапросаПоМесяцам = ТекстЗапросаПоМесяцам + "
				| ОБЪЕДИНИТЬ ВСЕ
				| 
				|	ВЫБРАТЬ
				|	&Дата" + СокрЛП(Счетчик) + " как Период		                        
				| ";
			Иначе
				ТекстЗапросаПоМесяцам = ТекстЗапросаПоМесяцам +  "
				|	ВЫБРАТЬ
				|	&Дата" + СокрЛП(Счетчик) + " как Период		                        
				| Поместить ВТ_ТаблицаПоМесяцам
				| ";
				
			КонецЕсли;
			
			Запрос.УстановитьПараметр("Дата" + СокрЛП(Счетчик), НачалоМесяца(ДобавитьМесяц(ПараметрыОтчета.ДатаНач,Счетчик - Месяц(ПараметрыОтчета.ДатаНач))));	
		КонецЦикла;	
		
		ТекстЗапросаПоМесяцам = ТекстЗапросаПоМесяцам + " 
		|ИНДЕКСИРОВАТЬ ПО
		|	Период";
		
		Запрос.Текст = ТекстЗапросаПоМесяцам + "; 
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВТ_ТаблицаПоМесяцам.Период КАК Период,
		|	МАКСИМУМ(УчетнаяПолитикаНалоговыйУчет.Период) КАК ПериодУчетнаяПолитика,
		|	&Организация КАК Организация
		|ПОМЕСТИТЬ ПериодыУчетнаяПолитика
		|ИЗ
		|	ВТ_ТаблицаПоМесяцам КАК ВТ_ТаблицаПоМесяцам
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаНалоговыйУчет КАК УчетнаяПолитикаНалоговыйУчет
		|		ПО ВТ_ТаблицаПоМесяцам.Период >= УчетнаяПолитикаНалоговыйУчет.Период
		|			И (УчетнаяПолитикаНалоговыйУчет.Организация = &Организация)
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТ_ТаблицаПоМесяцам.Период
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ 
		|	ПериодыУчетнаяПолитика.Период КАК Период,
		|	УчетнаяПолитикаНалоговыйУчет.ЕжемесячныйРасчетВзносовИОтчисленийЗаИП КАК ЕжемесячныйРасчетВзносовИОтчисленийЗаИП,
		|   ПериодыУчетнаяПолитика.Организация
		|ПОМЕСТИТЬ УчетнаяПолитика
		|ИЗ
		|	ПериодыУчетнаяПолитика КАК ПериодыУчетнаяПолитика
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаНалоговыйУчет КАК УчетнаяПолитикаНалоговыйУчет
		|		ПО ПериодыУчетнаяПолитика.ПериодУчетнаяПолитика = УчетнаяПолитикаНалоговыйУчет.Период
		|			И (ПериодыУчетнаяПолитика.Организация = УчетнаяПолитикаНалоговыйУчет.Организация)
		|
		|ИНДЕКСИРОВАТЬ ПО
		|	ПериодыУчетнаяПолитика.Период,
		|   ПериодыУчетнаяПолитика.Организация,
		|	УчетнаяПолитикаНалоговыйУчет.ЕжемесячныйРасчетВзносовИОтчисленийЗаИП
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ 
		|	ДокРегистрация.Ссылка,
		|	УчетнаяПолитика.Период,
		|	УчетнаяПолитика.ЕжемесячныйРасчетВзносовИОтчисленийЗаИП
		|ИЗ
		|	УчетнаяПолитика КАК УчетнаяПолитика
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РегистрацияПрочихДоходовВЦеляхНалогообложения КАК ДокРегистрация
		|		ПО УчетнаяПолитика.Период = НАЧАЛОПЕРИОДА(ДокРегистрация.ПериодРегистрации, МЕСЯЦ)
		|			И (УчетнаяПолитика.Организация = ДокРегистрация.Организация)
		|			И (ДокРегистрация.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийРегистрацияПрочихДоходов.ДоходыИП))
		|			И (ДокРегистрация.Проведен = ИСТИНА)
		|ГДЕ
		|	УчетнаяПолитика.ЕжемесячныйРасчетВзносовИОтчисленийЗаИП = ИСТИНА
		|	И ДокРегистрация.Ссылка ЕСТЬ NULL
		|";		
		
		Результат = Запрос.Выполнить();	
				
		СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
		СтрокаПравила.ПроверкаВыполнена = Истина;
		
		Если СтрокаПравила.ОбнаруженыОшибки Тогда
			ТаблицаРезультата = Результат.Выгрузить();
			ТаблицаИсходящихДанных = Новый ТаблицаЗначений;
			ТаблицаИсходящихДанных.Колонки.Добавить("Период");
			ТаблицаИсходящихДанных.Колонки.Добавить("ИндивидуальныйПредприниматель");
			ТаблицаИсходящихДанных.Колонки.Добавить("ВидОперации");
			Для Каждого Строка Из ТаблицаРезультата Цикл 
				НоваяСтрока = ТаблицаИсходящихДанных.Добавить();
				НоваяСтрока.Период = Формат(Строка.Период, "ДФ='ММММ гггг'");
				НоваяСтрока.ИндивидуальныйПредприниматель = ПараметрыОтчета.Организация.ИндивидуальныйПредприниматель;
				НоваяСтрока.ВидОперации = Перечисления.ВидыОперацийРегистрацияПрочихДоходов.ДоходыИП;
			КонецЦикла;
			ПараметрыОтчета.ИсходящиеДанные.Вставить("РегистрацияОблагаемыхДоходовЗаИПТаблицаЗначений", ТаблицаИсходящихДанных);
			
			СтруктураЗаголовков = Новый Структура;
			СтруктураЗаголовков.Вставить("Период", "Период регистрации");
			СтруктураЗаголовков.Вставить("ИндивидуальныйПредприниматель","Индивидуальный предприниматель");
			СтруктураЗаголовков.Вставить("ВидОперации","Вид операции");
			ПараметрыОтчета.ИсходящиеДанные.Вставить("РегистрацияОблагаемыхДоходовЗаИПСтруктураЗаголовков", СтруктураЗаголовков);					
			
			СтруктураШириныКолонок = Новый Структура;
			СтруктураШириныКолонок.Вставить("Период" , 25);
			СтруктураШириныКолонок.Вставить("ВидОперации" , 40);
			ПараметрыОтчета.ИсходящиеДанные.Вставить("РегистрацияОблагаемыхДоходовЗаИПСтруктураШириныКолонок", СтруктураШириныКолонок);
		КонецЕсли; 
		
	Иначе
		СтрокаПравила.ОбнаруженыОшибки  = Ложь;
		СтрокаПравила.ПроверкаВыполнена = Истина;
		СтрокаПравила.КомментарийРезультата = "Организация не являетя ИП,"
		+ " поэтому необходимости в создании документов ""Регистрация прочих доходов в целях налогообложения"" с видом операции" 
		+ " ""Доходы индивидуального предпринимателя"" нет.";
		
	КонецЕсли;	
		
КонецПроцедуры // ПроверитьПравилоРегистрацияОблагаемыхДоходовЗаИП()

// НДС
Процедура ПроверитьПравилоСверкаБухИРегистровНДС(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
	
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ТаблицаВся.Счет КАК Счет,
	               |	ТаблицаВся.Регистр КАК Регистр,
	               |	ЕСТЬNULL(ТаблицаВся.Регистратор, ТаблицаВся.Регистратор1) КАК Документ,
	               |	СУММА(ЕСТЬNULL(ТаблицаВся.СуммаОборот, 0)) КАК СуммаПоДаннымБухУчета,
	               |	СУММА(ЕСТЬNULL(ТаблицаВся.СуммаНДСОборот, 0)) КАК СуммаВПодсистемеНДС
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		&Счет1420 КАК Счет,
	               |		""НДС к возмещению"" КАК Регистр,
	               |		ТиповойОбороты.СуммаОборотДт КАК СуммаОборот,
	               |		ТиповойОбороты.Регистратор КАК Регистратор,
	               |		НДСКВозмещениюОбороты.СуммаНДСОборот КАК СуммаНДСОборот,
	               |		НДСКВозмещениюОбороты.Регистратор КАК Регистратор1
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			ТиповойОбороты.СуммаОборотДт КАК СуммаОборотДт,
	               |			ТиповойОбороты.Регистратор КАК Регистратор
	               |		ИЗ
	               |			РегистрБухгалтерии.Типовой.Обороты(
	               |					&ДатаНач,
	               |					&ДатаКон,
	               |					Регистратор,
	               |					Счет = &Счет1420,
	               |					&СубконтоПлатежиВБюджет,
	               |					Организация = &Организация
	               |						И Субконто1 В (ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.Налог), ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.НалогСам), ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.НалогАкт))
	               |						И НЕ Субконто2 = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.НалогНаДобавленнуюСтоимостьСИзмененнымСрокомУплаты),
	               |					КорСчет <> &Счет3130,
	               |					) КАК ТиповойОбороты) КАК ТиповойОбороты
	               |			ПОЛНОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |				НДСКВозмещениюОбороты.СуммаНДСОборот КАК СуммаНДСОборот,
	               |				НДСКВозмещениюОбороты.Регистратор КАК Регистратор
	               |			ИЗ
	               |				РегистрНакопления.НДСКВозмещению.Обороты(&ДатаНач, &ДатаКон, Регистратор, Организация = &Организация) КАК НДСКВозмещениюОбороты) КАК НДСКВозмещениюОбороты
	               |			ПО ТиповойОбороты.СуммаОборотДт = НДСКВозмещениюОбороты.СуммаНДСОборот
	               |				И ТиповойОбороты.Регистратор = НДСКВозмещениюОбороты.Регистратор
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		&Счет1420,
	               |		""Корректировка НДС к возмещению"",
	               |		ТиповойОбороты.СуммаОборотКт,
	               |		ТиповойОбороты.Регистратор,
	               |		КорректировкаНДСКВозмещениюОбороты.СуммаНДСОборот,
	               |		КорректировкаНДСКВозмещениюОбороты.Регистратор
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			ТиповойОбороты.СуммаОборотКт КАК СуммаОборотКт,
	               |			ТиповойОбороты.Регистратор КАК Регистратор
	               |		ИЗ
	               |			РегистрБухгалтерии.Типовой.Обороты(
	               |					&ДатаНач,
	               |					&ДатаКон,
	               |					Регистратор,
	               |					Счет = &Счет1420,
	               |					&СубконтоПлатежиВБюджет,
	               |					Организация = &Организация
	               |						И Субконто1 В (ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.Налог), ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.НалогСам), ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.НалогАкт))
				   |						И НЕ Субконто2 = ЗНАЧЕНИЕ(Справочник.НалогиСборыОтчисления.НалогНаДобавленнуюСтоимостьСИзмененнымСрокомУплаты),
	               |					КорСчет <> &Счет3130,
	               |					) КАК ТиповойОбороты) КАК ТиповойОбороты
	               |			ПОЛНОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |				КорректировкаНДСКВозмещениюОбороты.СуммаНДСОборот КАК СуммаНДСОборот,
	               |				КорректировкаНДСКВозмещениюОбороты.Регистратор КАК Регистратор
	               |			ИЗ
	               |				РегистрНакопления.КорректировкаНДСКВозмещению.Обороты(&ДатаНач, &ДатаКон, Регистратор, Организация = &Организация) КАК КорректировкаНДСКВозмещениюОбороты) КАК КорректировкаНДСКВозмещениюОбороты
	               |			ПО (ТиповойОбороты.СуммаОборотКт = -КорректировкаНДСКВозмещениюОбороты.СуммаНДСОборот)
	               |				И ТиповойОбороты.Регистратор = КорректировкаНДСКВозмещениюОбороты.Регистратор
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		&Счет3130,
	               |		""НДС"",
	               |		ТиповойОбороты.СуммаОборотКт,
	               |		ТиповойОбороты.Регистратор,
	               |		НДСОбороты.СуммаНДСОборот,
	               |		НДСОбороты.Регистратор
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			ТиповойОбороты.СуммаОборотКт КАК СуммаОборотКт,
	               |			ТиповойОбороты.Регистратор КАК Регистратор
	               |		ИЗ
	               |			РегистрБухгалтерии.Типовой.Обороты(
	               |					&ДатаНач,
	               |					&ДатаКон,
	               |					Регистратор,
	               |					Счет = &Счет3130,
	               |					&СубконтоПлатежиВБюджет,
	               |					Организация = &Организация
	               |						И Субконто1 В (ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.Налог), ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.НалогСам), ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.НалогАкт)),
	               |					КорСчет <> &Счет1420
	               |						И КорСчет <> &Счет1423
				   |						И КорСчет <> &Счет1424
	               |						И НЕ КорСчет В ИЕРАРХИИ (&Счет1000),
	               |					) КАК ТиповойОбороты) КАК ТиповойОбороты
	               |			ПОЛНОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |				НДСОбороты.СуммаНДСОборот КАК СуммаНДСОборот,
	               |				НДСОбороты.Регистратор КАК Регистратор
	               |			ИЗ
	               |				РегистрНакопления.НДС.Обороты(&ДатаНач, &ДатаКон, Регистратор, Организация = &Организация) КАК НДСОбороты) КАК НДСОбороты
	               |			ПО ТиповойОбороты.СуммаОборотКт = НДСОбороты.СуммаНДСОборот
	               |				И ТиповойОбороты.Регистратор = НДСОбороты.Регистратор
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		&Счет3130,
	               |		""Корректировка НДС"",
	               |		ТиповойОбороты.СуммаОборотДт,
	               |		ТиповойОбороты.Регистратор,
	               |		КорректировкаНДСОбороты.СуммаНДСОборот,
	               |		КорректировкаНДСОбороты.Регистратор
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			ТиповойОбороты.СуммаОборотДт КАК СуммаОборотДт,
	               |			ТиповойОбороты.Регистратор КАК Регистратор
	               |		ИЗ
	               |			РегистрБухгалтерии.Типовой.Обороты(
	               |					&ДатаНач,
	               |					&ДатаКон,
	               |					Регистратор,
	               |					Счет = &Счет3130,
	               |					&СубконтоПлатежиВБюджет,
	               |					Организация = &Организация
	               |						И Субконто1 В (ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.Налог), ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.НалогСам), ЗНАЧЕНИЕ(Перечисление.ВидыПлатежейВбюджетИФонды.НалогАкт)),
	               |					КорСчет <> &Счет1420
	               |						И КорСчет <> &Счет1423
				   |                        И КорСчет <> &Счет1424
	               |						И НЕ КорСчет В ИЕРАРХИИ (&Счет1000),
	               |					) КАК ТиповойОбороты) КАК ТиповойОбороты
	               |			ПОЛНОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |				КорректировкаНДСОбороты.СуммаНДСОборот КАК СуммаНДСОборот,
	               |				КорректировкаНДСОбороты.Регистратор КАК Регистратор
	               |			ИЗ
	               |				РегистрНакопления.КорректировкаНДС.Обороты(&ДатаНач, &ДатаКон, Регистратор, Организация = &Организация) КАК КорректировкаНДСОбороты) КАК КорректировкаНДСОбороты
	               |			ПО (ТиповойОбороты.СуммаОборотДт = -КорректировкаНДСОбороты.СуммаНДСОборот)
	               |				И ТиповойОбороты.Регистратор = КорректировкаНДСОбороты.Регистратор) КАК ТаблицаВся
	               |ГДЕ
	               |	(ТаблицаВся.Регистратор ЕСТЬ NULL
	               |			ИЛИ ТаблицаВся.Регистратор1 ЕСТЬ NULL)
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ТаблицаВся.Регистр,
	               |	ЕСТЬNULL(ТаблицаВся.Регистратор, ТаблицаВся.Регистратор1),
	               |	ТаблицаВся.Счет
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Документ
	               |ИТОГИ
	               |	СУММА(СуммаПоДаннымБухУчета),
	               |	СУММА(СуммаВПодсистемеНДС)
	               |ПО
	               |	Регистр
	               |АВТОУПОРЯДОЧИВАНИЕ";
				   
	Запрос.УстановитьПараметр("ДатаНач", 				ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", 				КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация", 			ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("Счет1420",				ПланыСчетов.Типовой.НалогНаДобавленнуюСтоимостьКВозмещению);
	Запрос.УстановитьПараметр("Счет1423",				ПланыСчетов.Типовой.НДСУплачиваемыйНалоговымАгентом);
	Запрос.УстановитьПараметр("Счет1424",				ПланыСчетов.Типовой.ИзлишнеУплаченныеВБюджетСуммыНДС);
	Запрос.УстановитьПараметр("Счет3130",				ПланыСчетов.Типовой.НалогНаДобавленнуюСтоимость);
	Запрос.УстановитьПараметр("Счет1000",				ПланыСчетов.Типовой.ДенежныеСредства);	
	
	ВидыСубконто = Новый Массив;
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.ВидыПлатежейВБюджетИФонды);
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.НалогиСборыОтчисления);	
	Запрос.УстановитьПараметр("СубконтоПлатежиВБюджет", ВидыСубконто);

	Результат = Запрос.Выполнить();
	
	Если НЕ Результат.Пустой() Тогда
		
		ВыборкаРезультата = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		
		ОшибкиНайдены = Ложь;
		ТаблицаОшибок = Новый ТаблицаЗначений;
		ТаблицаОшибок.Колонки.Добавить("Счет");
		ТаблицаОшибок.Колонки.Добавить("Регистр");
		ТаблицаОшибок.Колонки.Добавить("Документ");
		ТаблицаОшибок.Колонки.Добавить("СуммаПоДаннымБухУчета");
		ТаблицаОшибок.Колонки.Добавить("СуммаВПодсистемеНДС");
		Пока ВыборкаРезультата.Следующий() Цикл
			// проверим данные по счету и определенному регистру НДС
			Если ВыборкаРезультата.Регистр = "НДС к возмещению" Тогда
				ДО1420 = ВыборкаРезультата.СуммаПоДаннымБухУчета;
				СуммаНДСкВозм = ВыборкаРезультата.СуммаВПодсистемеНДС;
				Если ДО1420 <> СуммаНДСкВозм Тогда // есть разница между бух.учетом Дт 1420 и оборотами рег-ра "НДС к возмещению"
					 ОшибкиНайдены = Истина;
					 ВыборкаДетали = ВыборкаРезультата.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					 Пока ВыборкаДетали.Следующий() Цикл
						 НовСтрока = ТаблицаОшибок.Добавить();
						 НовСтрока.Счет = ВыборкаДетали.Счет;
						 НовСтрока.Регистр = ВыборкаДетали.Регистр;
						 НовСтрока.Документ = ВыборкаДетали.Документ;
						 НовСтрока.СуммаПоДаннымБухУчета = ВыборкаДетали.СуммаПоДаннымБухУчета;
						 НовСтрока.СуммаВПодсистемеНДС = ВыборкаДетали.СуммаВПодсистемеНДС;						 
					 КонецЦикла;                                                           					
				КонецЕсли;				
				
			ИначеЕсли  ВыборкаРезультата.Регистр = "Корректировка НДС к возмещению" Тогда
			    КО1420 = ВыборкаРезультата.СуммаПоДаннымБухУчета;
				СуммаКорректировкаНДСкВозм = ВыборкаРезультата.СуммаВПодсистемеНДС;
				Если КО1420 <> - СуммаКорректировкаНДСкВозм Тогда // есть разница между бух.учетом Кт 1420 и оборотами рег-ра "Корректировка НДС к возмещению"
					 ОшибкиНайдены = Истина;
					 ВыборкаДетали = ВыборкаРезультата.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					 Пока ВыборкаДетали.Следующий() Цикл
						 НовСтрока = ТаблицаОшибок.Добавить();
						 НовСтрока.Счет = ВыборкаДетали.Счет;
						 НовСтрока.Регистр = ВыборкаДетали.Регистр;
						 НовСтрока.Документ = ВыборкаДетали.Документ;
						 НовСтрока.СуммаПоДаннымБухУчета = ВыборкаДетали.СуммаПоДаннымБухУчета;
						 НовСтрока.СуммаВПодсистемеНДС = ВыборкаДетали.СуммаВПодсистемеНДС;						 
					 КонецЦикла;                                                           					
				КонецЕсли; 
				 
			ИначеЕсли  ВыборкаРезультата.Регистр = "НДС" Тогда
			    КО3130 = ВыборкаРезультата.СуммаПоДаннымБухУчета;
				СуммаНДС = ВыборкаРезультата.СуммаВПодсистемеНДС;
				Если КО3130 <> СуммаНДС Тогда // есть разница между бух.учетом Кт 3130 и оборотами рег-ра "НДС"
					 ОшибкиНайдены = Истина;
					 ВыборкаДетали = ВыборкаРезультата.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					 Пока ВыборкаДетали.Следующий() Цикл
						 НовСтрока = ТаблицаОшибок.Добавить();
						 НовСтрока.Счет = ВыборкаДетали.Счет;
						 НовСтрока.Регистр = ВыборкаДетали.Регистр;
						 НовСтрока.Документ = ВыборкаДетали.Документ;
						 НовСтрока.СуммаПоДаннымБухУчета = ВыборкаДетали.СуммаПоДаннымБухУчета;
						 НовСтрока.СуммаВПодсистемеНДС = ВыборкаДетали.СуммаВПодсистемеНДС;						 
					 КонецЦикла;                                                           					
				КонецЕсли;
				
			ИначеЕсли  ВыборкаРезультата.Регистр = "Корректировка НДС" Тогда
			    ДО3130 = ВыборкаРезультата.СуммаПоДаннымБухУчета;
				СуммаКорректировкаНДС = ВыборкаРезультата.СуммаВПодсистемеНДС;
				Если ДО3130 <> - СуммаКорректировкаНДС Тогда // есть разница между бух.учетом Дт 3130 и оборотами рег-ра "Корректировка НДС"
					 ОшибкиНайдены = Истина;
					 ВыборкаДетали = ВыборкаРезультата.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					 Пока ВыборкаДетали.Следующий() Цикл
						 НовСтрока = ТаблицаОшибок.Добавить();
						 НовСтрока.Счет = ВыборкаДетали.Счет;
						 НовСтрока.Регистр = ВыборкаДетали.Регистр;
						 НовСтрока.Документ = ВыборкаДетали.Документ;
						 НовСтрока.СуммаПоДаннымБухУчета = ВыборкаДетали.СуммаПоДаннымБухУчета;
						 НовСтрока.СуммаВПодсистемеНДС = ВыборкаДетали.СуммаВПодсистемеНДС;						 
					 КонецЦикла;                                                           					
				КонецЕсли; 			 
				
			КонецЕсли;
			
		КонецЦикла;		
		
		СтрокаПравила.ОбнаруженыОшибки      = ОшибкиНайдены;
		СтрокаПравила.ПроверкаВыполнена     = Истина;		
		Если ТаблицаОшибок.Количество() <> 0 Тогда
			ПараметрыОтчета.ИсходящиеДанные.Вставить("СверкаБухИРегистровНДСТаблицаЗначений", ТаблицаОшибок);
			СтруктураЗаголовков = Новый Структура;
			СтруктураЗаголовков.Вставить("Документ", 			  "Документ");
			СтруктураЗаголовков.Вставить("Регистр", 			  "Регистр накопления");
			СтруктураЗаголовков.Вставить("СуммаПоДаннымБухУчета", "Сумма по данным бух.учета");
			СтруктураЗаголовков.Вставить("СуммаВПодсистемеНДС",   "Сумма в подсистеме НДС");			
			ПараметрыОтчета.ИсходящиеДанные.Вставить("СверкаБухИРегистровНДССтруктураЗаголовков", СтруктураЗаголовков);
			СтруктураРасшифровки = Новый Структура;
			СтруктураРасшифровки.Вставить("Документ", "Документ");			
			ПараметрыОтчета.ИсходящиеДанные.Вставить("СверкаБухИРегистровНДССтруктураРасшифровки", СтруктураРасшифровки);
			СтруктураШириныКолонок = Новый Структура;
			СтруктураШириныКолонок.Вставить("Счет", 30);
			СтруктураШириныКолонок.Вставить("Регистр", 40);
			СтруктураШириныКолонок.Вставить("Документ", 60);
			СтруктураШириныКолонок.Вставить("СуммаПоДаннымБухУчета", 40);
			СтруктураШириныКолонок.Вставить("СуммаВПодсистемеНДС", 40);
			ПараметрыОтчета.ИсходящиеДанные.Вставить("СверкаБухИРегистровНДССтруктураШириныКолонок", СтруктураШириныКолонок);
			
		КонецЕсли;
		
	Иначе
		СтрокаПравила.ОбнаруженыОшибки      = Ложь;
		СтрокаПравила.ПроверкаВыполнена     = Истина;		
	КонецЕсли;
	
КонецПроцедуры // ПроверитьПравилоСверкаБухИРегистровНДС()

Процедура ПроверитьПравилоПроверкаВыданныхСчетовФактур(СтрокаПравила, ПараметрыОтчета)

	// Алгоритм проверки	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("НачДата", 		ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("КонДата", 		КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация", 	ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("Электронно", 	Перечисления.СпособыОбменаДокументами.Электронно);
	
	Запрос.УстановитьПараметр("ВалютаРегламентированногоУчета", Константы.ВалютаРегламентированногоУчета.Получить());
	
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	СписокСчетовФактурТекст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	                          |	СчетФактураВыданный.Ссылка КАК Ссылка,
	                          |	СчетФактураВыданный.КурсВзаиморасчетов КАК КурсВзаиморасчетов,
	                          |	СчетФактураВыданный.КратностьВзаиморасчетов КАК КратностьВзаиморасчетов,
	                          |	СчетФактураВыданный.СпособВыставления = &Электронно КАК Электронно
	                          |ПОМЕСТИТЬ СчетФактураВыданный
	                          |ИЗ
	                          |	Документ.СчетФактураВыданный КАК СчетФактураВыданный
	                          |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СчетаФактурыПрекратившиеДействие КАК СчетаФактурыПрекратившиеДействие
	                          |		ПО СчетФактураВыданный.Ссылка = СчетаФактурыПрекратившиеДействие.СчетФактура
	                          |ГДЕ
	                          |	СчетФактураВыданный.Дата МЕЖДУ &НачДата И &КонДата
	                          |	И СчетФактураВыданный.Проведен
	                          |	И СчетФактураВыданный.Организация В(&Организация)
	                          |	И СчетФактураВыданный.ПодтвержденДокументамиОтгрузки
	                          |	И СчетаФактурыПрекратившиеДействие.СчетФактура ЕСТЬ NULL
	                          |;
	                          |
	                          |////////////////////////////////////////////////////////////////////////////////
	                          |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	                          |	СчетФактураВыданныйДокументыОснования.Ссылка КАК Ссылка,
	                          |	СчетФактураВыданныйДокументыОснования.ДокументОснование КАК ДокументОснование
	                          |ПОМЕСТИТЬ СчетФактураВыданныйДокументыОснования
	                          |ИЗ
	                          |	Документ.СчетФактураВыданный.ДокументыОснования КАК СчетФактураВыданныйДокументыОснования
	                          |ГДЕ
	                          |	СчетФактураВыданныйДокументыОснования.Ссылка В
	                          |			(ВЫБРАТЬ
	                          |				СчетФактураВыданный.Ссылка
	                          |			ИЗ
	                          |				СчетФактураВыданный)
	                          |;
	                          |
	                          |////////////////////////////////////////////////////////////////////////////////
	                          |ВЫБРАТЬ
	                          |	МИНИМУМ(СчетФактураВыданныйДокументыОснования.ДокументОснование.Дата) КАК МинДатаОснования
	                          |ИЗ
	                          |	СчетФактураВыданныйДокументыОснования КАК СчетФактураВыданныйДокументыОснования";
										  
										  
	Запрос.Текст = СписокСчетовФактурТекст;
	
	РезультатНачДатаОснования = Запрос.Выполнить();
	Если РезультатНачДатаОснования.Пустой() Тогда
		НачДатаОснований = ПараметрыОтчета.ДатаНач;
	Иначе
		ВыборкаДат = РезультатНачДатаОснования.Выбрать();
		ВыборкаДат.Следующий();
		НачДатаОснований = ВыборкаДат.МинДатаОснования;
	КонецЕсли;
	Запрос.УстановитьПараметр("НачДатаОснований", НачДатаОснований);

	СписокСчетовФактурТекст = "СчетФактураВыданный";
	
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	АктуальныеЭСФ.СчетФактура КАК СчетФактура,
	               |	АктуальныеЭСФ.ЭСФ КАК ЭСФ,
	               |	СУММА(ЕСТЬNULL(ЭСФТовары.СуммаБезНалогов, 0) + ЕСТЬNULL(ЭСФТовары.СуммаАкциза, 0)) КАК СуммаБезНДС,
	               |	СУММА(ЕСТЬNULL(ЭСФТовары.СуммаНДС, 0)) КАК СуммаНДС,
	               |	ВЫБОР
	               |		КОГДА АктуальныеЭСФ.ЭСФ.Валюта <> &ВалютаРегламентированногоУчета
	               |			ТОГДА АктуальныеЭСФ.ЭСФ.КурсВалюты
	               |		ИНАЧЕ 1
	               |	КОНЕЦ КАК КурсВалюты
	               |ПОМЕСТИТЬ АктуальныеЭСФ
	               |ИЗ
	               |	РегистрСведений.АктуальныеЭСФ КАК АктуальныеЭСФ
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭСФ.Товары КАК ЭСФТовары
	               |		ПО АктуальныеЭСФ.ЭСФ = ЭСФТовары.Ссылка
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СчетФактураВыданный КАК СчетФактураВыданный
	               |		ПО АктуальныеЭСФ.СчетФактура = СчетФактураВыданный.Ссылка
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	АктуальныеЭСФ.СчетФактура,
	               |	АктуальныеЭСФ.ЭСФ,
	               |	ВЫБОР
	               |		КОГДА АктуальныеЭСФ.ЭСФ.Валюта <> &ВалютаРегламентированногоУчета
	               |			ТОГДА АктуальныеЭСФ.ЭСФ.КурсВалюты
	               |		ИНАЧЕ 1
	               |	КОНЕЦ
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	АктуальныеЭСФ.СчетФактура КАК СчетФактура,
	               |	АктуальныеЭСФ.ЭСФ КАК ЭСФ,
	               |	ВЫРАЗИТЬ(АктуальныеЭСФ.СуммаБезНДС * АктуальныеЭСФ.КурсВалюты КАК ЧИСЛО(15, 2)) КАК СуммаБезНДС,
	               |	ВЫРАЗИТЬ(АктуальныеЭСФ.СуммаНДС * АктуальныеЭСФ.КурсВалюты КАК ЧИСЛО(15, 2)) КАК СуммаНДС
	               |ПОМЕСТИТЬ ДанныеЭСФ
	               |ИЗ
	               |	АктуальныеЭСФ КАК АктуальныеЭСФ";	
	Запрос.Выполнить();
	
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ДанныеСчетовФактур.Ссылка КАК Ссылка,
	               |	ЕСТЬNULL(ДанныеРегистраторов.Регистратор, ""<Отсутствует>"") КАК Регистратор,
	               |	ВЫБОР
	               |		КОГДА ДанныеСчетовФактур.Электронно
	               |			ТОГДА ЕСТЬNULL(ДанныеЭСФ.ЭСФ, ""<Отсутствует>"")
	               |		ИНАЧЕ ""<СФ на бумажном носителе>""
	               |	КОНЕЦ КАК ЭСФ,
	               |	ДанныеСчетовФактур.Электронно КАК Электронно,
	               |	ДанныеСчетовФактур.СуммаНДС КАК СуммаНДС,
	               |	ДанныеСчетовФактур.СуммаБезНДС КАК СуммаБезНДС,
	               |	ЕСТЬNULL(ДанныеРегистраторов.СуммаНДС, 0) КАК СуммаНДСОтгрузки,
	               |	ЕСТЬNULL(ДанныеРегистраторов.СуммаБезНДС, 0) КАК СуммаБезНДСОтгрузки,
	               |	ЕСТЬNULL(ДанныеЭСФ.СуммаНДС, 0) КАК СуммаНДСЭСФ,
	               |	ЕСТЬNULL(ДанныеЭСФ.СуммаБезНДС, 0) КАК СуммаБезНДСЭСФ
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ДанныеСчетовФактур.Ссылка КАК Ссылка,
	               |		ДанныеСчетовФактур.Электронно КАК Электронно,
	               |		ВЫРАЗИТЬ(СУММА(ДанныеСчетовФактур.СуммаНДС) * ДанныеСчетовФактур.КурсВзаиморасчетов / ВЫБОР
	               |				КОГДА ДанныеСчетовФактур.КратностьВзаиморасчетов = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ДанныеСчетовФактур.КратностьВзаиморасчетов
	               |			КОНЕЦ КАК ЧИСЛО(15, 2)) КАК СуммаНДС,
	               |		ВЫРАЗИТЬ(СУММА(ДанныеСчетовФактур.СуммаБезНДС) * ДанныеСчетовФактур.КурсВзаиморасчетов / ВЫБОР
	               |				КОГДА ДанныеСчетовФактур.КратностьВзаиморасчетов = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ДанныеСчетовФактур.КратностьВзаиморасчетов
	               |			КОНЕЦ КАК ЧИСЛО(15, 2)) КАК СуммаБезНДС
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			СчетФактураВыданный.Ссылка КАК Ссылка,
	               |			СчетФактураВыданный.КратностьВзаиморасчетов КАК КратностьВзаиморасчетов,
	               |			СчетФактураВыданный.КурсВзаиморасчетов КАК КурсВзаиморасчетов,
	               |			СчетФактураВыданный.Электронно КАК Электронно,
	               |			ЕСТЬNULL(ДанныеСчетовФактур.СуммаАкциза, 0) КАК СуммаАкциза,
	               |			ЕСТЬNULL(ДанныеСчетовФактур.СуммаНДС, 0) КАК СуммаНДС,
	               |			ЕСТЬNULL(ДанныеСчетовФактур.СуммаБезНалогов, 0) КАК СуммаБезНДС
	               |		ИЗ
	               |			СчетФактураВыданный КАК СчетФактураВыданный
	               |				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |					СчетФактураТовары.Ссылка КАК Ссылка,
	               |					СчетФактураТовары.СуммаАкциза КАК СуммаАкциза,
	               |					СчетФактураТовары.СуммаНДС КАК СуммаНДС,
	               |					СчетФактураТовары.Сумма - ВЫБОР
	               |						КОГДА СчетФактураТовары.Ссылка.СуммаВключаетНДС
	               |							ТОГДА СчетФактураТовары.СуммаНДС
	               |						ИНАЧЕ 0
	               |					КОНЕЦ + ВЫБОР
	               |						КОГДА НЕ СчетФактураТовары.Ссылка.СуммаВключаетАкциз
	               |							ТОГДА СчетФактураТовары.СуммаАкциза
	               |						ИНАЧЕ 0
	               |					КОНЕЦ КАК СуммаБезНалогов
	               |				ИЗ
	               |					Документ.СчетФактураВыданный.Товары КАК СчетФактураТовары
	               |				ГДЕ
	               |					СчетФактураТовары.Ссылка В
	               |							(ВЫБРАТЬ
	               |								СчетФактураВыданный.Ссылка
	               |							ИЗ
	               |								СчетФактураВыданный)
	               |				
	               |				ОБЪЕДИНИТЬ ВСЕ
	               |				
	               |				ВЫБРАТЬ
	               |					СчетФактураУслуги.Ссылка,
	               |					0,
	               |					СчетФактураУслуги.СуммаНДС,
	               |					СчетФактураУслуги.Сумма - ВЫБОР
	               |						КОГДА СчетФактураУслуги.Ссылка.СуммаВключаетНДС
	               |							ТОГДА СчетФактураУслуги.СуммаНДС
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |				ИЗ
	               |					Документ.СчетФактураВыданный.Услуги КАК СчетФактураУслуги
	               |				ГДЕ
	               |					СчетФактураУслуги.Ссылка В
	               |							(ВЫБРАТЬ
	               |								СчетФактураВыданный.Ссылка
	               |							ИЗ
	               |								СчетФактураВыданный)
	               |				
	               |				ОБЪЕДИНИТЬ ВСЕ
	               |				
	               |				ВЫБРАТЬ
	               |					СчетФактураОС.Ссылка,
	               |					0,
	               |					СчетФактураОС.СуммаНДС,
	               |					СчетФактураОС.Сумма - ВЫБОР
	               |						КОГДА СчетФактураОС.Ссылка.СуммаВключаетНДС
	               |							ТОГДА СчетФактураОС.СуммаНДС
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |				ИЗ
	               |					Документ.СчетФактураВыданный.ОС КАК СчетФактураОС
	               |				ГДЕ
	               |					СчетФактураОС.Ссылка В
	               |							(ВЫБРАТЬ
	               |								СчетФактураВыданный.Ссылка
	               |							ИЗ
	               |								СчетФактураВыданный)
	               |				
	               |				ОБЪЕДИНИТЬ ВСЕ
	               |				
	               |				ВЫБРАТЬ
	               |					СчетФактураНМА.Ссылка,
	               |					0,
	               |					СчетФактураНМА.СуммаНДС,
	               |					СчетФактураНМА.Сумма - ВЫБОР
	               |						КОГДА СчетФактураНМА.Ссылка.СуммаВключаетНДС
	               |							ТОГДА СчетФактураНМА.СуммаНДС
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |				ИЗ
	               |					Документ.СчетФактураВыданный.НМА КАК СчетФактураНМА
	               |				ГДЕ
	               |					СчетФактураНМА.Ссылка В
	               |							(ВЫБРАТЬ
	               |								СчетФактураВыданный.Ссылка
	               |							ИЗ
	               |								СчетФактураВыданный)) КАК ДанныеСчетовФактур
	               |				ПО СчетФактураВыданный.Ссылка = ДанныеСчетовФактур.Ссылка) КАК ДанныеСчетовФактур
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		ДанныеСчетовФактур.Ссылка,
	               |		ДанныеСчетовФактур.КурсВзаиморасчетов,
	               |		ДанныеСчетовФактур.КратностьВзаиморасчетов,
	               |		ДанныеСчетовФактур.Электронно) КАК ДанныеСчетовФактур
	               |		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |			ДанныеРегистраторов.Регистратор КАК Регистратор,
	               |			ДанныеРегистраторов.СуммаБезНДС КАК СуммаБезНДС,
	               |			ДанныеРегистраторов.ОборотПоРеализации КАК ОборотПоРеализации,
	               |			ДанныеРегистраторов.СуммаНДС КАК СуммаНДС,
	               |			СчетФактураВыданныйДокументыОснования.Ссылка КАК СчетФактура,
	               |			СчетФактураВыданныйДокументыОснования.ДокументОснование КАК ДокументРегистратор
	               |		ИЗ
				   |			СчетФактураВыданныйДокументыОснования КАК СчетФактураВыданныйДокументыОснования
	               |				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |					НДС.Регистратор КАК Регистратор,
	               |					СУММА(НДС.СуммаБезНДС) КАК СуммаБезНДС,
	               |					СУММА(НДС.ОборотПоРеализации) КАК ОборотПоРеализации,
	               |					СУММА(НДС.СуммаНДС) КАК СуммаНДС
	               |				ИЗ
	               |					РегистрНакопления.НДС КАК НДС
	               |				ГДЕ
	               |					НДС.Период >= &НачДатаОснований
	               |					И НДС.Организация В(&Организация)
	               |					И НДС.Регистратор В(ВЫБРАТЬ СчетФактураВыданныйДокументыОснования.ДокументОснование ИЗ СчетФактураВыданныйДокументыОснования)
	               |				
	               |				СГРУППИРОВАТЬ ПО
	               |					НДС.Регистратор
	               |				
	               |				ОБЪЕДИНИТЬ ВСЕ
	               |				
	               |				ВЫБРАТЬ
	               |					КорректировкаНДС.Регистратор,
	               |					СУММА(КорректировкаНДС.СуммаКорректировкиОборота),
	               |					СУММА(КорректировкаНДС.СуммаКорректировкиОборота),
	               |					СУММА(КорректировкаНДС.СуммаНДС)
	               |				ИЗ
	               |					РегистрНакопления.КорректировкаНДС КАК КорректировкаНДС
	               |				ГДЕ
	               |					КорректировкаНДС.Период >= &НачДатаОснований
	               |					И КорректировкаНДС.Организация В(&Организация)
	               |					И КорректировкаНДС.Регистратор В(ВЫБРАТЬ СчетФактураВыданныйДокументыОснования.ДокументОснование ИЗ СчетФактураВыданныйДокументыОснования)
	               |				
	               |				СГРУППИРОВАТЬ ПО
	               |					КорректировкаНДС.Регистратор) КАК ДанныеРегистраторов
	               |				ПО (ДанныеРегистраторов.Регистратор = СчетФактураВыданныйДокументыОснования.ДокументОснование)) КАК ДанныеРегистраторов
	               |		ПО (ДанныеРегистраторов.СчетФактура = ДанныеСчетовФактур.Ссылка)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ДанныеЭСФ КАК ДанныеЭСФ
	               |		ПО (ДанныеЭСФ.СчетФактура = ДанныеСчетовФактур.Ссылка)
	               |ГДЕ
	               |	(ЕСТЬNULL(ДанныеРегистраторов.СуммаБезНДС, 0) <> ДанныеСчетовФактур.СуммаБезНДС
	               |			ИЛИ ЕСТЬNULL(ДанныеРегистраторов.СуммаНДС, 0) <> ДанныеСчетовФактур.СуммаНДС
	               |			ИЛИ ДанныеСчетовФактур.Электронно
	               |				И ЕСТЬNULL(ДанныеЭСФ.СуммаНДС, 0) <> ДанныеСчетовФактур.СуммаНДС
	               |			ИЛИ ДанныеСчетовФактур.Электронно
	               |				И ЕСТЬNULL(ДанныеЭСФ.СуммаБезНДС, 0) <> ДанныеСчетовФактур.СуммаБезНДС)
	               |ИТОГИ
	               |	МАКСИМУМ(Электронно),
	               |	МАКСИМУМ(СуммаНДС),
	               |	МАКСИМУМ(СуммаБезНДС),
	               |	СУММА(СуммаНДСОтгрузки),
	               |	СУММА(СуммаБезНДСОтгрузки),
	               |	МАКСИМУМ(СуммаНДСЭСФ),
	               |	МАКСИМУМ(СуммаБезНДСЭСФ)
	               |ПО
	               |	Ссылка";
				 
	Результат = Запрос.Выполнить();	

	СтрокаПравила.ПроверкаВыполнена = Истина;
			
	Выборка = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	ТипЧисло = Новый ОписаниеТипов("Число");
	ТаблицаОшибок = Новый ТаблицаЗначений;
	ТаблицаОшибок.Колонки.Добавить("Ссылка");
	ТаблицаОшибок.Колонки.Добавить("ЭСФ");
	ТаблицаОшибок.Колонки.Добавить("Регистратор");
	ТаблицаОшибок.Колонки.Добавить("СуммаНДС"            , ТипЧисло);
	ТаблицаОшибок.Колонки.Добавить("СуммаНДСОтгрузки"    , ТипЧисло);
	ТаблицаОшибок.Колонки.Добавить("СуммаНДСЭСФ"         , ТипЧисло);
	ТаблицаОшибок.Колонки.Добавить("СуммаБезНДС"         , ТипЧисло);
	ТаблицаОшибок.Колонки.Добавить("СуммаБезНДСОтгрузки" , ТипЧисло);    	
	ТаблицаОшибок.Колонки.Добавить("СуммаБезНДСЭСФ"      , ТипЧисло);    	
	
	Пока Выборка.Следующий() Цикл
		СуммаНДСОтклонение    = Выборка.СуммаНДС    - Выборка.СуммаНДСОтгрузки;
		СуммаБезНДСОтклонение = Выборка.СуммаБезНДС - Выборка.СуммаБезНДСОтгрузки;
		Если Выборка.Электронно Тогда
			СуммаНДСОтклонениеЭСФ    = Выборка.СуммаНДС    - Выборка.СуммаНДСЭСФ;
			СуммаБезНДСОтклонениеЭСФ = Выборка.СуммаБезНДС - Выборка.СуммаБезНДСЭСФ;
		Иначе
			СуммаНДСОтклонениеЭСФ    = 0;
			СуммаБезНДСОтклонениеЭСФ = 0;
		КонецЕсли;
		
		//проверим если есть отклонения, в случае когда у Счет-фактуры оснований больше одного
		Если СуммаНДСОтклонение = 0 И СуммаБезНДСОтклонение = 0 И СуммаНДСОтклонениеЭСФ = 0 И СуммаБезНДСОтклонениеЭСФ = 0 Тогда 
			Продолжить;
		КонецЕсли;
			
		ВыборкаПоРегистраторам = Выборка.Выбрать();
		Пока ВыборкаПоРегистраторам.Следующий() Цикл
			СтрокаОшибки = ТаблицаОшибок.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаОшибки, ВыборкаПоРегистраторам);			
		КонецЦикла;
	КонецЦикла;
	
	Если Не ТаблицаОшибок.Количество() = 0 Тогда
		СтрокаПравила.ОбнаруженыОшибки  = Истина;
		
		ИсточникДанных = Новый ОписаниеИсточникаДанных(ТаблицаОшибок);
		ИсточникДанных.Колонки.Ссылка.Измерение = Истина;
		ИсточникДанных.Колонки.ЭСФ.Итог                 = "МАКСИМУМ(ЭСФ)";
		ИсточникДанных.Колонки.СуммаНДС.Итог 			= "МАКСИМУМ(СуммаНДС)";
		ИсточникДанных.Колонки.СуммаНДСОтгрузки.Итог 	= "СУММА(СуммаНДСОтгрузки)";
		ИсточникДанных.Колонки.СуммаНДСЭСФ.Итог         = "МАКСИМУМ(СуммаНДСЭСФ)";
		ИсточникДанных.Колонки.СуммаБезНДС.Итог  		= "МАКСИМУМ(СуммаБезНДС)";
		ИсточникДанных.Колонки.СуммаБезНДСОтгрузки.Итог = "СУММА(СуммаБезНДСОтгрузки)";
		ИсточникДанных.Колонки.СуммаБезНДСЭСФ.Итог      = "МАКСИМУМ(СуммаБезНДСЭСФ)";
	
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаВыданныхСчетовФактурИсточникДанных", ИсточникДанных);
		
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("Ссылка",              "Счет-фактура");
		СтруктураЗаголовков.Вставить("Регистратор",         "Документ отгрузки");
		СтруктураЗаголовков.Вставить("ЭСФ",                 "ЭСФ");
		СтруктураЗаголовков.Вставить("СуммаНДС",            "НДС по счету-фактуре");
		СтруктураЗаголовков.Вставить("СуммаНДСОтгрузки",    "НДС по документам отгрузки");		
		СтруктураЗаголовков.Вставить("СуммаНДСЭСФ",         "НДС по документам ЭСФ");		
		
		СтруктураЗаголовков.Вставить("СуммаБезНДС",         "Без НДС по счету-фактуре");
		СтруктураЗаголовков.Вставить("СуммаБезНДСОтгрузки", "Без НДС по документам отгрузки");		
		СтруктураЗаголовков.Вставить("СуммаБезНДСЭСФ",      "Без НДС по документам ЭСФ");		
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаВыданныхСчетовФактурСтруктураЗаголовков", СтруктураЗаголовков);
		
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Ссылка",              "Ссылка");
		СтруктураРасшифровки.Вставить("СуммаНДС",            "Ссылка");
		СтруктураРасшифровки.Вставить("СуммаБезНДС",         "Ссылка");
		
		СтруктураРасшифровки.Вставить("Регистратор",         "Регистратор");		
		СтруктураРасшифровки.Вставить("СуммаНДСОтгрузки",    "Регистратор");		
		СтруктураРасшифровки.Вставить("СуммаБезНДСОтгрузки", "Регистратор");
		
		СтруктураРасшифровки.Вставить("ЭСФ",                 "ЭСФ");		
		СтруктураРасшифровки.Вставить("СуммаНДСЭСФ",         "ЭСФ");		
		СтруктураРасшифровки.Вставить("СуммаБезНДСЭСФ",      "ЭСФ");
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаВыданныхСчетовФактурСтруктураРасшифровки", СтруктураРасшифровки);
		
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("Ссылка", 				60);
		СтруктураШириныКолонок.Вставить("ЭСФ",                  60);
		СтруктураШириныКолонок.Вставить("Регистратор", 			120);
		СтруктураШириныКолонок.Вставить("СуммаНДС", 		  	40);
		СтруктураШириныКолонок.Вставить("СуммаБезНДС",	  		50);		
		СтруктураШириныКолонок.Вставить("СуммаНДСОтгрузки", 	40);		
		СтруктураШириныКолонок.Вставить("СуммаБезНДСОтгрузки",	50);		
		СтруктураШириныКолонок.Вставить("СуммаНДСЭСФ",          40);		
		СтруктураШириныКолонок.Вставить("СуммаБезНДСЭСФ",       50);		
				
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаВыданныхСчетовФактурСтруктураШириныКолонок", СтруктураШириныКолонок);	
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаВыданныхСчетовФактурМакетОформления", "ПроверкаВыпискиСчетовФактур");
	Иначе
		
		СтрокаПравила.ОбнаруженыОшибки = Ложь;	
				
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоПроверкаПолученныхСчетовФактур(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("НачДата", 		ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("КонДата", 		КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация", 	ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("Электронно", 	Перечисления.СпособыОбменаДокументами.Электронно);
	
	Запрос.УстановитьПараметр("ВалютаРегламентированногоУчета", Константы.ВалютаРегламентированногоУчета.Получить());
	
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	СписокСчетовФактурТекст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	                          |	СчетФактураПолученный.Ссылка КАК Ссылка,
	                          |	СчетФактураПолученный.КурсВзаиморасчетов КАК КурсВзаиморасчетов,
	                          |	СчетФактураПолученный.КратностьВзаиморасчетов КАК КратностьВзаиморасчетов,
	                          |	СчетФактураПолученный.СпособПолучения = &Электронно КАК Электронно
	                          |ПОМЕСТИТЬ СчетФактураПолученный
	                          |ИЗ
	                          |	Документ.СчетФактураПолученный КАК СчетФактураПолученный
	                          |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СчетаФактурыПрекратившиеДействие КАК СчетаФактурыПрекратившиеДействие
	                          |		ПО СчетФактураПолученный.Ссылка = СчетаФактурыПрекратившиеДействие.СчетФактура
	                          |ГДЕ
	                          |	СчетФактураПолученный.Дата МЕЖДУ &НачДата И &КонДата
	                          |	И СчетФактураПолученный.Проведен
	                          |	И СчетФактураПолученный.Организация В(&Организация)
	                          |	И СчетФактураПолученный.ПодтвержденДокументамиОтгрузки
	                          |	И СчетаФактурыПрекратившиеДействие.СчетФактура ЕСТЬ NULL
	                          |;
	                          |
	                          |////////////////////////////////////////////////////////////////////////////////
	                          |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	                          |	СчетФактураВыданныйДокументыОснования.Ссылка КАК Ссылка,
	                          |	СчетФактураВыданныйДокументыОснования.ДокументОснование КАК ДокументОснование
	                          |ПОМЕСТИТЬ СчетФактураВыданныйДокументыОснования
	                          |ИЗ
	                          |	Документ.СчетФактураПолученный.ДокументыОснования КАК СчетФактураВыданныйДокументыОснования
	                          |ГДЕ
	                          |	СчетФактураВыданныйДокументыОснования.Ссылка В
	                          |			(ВЫБРАТЬ
	                          |				СчетФактураПолученный.Ссылка
	                          |			ИЗ
	                          |				СчетФактураПолученный)
	                          |;
	                          |
	                          |////////////////////////////////////////////////////////////////////////////////
	                          |ВЫБРАТЬ
	                          |	МИНИМУМ(СчетФактураВыданныйДокументыОснования.ДокументОснование.Дата) КАК МинДатаОснования
	                          |ИЗ
	                          |	СчетФактураВыданныйДокументыОснования КАК СчетФактураВыданныйДокументыОснования";
							  
							  
	Запрос.Текст = СписокСчетовФактурТекст;

	РезультатНачДатаОснования = Запрос.Выполнить();
	Если РезультатНачДатаОснования.Пустой() Тогда
		НачДатаОснований = ПараметрыОтчета.ДатаНач;
	Иначе
		ВыборкаДат = РезультатНачДатаОснования.Выбрать();
		ВыборкаДат.Следующий();
		НачДатаОснований = ВыборкаДат.МинДатаОснования;
	КонецЕсли;
	Запрос.УстановитьПараметр("НачДатаОснований", НачДатаОснований);

	СписокСчетовФактурТекст = "СчетФактураПолученный";
	
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	АктуальныеЭСФ.СчетФактура КАК СчетФактура,
	               |	АктуальныеЭСФ.ЭСФ КАК ЭСФ,
	               |	СУММА(ЕСТЬNULL(ЭСФТовары.СуммаБезНалогов, 0) + ЕСТЬNULL(ЭСФТовары.СуммаАкциза, 0)) КАК СуммаБезНДС,
	               |	СУММА(ЕСТЬNULL(ЭСФТовары.СуммаНДС, 0)) КАК СуммаНДС,
	               |	ВЫБОР
	               |		КОГДА АктуальныеЭСФ.ЭСФ.Валюта <> &ВалютаРегламентированногоУчета
	               |			ТОГДА АктуальныеЭСФ.ЭСФ.КурсВалюты
	               |		ИНАЧЕ 1
	               |	КОНЕЦ КАК КурсВалюты
	               |ПОМЕСТИТЬ АктуальныеЭСФ
	               |ИЗ
	               |	РегистрСведений.АктуальныеЭСФ КАК АктуальныеЭСФ
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭСФ.Товары КАК ЭСФТовары
	               |		ПО АктуальныеЭСФ.ЭСФ = ЭСФТовары.Ссылка
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ СчетФактураПолученный КАК СчетФактураПолученный
	               |		ПО АктуальныеЭСФ.СчетФактура = СчетФактураПолученный.Ссылка
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	АктуальныеЭСФ.СчетФактура,
	               |	АктуальныеЭСФ.ЭСФ,
	               |	ВЫБОР
	               |		КОГДА АктуальныеЭСФ.ЭСФ.Валюта <> &ВалютаРегламентированногоУчета
	               |			ТОГДА АктуальныеЭСФ.ЭСФ.КурсВалюты
	               |		ИНАЧЕ 1
	               |	КОНЕЦ
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	АктуальныеЭСФ.СчетФактура КАК СчетФактура,
	               |	АктуальныеЭСФ.ЭСФ КАК ЭСФ,
	               |	ВЫРАЗИТЬ(АктуальныеЭСФ.СуммаБезНДС * АктуальныеЭСФ.КурсВалюты КАК ЧИСЛО(15, 2)) КАК СуммаБезНДС,
	               |	ВЫРАЗИТЬ(АктуальныеЭСФ.СуммаНДС * АктуальныеЭСФ.КурсВалюты КАК ЧИСЛО(15, 2)) КАК СуммаНДС
	               |ПОМЕСТИТЬ ДанныеЭСФ
	               |ИЗ
	               |	АктуальныеЭСФ КАК АктуальныеЭСФ";	
	Запрос.Выполнить();
	
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ДанныеСчетовФактур.Ссылка КАК Ссылка,
	               |	ЕСТЬNULL(ДанныеРегистраторов.Регистратор, ""<Отсутствует>"") КАК Регистратор,
	               |	ВЫБОР
	               |		КОГДА ДанныеСчетовФактур.Электронно
	               |			ТОГДА ЕСТЬNULL(ДанныеЭСФ.ЭСФ, ""<Отсутствует>"")
	               |		ИНАЧЕ ""<СФ на бумажном носителе>""
	               |	КОНЕЦ КАК ЭСФ,
	               |	ДанныеСчетовФактур.Электронно КАК Электронно,
	               |	ДанныеСчетовФактур.СуммаНДС КАК СуммаНДС,
	               |	ДанныеСчетовФактур.СуммаБезНДС КАК СуммаБезНДС,
	               |	ЕСТЬNULL(ДанныеРегистраторов.СуммаНДС, 0) КАК СуммаНДСОтгрузки,
	               |	ЕСТЬNULL(ДанныеРегистраторов.СуммаБезНДС, 0) КАК СуммаБезНДСОтгрузки,
	               |	ЕСТЬNULL(ДанныеЭСФ.СуммаНДС, 0) КАК СуммаНДСЭСФ,
	               |	ЕСТЬNULL(ДанныеЭСФ.СуммаБезНДС, 0) КАК СуммаБезНДСЭСФ
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ДанныеСчетовФактур.Ссылка КАК Ссылка,
	               |		ДанныеСчетовФактур.Электронно КАК Электронно,
	               |		ВЫРАЗИТЬ(СУММА(ДанныеСчетовФактур.СуммаНДС) * ДанныеСчетовФактур.КурсВзаиморасчетов / ВЫБОР
	               |				КОГДА ДанныеСчетовФактур.КратностьВзаиморасчетов = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ДанныеСчетовФактур.КратностьВзаиморасчетов
	               |			КОНЕЦ КАК ЧИСЛО(15, 2)) КАК СуммаНДС,
	               |		ВЫРАЗИТЬ(СУММА(ДанныеСчетовФактур.СуммаБезНДС) * ДанныеСчетовФактур.КурсВзаиморасчетов / ВЫБОР
	               |				КОГДА ДанныеСчетовФактур.КратностьВзаиморасчетов = 0
	               |					ТОГДА 1
	               |				ИНАЧЕ ДанныеСчетовФактур.КратностьВзаиморасчетов
	               |			КОНЕЦ КАК ЧИСЛО(15, 2)) КАК СуммаБезНДС
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			ДанныеСчетовФактур.Ссылка КАК Ссылка,
	               |			ДанныеСчетовФактур.КурсВзаиморасчетов КАК КурсВзаиморасчетов,
	               |			ДанныеСчетовФактур.КратностьВзаиморасчетов КАК КратностьВзаиморасчетов,
	               |			ДанныеСчетовФактур.Электронно КАК Электронно,
	               |			ЕСТЬNULL(ДанныеСчетовФактур.СуммаНДС, 0) КАК СуммаНДС,
	               |			ЕСТЬNULL(ДанныеСчетовФактур.СуммаБезНДС, 0) КАК СуммаБезНДС
	               |		ИЗ
	               |			(ВЫБРАТЬ
	               |				СчетФактураПолученный.Ссылка КАК Ссылка,
	               |				СчетФактураПолученный.КурсВзаиморасчетов КАК КурсВзаиморасчетов,
	               |				СчетФактураПолученный.КратностьВзаиморасчетов КАК КратностьВзаиморасчетов,
	               |				СчетФактураПолученный.Электронно КАК Электронно,
	               |				ДанныеСчетовФактур.СуммаНДС КАК СуммаНДС,
	               |				ДанныеСчетовФактур.СуммаБезНалогов КАК СуммаБезНДС
	               |			ИЗ
	               |				СчетФактураПолученный КАК СчетФактураПолученный
	               |					ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |						СчетФактураТовары.Ссылка КАК Ссылка,
	               |						СчетФактураТовары.СуммаНДС КАК СуммаНДС,
	               |						СчетФактураТовары.Сумма - ВЫБОР
	               |							КОГДА СчетФактураТовары.Ссылка.СуммаВключаетНДС
	               |								ТОГДА СчетФактураТовары.СуммаНДС
	               |							ИНАЧЕ 0
	               |						КОНЕЦ КАК СуммаБезНалогов
	               |					ИЗ
	               |						Документ.СчетФактураПолученный.Товары КАК СчетФактураТовары
	               |					ГДЕ
	               |						СчетФактураТовары.Ссылка В
	               |								(ВЫБРАТЬ
	               |									СчетФактураПолученный.Ссылка
	               |								ИЗ
	               |									СчетФактураПолученный)
	               |					
	               |					ОБЪЕДИНИТЬ ВСЕ
	               |					
	               |					ВЫБРАТЬ
	               |						СчетФактураУслуги.Ссылка,
	               |						СчетФактураУслуги.СуммаНДС,
	               |						СчетФактураУслуги.Сумма - ВЫБОР
	               |							КОГДА СчетФактураУслуги.Ссылка.СуммаВключаетНДС
	               |								ТОГДА СчетФактураУслуги.СуммаНДС
	               |							ИНАЧЕ 0
	               |						КОНЕЦ
	               |					ИЗ
	               |						Документ.СчетФактураПолученный.Услуги КАК СчетФактураУслуги
	               |					ГДЕ
	               |						СчетФактураУслуги.Ссылка В
	               |								(ВЫБРАТЬ
	               |									СчетФактураПолученный.Ссылка
	               |								ИЗ
	               |									СчетФактураПолученный)
	               |					
	               |					ОБЪЕДИНИТЬ ВСЕ
	               |					
	               |					ВЫБРАТЬ
	               |						СчетФактураОС.Ссылка,
	               |						СчетФактураОС.СуммаНДС,
	               |						СчетФактураОС.Сумма - ВЫБОР
	               |							КОГДА СчетФактураОС.Ссылка.СуммаВключаетНДС
	               |								ТОГДА СчетФактураОС.СуммаНДС
	               |							ИНАЧЕ 0
	               |						КОНЕЦ
	               |					ИЗ
	               |						Документ.СчетФактураПолученный.ОС КАК СчетФактураОС
	               |					ГДЕ
	               |						СчетФактураОС.Ссылка В
	               |								(ВЫБРАТЬ
	               |									СчетФактураПолученный.Ссылка
	               |								ИЗ
	               |									СчетФактураПолученный)
	               |					
	               |					ОБЪЕДИНИТЬ ВСЕ
	               |					
	               |					ВЫБРАТЬ
	               |						СчетФактураНМА.Ссылка,
	               |						СчетФактураНМА.СуммаНДС,
	               |						СчетФактураНМА.Сумма - ВЫБОР
	               |							КОГДА СчетФактураНМА.Ссылка.СуммаВключаетНДС
	               |								ТОГДА СчетФактураНМА.СуммаНДС
	               |							ИНАЧЕ 0
	               |						КОНЕЦ
	               |					ИЗ
	               |						Документ.СчетФактураПолученный.НМА КАК СчетФактураНМА
	               |					ГДЕ
	               |						СчетФактураНМА.Ссылка В
	               |								(ВЫБРАТЬ
	               |									СчетФактураПолученный.Ссылка
	               |								ИЗ
	               |									СчетФактураПолученный)) КАК ДанныеСчетовФактур
	               |					ПО (ДанныеСчетовФактур.Ссылка = СчетФактураПолученный.Ссылка)) КАК ДанныеСчетовФактур) КАК ДанныеСчетовФактур
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		ДанныеСчетовФактур.Ссылка,
	               |		ДанныеСчетовФактур.КурсВзаиморасчетов,
	               |		ДанныеСчетовФактур.КратностьВзаиморасчетов,
	               |		ДанныеСчетовФактур.Электронно) КАК ДанныеСчетовФактур
	               |		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |			ДанныеРегистраторов.Регистратор КАК Регистратор,
	               |			ДанныеРегистраторов.СуммаБезНДС КАК СуммаБезНДС,
	               |			ДанныеРегистраторов.СуммаНДС КАК СуммаНДС,
	               |			СчетФактураВыданныйДокументыОснования.Ссылка КАК СчетФактура,
	               |			СчетФактураВыданныйДокументыОснования.ДокументОснование КАК ДокументРегистратор
	               |		ИЗ
				   |			СчетФактураВыданныйДокументыОснования КАК СчетФактураВыданныйДокументыОснования
	               |				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |					НДС.Регистратор КАК Регистратор,
	               |					НДС.СчетФактура КАК СчетФактураСтроки,
	               |					СУММА(НДС.СуммаБезНДС) КАК СуммаБезНДС,
	               |					СУММА(НДС.УплаченныйНДС) КАК СуммаНДС
	               |				ИЗ
	               |					РегистрНакопления.НДСКВозмещению КАК НДС
	               |				ГДЕ
	               |					НДС.Период >= &НачДатаОснований
	               |					И НДС.Организация В(&Организация)
	               |					И НДС.Регистратор В(ВЫБРАТЬ СчетФактураВыданныйДокументыОснования.ДокументОснование ИЗ СчетФактураВыданныйДокументыОснования)
	               |				
	               |				СГРУППИРОВАТЬ ПО
	               |					НДС.Регистратор,
	               |					НДС.СчетФактура
	               |				
	               |				ОБЪЕДИНИТЬ ВСЕ
	               |				
	               |				ВЫБРАТЬ
	               |					КорректировкаНДС.Регистратор,
	               |					NULL,
	               |					СУММА(КорректировкаНДС.СуммаКорректировкиОборота),
	               |					СУММА(КорректировкаНДС.УплаченныйНДС)
	               |				ИЗ
	               |					РегистрНакопления.КорректировкаНДСКВозмещению КАК КорректировкаНДС
	               |				ГДЕ
	               |					КорректировкаНДС.Период >= &НачДатаОснований
	               |					И КорректировкаНДС.Организация В(&Организация)
	               |					И КорректировкаНДС.Регистратор В(ВЫБРАТЬ СчетФактураВыданныйДокументыОснования.ДокументОснование ИЗ СчетФактураВыданныйДокументыОснования)
	               |				
	               |				СГРУППИРОВАТЬ ПО
	               |					КорректировкаНДС.Регистратор) КАК ДанныеРегистраторов
	               |				ПО (ДанныеРегистраторов.Регистратор = СчетФактураВыданныйДокументыОснования.ДокументОснование)
	               |					И (НЕ ДанныеРегистраторов.Регистратор ССЫЛКА Документ.АвансовыйОтчет
	               |						ИЛИ ДанныеРегистраторов.СчетФактураСтроки = СчетФактураВыданныйДокументыОснования.Ссылка)) КАК ДанныеРегистраторов
	               |		ПО (ДанныеРегистраторов.СчетФактура = ДанныеСчетовФактур.Ссылка)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ДанныеЭСФ КАК ДанныеЭСФ
	               |		ПО (ДанныеЭСФ.СчетФактура = ДанныеСчетовФактур.Ссылка)
	               |ГДЕ
	               |	(ЕСТЬNULL(ДанныеРегистраторов.СуммаБезНДС, 0) <> ДанныеСчетовФактур.СуммаБезНДС
	               |			ИЛИ ЕСТЬNULL(ДанныеРегистраторов.СуммаНДС, 0) <> ДанныеСчетовФактур.СуммаНДС
	               |			ИЛИ ДанныеСчетовФактур.Электронно
	               |				И ЕСТЬNULL(ДанныеЭСФ.СуммаНДС, 0) <> ДанныеСчетовФактур.СуммаНДС
	               |			ИЛИ ДанныеСчетовФактур.Электронно
	               |				И ЕСТЬNULL(ДанныеЭСФ.СуммаБезНДС, 0) <> ДанныеСчетовФактур.СуммаБезНДС)
	               |ИТОГИ
	               |	МАКСИМУМ(Электронно),
	               |	МАКСИМУМ(СуммаНДС),
	               |	МАКСИМУМ(СуммаБезНДС),
	               |	СУММА(СуммаНДСОтгрузки),
	               |	СУММА(СуммаБезНДСОтгрузки),
	               |	МАКСИМУМ(СуммаНДСЭСФ),
	               |	МАКСИМУМ(СуммаБезНДСЭСФ)
	               |ПО
	               |	Ссылка";
				   
	Результат = Запрос.Выполнить();	

	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Выборка = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	ТипЧисло = Новый ОписаниеТипов("Число");
	ТаблицаОшибок = Новый ТаблицаЗначений;
	ТаблицаОшибок.Колонки.Добавить("Ссылка");
	ТаблицаОшибок.Колонки.Добавить("ЭСФ");
	ТаблицаОшибок.Колонки.Добавить("Регистратор");
	ТаблицаОшибок.Колонки.Добавить("СуммаНДС"            , ТипЧисло);
	ТаблицаОшибок.Колонки.Добавить("СуммаНДСОтгрузки"    , ТипЧисло);
	ТаблицаОшибок.Колонки.Добавить("СуммаНДСЭСФ"         , ТипЧисло);
	ТаблицаОшибок.Колонки.Добавить("СуммаБезНДС"         , ТипЧисло);
	ТаблицаОшибок.Колонки.Добавить("СуммаБезНДСОтгрузки" , ТипЧисло);
	ТаблицаОшибок.Колонки.Добавить("СуммаБезНДСЭСФ"      , ТипЧисло);    	
	
	Пока Выборка.Следующий() Цикл
		СуммаНДСОтклонение = Выборка.СуммаНДС - Выборка.СуммаНДСОтгрузки;
		СуммаБезНДСОтклонение = Выборка.СуммаБезНДС - Выборка.СуммаБезНДСОтгрузки;
		Если Выборка.Электронно Тогда
			СуммаНДСОтклонениеЭСФ    = Выборка.СуммаНДС    - Выборка.СуммаНДСЭСФ;
			СуммаБезНДСОтклонениеЭСФ = Выборка.СуммаБезНДС - Выборка.СуммаБезНДСЭСФ;
		Иначе
			СуммаНДСОтклонениеЭСФ    = 0;
			СуммаБезНДСОтклонениеЭСФ = 0;
		КонецЕсли;
		
		//проверим если есть отклонения, в случае когда у Счет-фактуры оснований больше одного
		Если СуммаНДСОтклонение = 0 И СуммаБезНДСОтклонение = 0 И СуммаНДСОтклонениеЭСФ = 0 И СуммаБезНДСОтклонениеЭСФ = 0 Тогда 
			Продолжить;
		КонецЕсли;
		
		ВыборкаПоРегистраторам = Выборка.Выбрать();
		Пока ВыборкаПоРегистраторам.Следующий() Цикл
			СтрокаОшибки = ТаблицаОшибок.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаОшибки, ВыборкаПоРегистраторам);			
		КонецЦикла;
	КонецЦикла;
	
	Если Не ТаблицаОшибок.Количество() = 0 Тогда
		СтрокаПравила.ОбнаруженыОшибки  = Истина;
		
		ИсточникДанных = Новый ОписаниеИсточникаДанных(ТаблицаОшибок);
		ИсточникДанных.Колонки.Ссылка.Измерение = Истина;	          				   
		ИсточникДанных.Колонки.ЭСФ.Итог                 = "МАКСИМУМ(ЭСФ)";
		ИсточникДанных.Колонки.СуммаНДС.Итог 			= "МАКСИМУМ(СуммаНДС)";
		ИсточникДанных.Колонки.СуммаНДСОтгрузки.Итог 	= "СУММА(СуммаНДСОтгрузки)";
		ИсточникДанных.Колонки.СуммаНДСЭСФ.Итог         = "МАКСИМУМ(СуммаНДСЭСФ)";
		ИсточникДанных.Колонки.СуммаБезНДС.Итог  		= "МАКСИМУМ(СуммаБезНДС)";
		ИсточникДанных.Колонки.СуммаБезНДСОтгрузки.Итог = "СУММА(СуммаБезНДСОтгрузки)";
		ИсточникДанных.Колонки.СуммаБезНДСЭСФ.Итог      = "МАКСИМУМ(СуммаБезНДСЭСФ)";
	
	// Добавляем в ИсходящиеДанные данные, необходимые для формирования детального отчета по ошибкам
	// или данные для последующего использования другими проверками

		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаПолученныхСчетовФактурИсточникДанных", ИсточникДанных);
		
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("Ссылка",              "Счет-фактура");
		СтруктураЗаголовков.Вставить("Регистратор",         "Документ отгрузки");
		СтруктураЗаголовков.Вставить("ЭСФ",                 "ЭСФ");
		СтруктураЗаголовков.Вставить("СуммаНДС",            "НДС по счету-фактуре");
		СтруктураЗаголовков.Вставить("СуммаНДСОтгрузки",    "НДС по документам отгрузки");		
		СтруктураЗаголовков.Вставить("СуммаНДСЭСФ",         "НДС по документам ЭСФ");		
		
		СтруктураЗаголовков.Вставить("СуммаБезНДС",         "Без НДС по счету-фактуре");
		СтруктураЗаголовков.Вставить("СуммаБезНДСОтгрузки", "Без НДС по документам отгрузки");		
		СтруктураЗаголовков.Вставить("СуммаБезНДСЭСФ",      "Без НДС по документам ЭСФ");		
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаПолученныхСчетовФактурСтруктураЗаголовков", СтруктураЗаголовков);
		
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Ссылка",              "Ссылка");
		СтруктураРасшифровки.Вставить("СуммаНДС",            "Ссылка");
		СтруктураРасшифровки.Вставить("СуммаБезНДС",         "Ссылка");
		
		СтруктураРасшифровки.Вставить("Регистратор",         "Регистратор");		
		СтруктураРасшифровки.Вставить("СуммаНДСОтгрузки",    "Регистратор");		
		СтруктураРасшифровки.Вставить("СуммаБезНДСОтгрузки", "Регистратор");		
		
		СтруктураРасшифровки.Вставить("ЭСФ",                 "ЭСФ");		
		СтруктураРасшифровки.Вставить("СуммаНДСЭСФ",         "ЭСФ");		
		СтруктураРасшифровки.Вставить("СуммаБезНДСЭСФ",      "ЭСФ");
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаПолученныхСчетовФактурСтруктураРасшифровки", СтруктураРасшифровки);
			
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("Ссылка", 				60);
		СтруктураШириныКолонок.Вставить("ЭСФ",                  60);
		СтруктураШириныКолонок.Вставить("Регистратор", 			120);
		СтруктураШириныКолонок.Вставить("СуммаНДС", 		  	40);
		СтруктураШириныКолонок.Вставить("СуммаБезНДС",	  		50);		
		СтруктураШириныКолонок.Вставить("СуммаНДСОтгрузки", 	40);		
		СтруктураШириныКолонок.Вставить("СуммаБезНДСОтгрузки",	50);		
		СтруктураШириныКолонок.Вставить("СуммаНДСЭСФ",          40);		
		СтруктураШириныКолонок.Вставить("СуммаБезНДСЭСФ",       50);		
				
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаПолученныхСчетовФактурСтруктураШириныКолонок", СтруктураШириныКолонок);	
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаПолученныхСчетовФактурМакетОформления", "ПроверкаВыпискиСчетовФактур");
	Иначе
		СтрокаПравила.ОбнаруженыОшибки = Ложь;
	КонецЕсли;
	 	
КонецПроцедуры

// Для зачета по НДС поставщик должен являться плательщиком НДС
// Проверим его регистрационные данные
Процедура ПроверитьПравилоПроверкаРеквизитовПоставщиковПоНДС(СтрокаПравила, ПараметрыОтчета)
		
	ЗапросПоСтранам = Новый Запрос;
	ЗапросПоСтранам.УстановитьПараметр("Код", "398");
	ЗапросПоСтранам.Текст = "ВЫБРАТЬ
	                        |	КлассификаторСтранМира.Ссылка
	                        |ИЗ
	                        |	Справочник.КлассификаторСтранМира КАК КлассификаторСтранМира
	                        |ГДЕ
	                        |	КлассификаторСтранМира.Код = &Код ИЛИ КлассификаторСтранМира.Ссылка = ЗНАЧЕНИЕ(Справочник.КлассификаторСтранМира.Казахстан)";
							
	Результат = ЗапросПоСтранам.Выполнить();
	
	Страна = Новый Массив;
	
	Если НЕ Результат.Пустой() Тогда
		Результат = Результат.Выбрать();
		Пока Результат.Следующий() Цикл 
			Страна.Добавить(Результат.Ссылка)
		КонецЦикла;	
	КонецЕсли;

	Страна.Добавить(Справочники.КлассификаторСтранМира.ПустаяСсылка());

	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	Поставщики.Контрагент КАК Контрагент,
	               |	Поставщики.Регистратор КАК Регистратор,
	               |	Контрагенты.СерияСвидетельстваПоНДС,
	               |	Контрагенты.НомерСвидетельстваПоНДС,
	               |	Контрагенты.ДатаСвидетельстваПоНДС,
	               |	Поставщики.СуммаБезНДСОборот КАК СуммаБезНДСОборот,
	               |	Поставщики.УплаченныйНДСОборот КАК УплаченныйНДСОборот,
	               |	Поставщики.СуммаНДСОборот КАК СуммаНДСОборот
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		НДСКВозмещениюОбороты.Контрагент КАК Контрагент,
	               |		НДСКВозмещениюОбороты.Регистратор КАК Регистратор,
	               |		НДСКВозмещениюОбороты.УплаченныйНДСОборот КАК УплаченныйНДСОборот,
	               |		НДСКВозмещениюОбороты.СуммаНДСОборот КАК СуммаНДСОборот,
	               |		НДСКВозмещениюОбороты.СуммаБезНДСОборот КАК СуммаБезНДСОборот
	               |	ИЗ
	               |		РегистрНакопления.НДСКВозмещению.Обороты(&ДатаНач, &ДатаКон, Регистратор, Налогоплательщик = &Организация) КАК НДСКВозмещениюОбороты
	               |	ГДЕ
	               |		НЕ НДСКВозмещениюОбороты.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	               |		И НДСКВозмещениюОбороты.СуммаНДСОборот <> 0
	               |		И (НДСКВозмещениюОбороты.Контрагент.ДатаСвидетельстваПоНДС = ДАТАВРЕМЯ(1, 1, 1)
	               |				ИЛИ НДСКВозмещениюОбороты.Контрагент.НомерСвидетельстваПоНДС = """"
	               |				ИЛИ НДСКВозмещениюОбороты.Контрагент.СерияСвидетельстваПоНДС = """")
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		КорректировкаНДСКВозмещениюОбороты.Контрагент,
	               |		КорректировкаНДСКВозмещениюОбороты.Регистратор,
	               |		КорректировкаНДСКВозмещениюОбороты.УплаченныйНДСОборот,
	               |		КорректировкаНДСКВозмещениюОбороты.СуммаНДСОборот,
	               |		КорректировкаНДСКВозмещениюОбороты.СуммаКорректировкиОборотаОборот
	               |	ИЗ
	               |		РегистрНакопления.КорректировкаНДСКВозмещению.Обороты(&ДатаНач, &ДатаКон, Регистратор, Налогоплательщик = &Организация) КАК КорректировкаНДСКВозмещениюОбороты
	               |	ГДЕ
	               |		НЕ КорректировкаНДСКВозмещениюОбороты.Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	               |		И КорректировкаНДСКВозмещениюОбороты.СуммаНДСОборот <> 0
	               |		И (КорректировкаНДСКВозмещениюОбороты.Контрагент.ДатаСвидетельстваПоНДС = ДАТАВРЕМЯ(1, 1, 1)
	               |				ИЛИ КорректировкаНДСКВозмещениюОбороты.Контрагент.НомерСвидетельстваПоНДС = """"
	               |				ИЛИ КорректировкаНДСКВозмещениюОбороты.Контрагент.СерияСвидетельстваПоНДС = """")) КАК Поставщики
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты КАК Контрагенты
	               |		ПО Поставщики.Контрагент = Контрагенты.Ссылка
	               |ГДЕ
	               |	(Контрагенты.КБЕ = &ПустаяСтрока И Контрагенты.СтранаРезидентства В (&Страна))
	               |	ИЛИ (Контрагенты.КБЕ <> &ПустаяСтрока И ПОДСТРОКА(Контрагенты.КБЕ, 1, 1) <> ""2"")
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Контрагент,
	               |	Регистратор";   
				   
	Запрос.УстановитьПараметр("ДатаНач",	  ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон",	  КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация",  ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("Страна",       Страна);	
	Запрос.УстановитьПараметр("ПустаяСтрока", "");	
	
	Результат = Запрос.Выполнить();
	
	Если НЕ Результат.Пустой() Тогда
		ТаблицаОшибок = Результат.Выгрузить();
		
		// обработаем результаты проверки
		Если ТаблицаОшибок.Количество() = 0 Тогда
			СтрокаПравила.ОбнаруженыОшибки      = Ложь;
			СтрокаПравила.ПроверкаВыполнена     = Истина;
		Иначе
			СтрокаПравила.ОбнаруженыОшибки      = Истина;
			СтрокаПравила.ПроверкаВыполнена     = Истина;
			ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаРеквизитовПоставщиковПоНДСТаблицаЗначений", ТаблицаОшибок);
			
			СтруктураЗаголовков = Новый Структура;
			СтруктураЗаголовков.Вставить("Регистратор", 			"Документ");
			СтруктураЗаголовков.Вставить("Контрагент", 				"Поставщик");			
			СтруктураЗаголовков.Вставить("СерияСвидетельстваПоНДС", "Серия");
			СтруктураЗаголовков.Вставить("НомерСвидетельстваПоНДС", "Номер");
			СтруктураЗаголовков.Вставить("ДатаСвидетельстваПоНДС", 	"Дата выдачи");
			
			СтруктураЗаголовков.Вставить("УплаченныйНДСОборот", 	"Уплаченный НДС");	   
			СтруктураЗаголовков.Вставить("СуммаНДСОборот", 			"НДС, принятый к зачету");
			СтруктураЗаголовков.Вставить("СуммаБезНДСОборот", 		"Сумма приобретения без НДС");				
			ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаРеквизитовПоставщиковПоНДССтруктураЗаголовков", СтруктураЗаголовков);
			
			СтруктураРасшифровки = Новый Структура;
			СтруктураРасшифровки.Вставить("Регистратор", 		 		"Регистратор");
			СтруктураРасшифровки.Вставить("Контрагент", 			 	"Контрагент");			
			СтруктураРасшифровки.Вставить("СерияСвидетельстваПоНДС", 	"Контрагент");
			СтруктураРасшифровки.Вставить("НомерСвидетельстваПоНДС", 	"Контрагент");
			СтруктураРасшифровки.Вставить("ДатаСвидетельстваПоНДС", 	"Контрагент");
			
			СтруктураРасшифровки.Вставить("УплаченныйНДСОборот", 		"Регистратор");
			СтруктураРасшифровки.Вставить("СуммаБезНДСОборот", 	 		"Регистратор");
			СтруктураРасшифровки.Вставить("СуммаНДСОборот", 	 		"Регистратор");				
			
			ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаРеквизитовПоставщиковПоНДССтруктураРасшифровки", СтруктураРасшифровки);
			
			СтруктураШириныКолонок = Новый Структура;
			СтруктураШириныКолонок.Вставить("Регистратор", 35);
			СтруктураШириныКолонок.Вставить("Контрагент",  30);
			
			СтруктураШириныКолонок.Вставить("СерияСвидетельстваПоНДС", 15);
			СтруктураШириныКолонок.Вставить("НомерСвидетельстваПоНДС", 15);
			СтруктураШириныКолонок.Вставить("ДатаСвидетельстваПоНДС",  15);
			
			СтруктураШириныКолонок.Вставить("УплаченныйНДСОборот", 	25);
			СтруктураШириныКолонок.Вставить("СуммаБезНДСОборот", 	27);
			СтруктураШириныКолонок.Вставить("СуммаНДСОборот", 	 	25);							
			
			ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаРеквизитовПоставщиковПоНДССтруктураШириныКолонок", СтруктураШириныКолонок);
			
			СтруктураФорматаПолей = Новый Структура;			
			СтруктураФорматаПолей.Вставить("ДатаСвидетельстваПоНДС", "ДФ = дд.ММ.гггг");
			ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаРеквизитовПоставщиковПоНДССтруктураФорматаПолей", СтруктураФорматаПолей);
		
		КонецЕсли;
		
	Иначе
		
		СтрокаПравила.ОбнаруженыОшибки      = Ложь;
		СтрокаПравила.ПроверкаВыполнена     = Истина;
		СтрокаПравила.КомментарийРезультата = "Нарушений не обнаружено.";
		
	КонецЕсли;

КонецПроцедуры

Процедура ПроверитьПравилоМинусыПоТоварамОрганизацийБУ(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ТоварыОрганизацийБУОстаткиИОбороты.Товар КАК Номенклатура,
	|	ТоварыОрганизацийБУОстаткиИОбороты.Склад КАК Склад,
	|	ТоварыОрганизацийБУОстаткиИОбороты.НомерГТД КАК ИсточникПроисхождения,
	|	ТоварыОрганизацийБУОстаткиИОбороты.Регистратор КАК ДокументВыбытия,
	|	ТоварыОрганизацийБУОстаткиИОбороты.КоличествоНачальныйОстаток КАК НачОстаток,
	|	-ТоварыОрганизацийБУОстаткиИОбороты.КоличествоОборот КАК Расход,
	|	ТоварыОрганизацийБУОстаткиИОбороты.КоличествоКонечныйОстаток КАК КонОстаток
	|ИЗ
	|	РегистрНакопления.ТоварыОрганизацийБУ.ОстаткиИОбороты(
	|			&ДатаНач,
	|			&ДатаКон,
	|			Регистратор,
	|			Движения,
	|			Организация = &Организация
	|				И СтруктурноеПодразделение = &СтруктурноеПодразделение) КАК ТоварыОрганизацийБУОстаткиИОбороты
	|ГДЕ
	|	ТоварыОрганизацийБУОстаткиИОбороты.КоличествоКонечныйОстаток < 0
	|	И ТоварыОрганизацийБУОстаткиИОбороты.КоличествоОборот < 0
	|
	|УПОРЯДОЧИТЬ ПО
	|	Номенклатура,
	|	ТоварыОрганизацийБУОстаткиИОбороты.Период";
	
	Запрос.УстановитьПараметр("ДатаНач", 				  ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", 				  КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация", 			  ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
	
	Результат = Запрос.Выполнить();
	
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("МинусыПоТоварамОрганизацийБУРезультатЗапроса", Результат);
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("ДокументВыбытия", "ДокументВыбытия");
		СтруктураРасшифровки.Вставить("Номенклатура", "Номенклатура");
		СтруктураРасшифровки.Вставить("ИсточникПроисхождения", "ИсточникПроисхождения");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("МинусыПоТоварамОрганизацийБУСтруктураРасшифровки", СтруктураРасшифровки);	
		
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("ДокументВыбытия", 		 60);
		СтруктураШириныКолонок.Вставить("Номенклатура", 	     60);
		СтруктураШириныКолонок.Вставить("ИсточникПроисхождения", 60);
				
		ПараметрыОтчета.ИсходящиеДанные.Вставить("МинусыПоТоварамОрганизацийБУСтруктураШириныКолонок", СтруктураШириныКолонок);	

	КонецЕсли; 
	  
КонецПроцедуры

Процедура ПроверитьПравилоПроверкаВыпискиЭСФИИП(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ВЫРАЗИТЬ(ЭСФТовары.КодТНВЭД КАК СТРОКА(10)) КАК КодТНВЭД,
	               |	ЭСФТовары.НомерПозицииВДекларацииИлиЗаявлении КАК НомерСтрокиГТД,
	               |	ЭСФТовары.ТоварНаименованиеВРамкахТС КАК ТоварНаименованиеВРамкахТС,
	               |	ЭСФТовары.НомерЗаявленияВРамкахТС КАК НомерЗаявленияВРамкахТС,
	               |	ЭСФ.Ссылка КАК СсылкаЭСФ,
	               |	ЭСФ.Дата КАК ЭСФДата,
	               |	ЭСФТовары.НомерГТД КАК НомерГТД,
	               |	ЕСТЬNULL(НомераГТД.ГСВС, ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяССылка)) КАК ГСВС,
	               |	ЛОЖЬ КАК ТоварВКлюченВПеречень,
	               |	ЭСФТовары.Товар КАК Товар
	               |ПОМЕСТИТЬ ВТ_ЭСФБезПеречня
	               |ИЗ
	               |	Документ.ЭСФ КАК ЭСФ
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЭСФ.Товары КАК ЭСФТовары
	               |		ПО (ЭСФТовары.Ссылка = ЭСФ.Ссылка)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.НомераГТД КАК НомераГТД
	               |		ПО (ЭСФТовары.НомерГТД = НомераГТД.Ссылка)
	               |ГДЕ
	               |	ЭСФ.Направление = ЗНАЧЕНИЕ(Перечисление.НаправленияЭСФ.Исходящий)
	               |	И ЭСФ.Дата >= &ДатаНач
	               |	И ЭСФ.Дата <= &ДатаКон
	               |	И ЭСФ.Организация = &Организация
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	МАКСИМУМ(СведенияОНоменклатуреГСВС.Период) КАК Период,
	               |	ВТ_ЭСФ.Товар КАК Товар,
	               |	ВТ_ЭСФ.ГСВС КАК ГСВС,
	               |	ВТ_ЭСФ.СсылкаЭСФ КАК СсылкаЭСФ
	               |ПОМЕСТИТЬ ВТ_ПереченьИзъятийПериоды
	               |ИЗ
	               |	ВТ_ЭСФБезПеречня КАК ВТ_ЭСФ
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СправочникНоменклатура
	               |		ПО ВТ_ЭСФ.Товар = СправочникНоменклатура.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.НоменклатураГСВС КАК СправочникНоменклатураГСВС
	               |		ПО (ВЫБОР
	               |				КОГДА ВТ_ЭСФ.ГСВС <> ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяССылка)
	               |					ТОГДА ВТ_ЭСФ.ГСВС = СправочникНоменклатураГСВС.Ссылка
	               |				ИНАЧЕ СправочникНоменклатура.КодТНВЭД = ВТ_ЭСФ.ГСВС.КодГСВС
	               |			КОНЕЦ)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОНоменклатуреГСВС КАК СведенияОНоменклатуреГСВС
	               |		ПО (СправочникНоменклатураГСВС.Ссылка = СведенияОНоменклатуреГСВС.НоменклатураГСВС)
	               |			И (СведенияОНоменклатуреГСВС.ПризнакАктивности = ИСТИНА)
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ВТ_ЭСФ.СсылкаЭСФ,
	               |	ВТ_ЭСФ.Товар,
	               |	ВТ_ЭСФ.ГСВС
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	ПереченьИзъятий.Товар КАК Товар,
	               |	ПереченьИзъятий.СсылкаЭСФ КАК СсылкаЭСФ,
	               |	ВЫБОР
	               |		КОГДА СведенияОНоменклатуреГСВС.ПризнакПеречняИзьятий ЕСТЬ NULL
	               |			ТОГДА ЛОЖЬ
	               |		ИНАЧЕ СведенияОНоменклатуреГСВС.ПризнакПеречняИзьятий
	               |	КОНЕЦ КАК ВходитВПеречень
	               |ПОМЕСТИТЬ ВТ_ПереченьИзъятий
	               |ИЗ
	               |	ВТ_ПереченьИзъятийПериоды КАК ПереченьИзъятий
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СправочникНоменклатура
	               |		ПО ПереченьИзъятий.Товар = СправочникНоменклатура.Ссылка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.НоменклатураГСВС КАК СправочникНоменклатураГСВС
	               |		ПО (ВЫБОР
	               |				КОГДА ПереченьИзъятий.ГСВС <> ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяССылка)
	               |					ТОГДА ПереченьИзъятий.ГСВС = СправочникНоменклатураГСВС.Ссылка
	               |				ИНАЧЕ СправочникНоменклатура.КодТНВЭД = ПереченьИзъятий.ГСВС.КодГСВС
	               |			КОНЕЦ)
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СведенияОНоменклатуреГСВС КАК СведенияОНоменклатуреГСВС
	               |		ПО (СправочникНоменклатураГСВС.Ссылка = СведенияОНоменклатуреГСВС.НоменклатураГСВС)
	               |			И ПереченьИзъятий.Период = СведенияОНоменклатуреГСВС.Период
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ВТ_ЭСФ.КодТНВЭД КАК КодТНВЭД,
	               |	ВТ_ЭСФ.НомерСтрокиГТД КАК НомерСтрокиГТД,
	               |	ВТ_ЭСФ.ТоварНаименованиеВРамкахТС КАК ТоварНаименованиеВРамкахТС,
	               |	ВТ_ЭСФ.НомерЗаявленияВРамкахТС КАК НомерЗаявленияВРамкахТС,
	               |	ВТ_ЭСФ.СсылкаЭСФ КАК СсылкаЭСФ,
	               |	ВТ_ЭСФ.НомерГТД КАК НомерГТД,
	               |	ВТ_ЭСФ.Товар КАК Товар,
	               |	ВТ_ПереченьИзъятий.ВходитВПеречень КАК ТоварВКлюченВПеречень
	               |ПОМЕСТИТЬ ВТ_ЭСФ
	               |ИЗ
	               |	ВТ_ЭСФБезПеречня КАК ВТ_ЭСФ
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ПереченьИзъятий КАК ВТ_ПереченьИзъятий
	               |		ПО ВТ_ЭСФ.Товар = ВТ_ПереченьИзъятий.Товар
	               |			И ВТ_ЭСФ.СсылкаЭСФ = ВТ_ПереченьИзъятий.СсылкаЭСФ
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ВЫРАЗИТЬ(НомераГТД.КодТНВЭД КАК СТРОКА(10)) КАК КодТНВЭД,
	               |	НомераГТД.СпособПроисхожденияТовара КАК СпособПроисхожденияТовара,
	               |	НомераГТД.НомерСтрокиГТД КАК НомерСтрокиГТД,
	               |	НомераГТД.НаименованиеТовара КАК НаименованиеТовара,
	               |	НомераГТД.Код КАК НомерЗаявленияВРамкахТС,
	               |	НомераГТД.Ссылка КАК НомерГТД
	               |ПОМЕСТИТЬ ВТ_ИсточникиПроисхождения
	               |ИЗ
	               |	Справочник.НомераГТД КАК НомераГТД
	               |ГДЕ
	               |	НомераГТД.Ссылка В
	               |			(ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |				ЭСФ.НомерГТД
	               |			ИЗ
	               |				ВТ_ЭСФ КАК ЭСФ)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ВТ_ЭСФ.СсылкаЭСФ КАК ЭСФ,
	               |	ВТ_ЭСФ.НомерГТД КАК ИсточникПроисхождения,
	               |	ВТ_ЭСФ.Товар КАК Товар,
	               |	ВЫБОР
	               |		КОГДА ВТ_ЭСФ.КодТНВЭД = ВТ_ИсточникиПроисхождения.КодТНВЭД
	               |			ТОГДА ИСТИНА
	               |		ИНАЧЕ ЛОЖЬ
	               |	КОНЕЦ КАК СоответствуетКодТНВЭД,
	               |	ВЫБОР
	               |		КОГДА ВТ_ЭСФ.НомерСтрокиГТД = ВТ_ИсточникиПроисхождения.НомерСтрокиГТД
	               |			ТОГДА ИСТИНА
	               |		ИНАЧЕ ЛОЖЬ
	               |	КОНЕЦ КАК СоответствуетНомерСтрокиГТД,
	               |	ВЫБОР
	               |		КОГДА ВТ_ЭСФ.ТоварНаименованиеВРамкахТС <> ВТ_ИсточникиПроисхождения.НаименованиеТовара
	               |				И ВТ_ИсточникиПроисхождения.СпособПроисхожденияТовара <> &СпособПроисхожденияСТ1
	               |			ТОГДА ЛОЖЬ
	               |		ИНАЧЕ ИСТИНА
	               |	КОНЕЦ КАК СоответствуетНаименованиеТовара,
	               |	ВЫБОР
	               |		КОГДА ВТ_ЭСФ.НомерЗаявленияВРамкахТС = ВТ_ИсточникиПроисхождения.НомерЗаявленияВРамкахТС
	               |			ТОГДА ИСТИНА
	               |		ИНАЧЕ ЛОЖЬ
	               |	КОНЕЦ КАК СоответствуетНомерЗаявленияВРамкахТС
	               |ИЗ
	               |	ВТ_ЭСФ КАК ВТ_ЭСФ
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ИсточникиПроисхождения КАК ВТ_ИсточникиПроисхождения
	               |		ПО ВТ_ЭСФ.НомерГТД = ВТ_ИсточникиПроисхождения.НомерГТД
	               |ГДЕ
	               |	(ВТ_ЭСФ.КодТНВЭД <> ВТ_ИсточникиПроисхождения.КодТНВЭД
	               |			ИЛИ ВТ_ЭСФ.НомерСтрокиГТД <> ВТ_ИсточникиПроисхождения.НомерСтрокиГТД
	               |			ИЛИ ВТ_ЭСФ.ТоварНаименованиеВРамкахТС <> ВТ_ИсточникиПроисхождения.НаименованиеТовара
	               |				И ВТ_ИсточникиПроисхождения.СпособПроисхожденияТовара <> &СпособПроисхожденияСТ1
	               |			ИЛИ ВТ_ЭСФ.НомерЗаявленияВРамкахТС <> ВТ_ИсточникиПроисхождения.НомерЗаявленияВРамкахТС)
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	ВТ_ЭСФ.СсылкаЭСФ.Дата";
	
	Запрос.УстановитьПараметр("ДатаНач", 				  ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", 				  КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация", 			  ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СпособПроисхожденияСТ1",   Перечисления.СпособыПроисхожденияТоваров.СТ1);
	
	Результат = Запрос.Выполнить();
	//
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаВыпискиЭСФИИПРезультатЗапроса", Результат);
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("ЭСФ", "ЭСФ");
		СтруктураРасшифровки.Вставить("ИсточникПроисхождения", "ИсточникПроисхождения");
		СтруктураРасшифровки.Вставить("Товар", "Товар");		

		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаВыпискиЭСФИИПСтруктураРасшифровки", СтруктураРасшифровки);	
		
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("ИсточникПроисхождения" ,                   "Источник происхождения");
		СтруктураЗаголовков.Вставить("СоответствуетКодТНВЭД"  ,                  "Соответ. КодТНВЭД");
		СтруктураЗаголовков.Вставить("СоответствуетНомерСтрокиГТД"  ,            "Соответ. Номер строки ГТД");
		СтруктураЗаголовков.Вставить("СоответствуетНаименованиеТовара"  , 	     "Соответ. Наименование товара");
		СтруктураЗаголовков.Вставить("СоответствуетНомерЗаявленияВРамкахТС" ,    "Соответ. Номер заявления в рамках ТС");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаВыпискиЭСФИИПСтруктураЗаголовков", СтруктураЗаголовков);
		
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("ЭСФ", 		                            60);
		СтруктураШириныКолонок.Вставить("ИсточникПроисхождения",                60);
		СтруктураШириныКолонок.Вставить("Товар",                                60);
		СтруктураШириныКолонок.Вставить("СоответствуетКодТНВЭД",                40);
		СтруктураШириныКолонок.Вставить("СоответствуетНомерСтрокиГТД",          40);		
		СтруктураШириныКолонок.Вставить("СоответствуетНаименованиеТовара"  ,    40);
		СтруктураШириныКолонок.Вставить("СоответствуетНомерЗаявленияВРамкахТС" ,40);
				
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаВыпискиЭСФИИПСтруктураШириныКолонок", СтруктураШириныКолонок);	

	КонецЕсли; 
	 
КонецПроцедуры

Процедура ПроверитьПравилоПроверкаОтложенногоНДС(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТиповойОбороты.Счет,
		|	ТиповойОбороты.КорСчет,
		|	ТиповойОбороты.Субконто1 КАК Контрагент,
		|	ТиповойОбороты.Субконто2 КАК ДокументПоступления,
		|	ТиповойОбороты.СуммаОборотДт,
		|	ТиповойОбороты.СуммаОборотКт,
		|	ТиповойОбороты.Регистратор,
		|	ВЫБОР
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет
		|			ТОГДА ""ЭтоДокументПоступления""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ВозвратТоваровПоставщику
		|			ТОГДА ""ЭтоВозвратПоставщику""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов
		|			ТОГДА ""ЭтоДокументПоступления""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеИзПереработки
		|			ТОГДА ""ЭтоДокументПоступления""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеНМА
		|			ТОГДА ""ЭтоДокументПоступления""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		|			ТОГДА ""ЭтоДокументПоступления""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.РегистрацияПрочихОперацийПоПриобретеннымТоварамВЦеляхНДС
		|			ТОГДА ""ЭтоРегистрацияПрочихОпераций""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ОперацияБух
		|			ТОГДА ""ЭтоОперацияБух""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ВводНачальныхОстатков
		|			ТОГДА ""ЭтоВводОстатков""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ГТДИмпорт
		|			ТОГДА ""ЭтоГТД""
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ЗаявлениеОВвозеТоваровИУплатеКосвенныхНалогов
		|			ТОГДА ""ЭтоЗаявлениеОВвозе""
		|		ИНАЧЕ ""ЭтоИнойДокумент""
		|	КОНЕЦ КАК ВидДокументаРегистратора,
		|	ВЫБОР
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.АвансовыйОтчет).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ВозвратТоваровПоставщику
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ВозвратТоваровПоставщику).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ПоступлениеДопРасходов).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеИзПереработки
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ПоступлениеИзПереработки).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеНМА
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ПоступлениеНМА).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ПоступлениеТоваровУслуг).ОтложитьПринятиеНДСКЗачету
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВЫБОР
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.РегистрацияПрочихОперацийПоПриобретеннымТоварамВЦеляхНДС
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.РегистрацияПрочихОперацийПоПриобретеннымТоварамВЦеляхНДС).СчетУчетаРасчетовСКонтрагентом
		|		ИНАЧЕ &ПустойСчет
		|	КОНЕЦ КАК СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВЫБОР
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.РегистрацияПрочихОперацийПоПриобретеннымТоварамВЦеляхНДС
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.РегистрацияПрочихОперацийПоПриобретеннымТоварамВЦеляхНДС).ВидОперации
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ КАК ВидОперацииРегистрацияПоступления
		|ПОМЕСТИТЬ ВТ_ТиповойОбороты
		|ИЗ
		|	РегистрБухгалтерии.Типовой.Обороты(&ДатаНач, &ДатаКон, Авто, Счет = &Счет1422, &ВидыСубконто, Организация = &Организация, , ) КАК ТиповойОбороты
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВТ_ТиповойОбороты.Счет,
		|	ВТ_ТиповойОбороты.КорСчет,
		|	ВТ_ТиповойОбороты.Регистратор КАК Документ,
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора,
		|	ВТ_ТиповойОбороты.Контрагент,
		|	ВТ_ТиповойОбороты.ДокументПоступления,
		|	ВТ_ТиповойОбороты.СуммаОборотДт,
		|	ВТ_ТиповойОбороты.СуммаОборотКт,
		|	""В проводках по счету <1422> не заполнена аналитика"" КАК Ошибка,
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|ГДЕ
		|	(ВТ_ТиповойОбороты.Контрагент = НЕОПРЕДЕЛЕНО
		|			ИЛИ ВТ_ТиповойОбороты.Контрагент = &ПустойКонтрагент
		|			ИЛИ ВТ_ТиповойОбороты.ДокументПоступления = НЕОПРЕДЕЛЕНО)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Счет,
		|	ВТ_ТиповойОбороты.КорСчет,
		|	ВТ_ТиповойОбороты.Регистратор,
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора,
		|	ВТ_ТиповойОбороты.Контрагент,
		|	ВТ_ТиповойОбороты.ДокументПоступления,
		|	ВТ_ТиповойОбороты.СуммаОборотДт,
		|	ВТ_ТиповойОбороты.СуммаОборотКт,
		|	""Некорректный вид документа"",
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|ГДЕ
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора = ""ЭтоИнойДокумент""
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Счет,
		|	ВТ_ТиповойОбороты.КорСчет,
		|	ВТ_ТиповойОбороты.Регистратор,
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора,
		|	ВТ_ТиповойОбороты.Контрагент,
		|	ВТ_ТиповойОбороты.ДокументПоступления,
		|	ВТ_ТиповойОбороты.СуммаОборотДт,
		|	ВТ_ТиповойОбороты.СуммаОборотКт,
		|	""В качестве счета учета расчетов с контрагентами не выбран счет <1422>"",
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|ГДЕ
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора = ""ЭтоРегистрацияПрочихОпераций""
		|	И ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления <> &Счет1422
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Счет,
		|	ВТ_ТиповойОбороты.КорСчет,
		|	ВТ_ТиповойОбороты.Регистратор,
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора,
		|	ВТ_ТиповойОбороты.Контрагент,
		|	ВТ_ТиповойОбороты.ДокументПоступления,
		|	ВТ_ТиповойОбороты.СуммаОборотДт,
		|	ВТ_ТиповойОбороты.СуммаОборотКт,
		|	""У """"Документа поступления"""" не установлен признак """"Отложить принятие НДС к зачету"""""",
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|ГДЕ
		|	ВТ_ТиповойОбороты.СуммаОборотДт <> 0
		|	И ВТ_ТиповойОбороты.ВидДокументаРегистратора = ""ЭтоДокументПоступления""
		|	И НЕ ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Счет,
		|	ВТ_ТиповойОбороты.КорСчет,
		|	ВТ_ТиповойОбороты.Регистратор,
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора,
		|	ВТ_ТиповойОбороты.Контрагент,
		|	ВТ_ТиповойОбороты.ДокументПоступления,
		|	ВТ_ТиповойОбороты.СуммаОборотДт,
		|	ВТ_ТиповойОбороты.СуммаОборотКт,
		|	""Не корректно указан счет учета НДС"",
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|ГДЕ
		|	ВТ_ТиповойОбороты.СуммаОборотДт <> 0
		|	И ВТ_ТиповойОбороты.ВидДокументаРегистратора = ""ЭтоРегистрацияПрочихОпераций""
		|	И ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления = &ВидОперацииРегистрацияОборота
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Счет,
		|	ВТ_ТиповойОбороты.КорСчет,
		|	ВТ_ТиповойОбороты.Регистратор,
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора,
		|	ВТ_ТиповойОбороты.Контрагент,
		|	ВТ_ТиповойОбороты.ДокументПоступления,
		|	ВТ_ТиповойОбороты.СуммаОборотДт,
		|	ВТ_ТиповойОбороты.СуммаОборотКт,
		|	""Некорректный вид документа для оборота по Дт"",
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|ГДЕ
		|	ВТ_ТиповойОбороты.СуммаОборотДт <> 0
		|	И ВТ_ТиповойОбороты.ВидДокументаРегистратора = ""ЭтоВозвратПоставщику""
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Счет,
		|	ВТ_ТиповойОбороты.КорСчет,
		|	ВТ_ТиповойОбороты.Регистратор,
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора,
		|	ВТ_ТиповойОбороты.Контрагент,
		|	ВТ_ТиповойОбороты.ДокументПоступления,
		|	ВТ_ТиповойОбороты.СуммаОборотДт,
		|	ВТ_ТиповойОбороты.СуммаОборотКт,
		|	""У """"Документа поступления"""" не установлен признак """"Отложить принятие НДС к зачету"""""",
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|ГДЕ
		|	ВТ_ТиповойОбороты.СуммаОборотКт <> 0
		|	И ВТ_ТиповойОбороты.ВидДокументаРегистратора = ""ЭтоВозвратПоставщику""
		|	И НЕ ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Счет,
		|	ВТ_ТиповойОбороты.КорСчет,
		|	ВТ_ТиповойОбороты.Регистратор,
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора,
		|	ВТ_ТиповойОбороты.Контрагент,
		|	ВТ_ТиповойОбороты.ДокументПоступления,
		|	ВТ_ТиповойОбороты.СуммаОборотДт,
		|	ВТ_ТиповойОбороты.СуммаОборотКт,
		|	""Не корректно указан счет учета НДС"",
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|ГДЕ
		|	ВТ_ТиповойОбороты.СуммаОборотКт <> 0
		|	И ВТ_ТиповойОбороты.ВидДокументаРегистратора = ""ЭтоРегистрацияПрочихОпераций""
		|	И ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления <> &ВидОперацииРегистрацияОборота
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Счет,
		|	ВТ_ТиповойОбороты.КорСчет,
		|	ВТ_ТиповойОбороты.Регистратор,
		|	ВТ_ТиповойОбороты.ВидДокументаРегистратора,
		|	ВТ_ТиповойОбороты.Контрагент,
		|	ВТ_ТиповойОбороты.ДокументПоступления,
		|	ВТ_ТиповойОбороты.СуммаОборотДт,
		|	ВТ_ТиповойОбороты.СуммаОборотКт,
		|	""Некорректный вид документа для оборота по Кт"",
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления,
		|	ВТ_ТиповойОбороты.ВидОперацииРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|ГДЕ
		|	ВТ_ТиповойОбороты.СуммаОборотКт <> 0
		|	И ВТ_ТиповойОбороты.ВидДокументаРегистратора = ""ЭтоДокументПоступления""
		|
		|УПОРЯДОЧИТЬ ПО
		|	Документ
		|АВТОУПОРЯДОЧИВАНИЕ";
	
	Запрос.УстановитьПараметр("ДатаНач"     , ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон"     , КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация" , ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("Счет1422"    , ПланыСчетов.Типовой.НДСНачисленныйПриПокупке);
	Запрос.УстановитьПараметр("ПустойСчет"  , ПланыСчетов.Типовой.ПустаяСсылка());
	Запрос.УстановитьПараметр("ПустойКонтрагент"             , Справочники.Контрагенты.ПустаяСсылка());
	Запрос.УстановитьПараметр("ВидОперацииРегистрацияОборота", Перечисления.ВидыОперацийВЦеляхНДС.РегистрацияОборотаПоРеализации);
	
	ВидыСубконто = Новый Массив;
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.Контрагенты);
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.ДокументыПоступления);
	Запрос.УстановитьПараметр("ВидыСубконто", ВидыСубконто);
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	ТаблицаОшибок = РезультатЗапроса[1].Выгрузить();
	
	ТаблицаОшибок.Колонки.Удалить("ВидДокументаРегистратора");
	ТаблицаОшибок.Колонки.Удалить("ОтложитьПринятиеНДСКЗачетуРегистратор");
	ТаблицаОшибок.Колонки.Удалить("ВидОперацииРегистрацияПоступления");
	ТаблицаОшибок.Колонки.Удалить("СчетРасчетовСКонтрагентомРегистрацияПоступления");
	
	Если ТаблицаОшибок.Количество() > 0 Тогда
		
		СтрокаПравила.ОбнаруженыОшибки  = Истина;
		СтрокаПравила.ПроверкаВыполнена = Истина;		
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаОтложенногоНДСТаблицаЗначений", ТаблицаОшибок);
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("Документ"            , "Документ");
		СтруктураЗаголовков.Вставить("Счет"                , "Счет");
		СтруктураЗаголовков.Вставить("КорСчет"             , "Кор. счет");
		СтруктураЗаголовков.Вставить("Контрагент"          , "Контрагент");
		СтруктураЗаголовков.Вставить("ДокументПоступления" , "Документ поступления");
		СтруктураЗаголовков.Вставить("СуммаОборотДт"       , "Оборот Дт");
		СтруктураЗаголовков.Вставить("СуммаОборотКт"       , "Оборот Кт");
		СтруктураЗаголовков.Вставить("Ошибка"              , "Описание ошибки");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаОтложенногоНДССтруктураЗаголовков", СтруктураЗаголовков);
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Документ", "Документ");			
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаОтложенногоНДССтруктураРасшифровки", СтруктураРасшифровки);
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("Документ"            , 60);
		СтруктураШириныКолонок.Вставить("Счет"                , 30);
		СтруктураШириныКолонок.Вставить("КорСчет"             , 30);
		СтруктураШириныКолонок.Вставить("Контрагент"          , 60);
		СтруктураШириныКолонок.Вставить("ДокументПоступления" , 60);
		СтруктураШириныКолонок.Вставить("СуммаОборотДт"       , 40);
		СтруктураШириныКолонок.Вставить("СуммаОборотКт"       , 40);
		СтруктураШириныКолонок.Вставить("Ошибка"              , 80);
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаОтложенногоНДССтруктураШириныКолонок", СтруктураШириныКолонок);
		
	Иначе
		
		СтрокаПравила.ОбнаруженыОшибки  = Ложь;
		СтрокаПравила.ПроверкаВыполнена = Истина;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ПроверитьПравилоПроверкаСчетовФактурОтложенногоНДС(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТиповойОбороты.Счет,
		|	ТиповойОбороты.СуммаОборот,
		|	ТиповойОбороты.Регистратор,
		|	ВЫБОР
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.АвансовыйОтчет
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.АвансовыйОтчет).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ВозвратТоваровПоставщику
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ВозвратТоваровПоставщику).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеДопРасходов
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ПоступлениеДопРасходов).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеИзПереработки
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ПоступлениеИзПереработки).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеНМА
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ПоступлениеНМА).ОтложитьПринятиеНДСКЗачету
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.ПоступлениеТоваровУслуг).ОтложитьПринятиеНДСКЗачету
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВЫБОР
		|		КОГДА ТиповойОбороты.Регистратор ССЫЛКА Документ.РегистрацияПрочихОперацийПоПриобретеннымТоварамВЦеляхНДС
		|			ТОГДА ВЫРАЗИТЬ(ТиповойОбороты.Регистратор КАК Документ.РегистрацияПрочихОперацийПоПриобретеннымТоварамВЦеляхНДС).СчетУчетаРасчетовСКонтрагентом
		|		ИНАЧЕ &ПустойСчет
		|	КОНЕЦ КАК СчетРасчетовСКонтрагентомРегистрацияПоступления
		|ПОМЕСТИТЬ ВТ_ТиповойОбороты
		|ИЗ
		|	РегистрБухгалтерии.Типовой.Обороты(&ДатаНач, &ДатаКон, Авто, Счет = &Счет1422, &ВидыСубконто, Организация = &Организация, , ) КАК ТиповойОбороты
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	СчетФактураПолученныйДокументыОснования.ДокументОснование КАК ДокументОснование
		|ПОМЕСТИТЬ ВТ_СчетаФактуры
		|ИЗ
		|	Документ.СчетФактураПолученный.ДокументыОснования КАК СчетФактураПолученныйДокументыОснования
		|ГДЕ
		|	СчетФактураПолученныйДокументыОснования.ДокументОснование В
		|			(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|				ВТ_ТиповойОбороты.Регистратор
		|			ИЗ
		|				ВТ_ТиповойОбороты)
		|	И НЕ СчетФактураПолученныйДокументыОснования.Ссылка.ПометкаУдаления
		|	И СчетФактураПолученныйДокументыОснования.Ссылка.Проведен
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Регистратор КАК Документ,
		|	ВТ_СчетаФактуры.ДокументОснование КАК ДокументОснованиеДляСФ,
		|	""Для документа с признаком """"Отложить принятие НДС к зачету"""" зарегистрирован Счет-фактура"" КАК Ошибка,
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СчетаФактуры КАК ВТ_СчетаФактуры
		|		ПО ВТ_ТиповойОбороты.Регистратор = ВТ_СчетаФактуры.ДокументОснование
		|			И (НЕ ВТ_ТиповойОбороты.Регистратор ССЫЛКА Документ.РегистрацияПрочихОперацийПоПриобретеннымТоварамВЦеляхНДС)
		|			И (ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_ТиповойОбороты.Регистратор,
		|	ВТ_СчетаФактуры.ДокументОснование,
		|	""Для документа регистрации отложенного НДС НЕ зарегистрирован Счет-фактура"",
		|	ВТ_ТиповойОбороты.ОтложитьПринятиеНДСКЗачетуРегистратор,
		|	ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления
		|ИЗ
		|	ВТ_ТиповойОбороты КАК ВТ_ТиповойОбороты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактуры КАК ВТ_СчетаФактуры
		|		ПО ВТ_ТиповойОбороты.Регистратор = ВТ_СчетаФактуры.ДокументОснование
		|ГДЕ
		|	ВТ_СчетаФактуры.ДокументОснование ЕСТЬ NULL 
		|	И ВТ_ТиповойОбороты.Регистратор ССЫЛКА Документ.РегистрацияПрочихОперацийПоПриобретеннымТоварамВЦеляхНДС
		|	И ВТ_ТиповойОбороты.СчетРасчетовСКонтрагентомРегистрацияПоступления = &Счет1422
		|
		|УПОРЯДОЧИТЬ ПО
		|	Документ
		|АВТОУПОРЯДОЧИВАНИЕ";
	
	Запрос.УстановитьПараметр("ДатаНач"     , ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон"     , КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация" , ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("Счет1422"    , ПланыСчетов.Типовой.НДСНачисленныйПриПокупке);
	Запрос.УстановитьПараметр("ПустойСчет"  , ПланыСчетов.Типовой.ПустаяСсылка());
	
	ВидыСубконто = Новый Массив;
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.Контрагенты);
	ВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.ДокументыПоступления);
	Запрос.УстановитьПараметр("ВидыСубконто", ВидыСубконто);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ТаблицаОшибок = РезультатЗапроса.Выгрузить();
	
	ТаблицаОшибок.Колонки.Удалить("ДокументОснованиеДляСФ");
	ТаблицаОшибок.Колонки.Удалить("ОтложитьПринятиеНДСКЗачетуРегистратор");
	ТаблицаОшибок.Колонки.Удалить("СчетРасчетовСКонтрагентомРегистрацияПоступления");
	
	Если ТаблицаОшибок.Количество() > 0 Тогда
		
		СтрокаПравила.ОбнаруженыОшибки  = Истина;
		СтрокаПравила.ПроверкаВыполнена = Истина;		
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаСчетовФактурОтложенногоНДСТаблицаЗначений", ТаблицаОшибок);
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("Документ"            , "Документ");
		СтруктураЗаголовков.Вставить("Ошибка"              , "Описание ошибки");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаСчетовФактурОтложенногоНДССтруктураЗаголовков", СтруктураЗаголовков);
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Документ", "Документ");			
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаСчетовФактурОтложенногоНДССтруктураРасшифровки", СтруктураРасшифровки);
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("Документ"            , 80);
		СтруктураШириныКолонок.Вставить("Ошибка"              , 80);
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПроверкаСчетовФактурОтложенногоНДССтруктураШириныКолонок", СтруктураШириныКолонок);
		
	Иначе
		
		СтрокаПравила.ОбнаруженыОшибки  = Ложь;
		СтрокаПравила.ПроверкаВыполнена = Истина;
		
	КонецЕсли;
	
КонецПроцедуры

// Регламентные операции
Процедура ПроверитьПравилоОтрицательноеСальдо(СтрокаПравила, ПараметрыОтчета)
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ТиповойОстаткиИОбороты.Счет КАК Счет,
	               |	ТиповойОстаткиИОбороты.Счет.Вид КАК СчетВид,
	               |	ТиповойОстаткиИОбороты.Счет.Наименование КАК СчетНаименование,
	               |	ТиповойОстаткиИОбороты.СуммаНачальныйОстатокДт КАК СуммаНачальныйОстатокДт,
	               |	ТиповойОстаткиИОбороты.СуммаНачальныйОстатокКт КАК СуммаНачальныйОстатокКт,
	               |	ТиповойОстаткиИОбороты.СуммаКонечныйОстатокДт КАК СуммаКонечныйОстатокДт,
	               |	ТиповойОстаткиИОбороты.СуммаКонечныйОстатокКт КАК СуммаКонечныйОстатокКт
	               |ИЗ
	               |	РегистрБухгалтерии.Типовой.ОстаткиИОбороты(
	               |			&ДатаНач,
	               |			&ДатаКон,
	               |			,
	               |			,
	               |			,
	               |			,
	               |			Организация В (&Организация)
	               |				И СтруктурноеПодразделение = &СтруктурноеПодразделение) КАК ТиповойОстаткиИОбороты
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Счет
	               |АВТОУПОРЯДОЧИВАНИЕ";   
				   
	Запрос.УстановитьПараметр("ДатаНач"					, ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон"					, КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация"				, ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
	
	
	Результат = Запрос.Выполнить();
	Если Результат.Пустой() Тогда
		СтрокаПравила.ОбнаруженыОшибки      = Ложь;
		СтрокаПравила.ПроверкаВыполнена     = Истина;
		
		Возврат;
	КонецЕсли;
	
	// Проверим сводные данные по счетам
	Выборка = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	ТаблицаОшибок = Новый ТаблицаЗначений;
	ТаблицаОшибок.Колонки.Добавить("Счет");
	ТаблицаОшибок.Колонки.Добавить("СчетНаименование");	
	ТаблицаОшибок.Колонки.Добавить("ОстатокДт");
	ТаблицаОшибок.Колонки.Добавить("ОстатокКт");	
		
	Пока Выборка.Следующий() Цикл
		Если Выборка.СчетВид = ВидСчета.АктивноПассивный Тогда
			// не определим "правильную" сторону контроля остатков,
			// поэтому пропустим этот класс счетов			
			Продолжить;
		КонецЕсли;
		
		ЕстьОшибка = Ложь;
		Если Выборка.СчетВид = ВидСчета.Активный И Выборка.СуммаКонечныйОстатокДт<0 Тогда
			ЕстьОшибка = Истина;
		КонецЕсли;
		Если Выборка.СчетВид = ВидСчета.Пассивный  И Выборка.СуммаКонечныйОстатокКт<0 Тогда
			ЕстьОшибка = Истина;
		КонецЕсли;		
		// Добавим данные в таблицу ошибок
		Если ЕстьОшибка Тогда
			НоваяСтрока = ТаблицаОшибок.Добавить();
			НоваяСтрока.Счет = Выборка.Счет;
			НоваяСтрока.СчетНаименование = Выборка.СчетНаименование;			
			НоваяСтрока.ОстатокДт =  Выборка.СуммаКонечныйОстатокДт;
			НоваяСтрока.ОстатокКт =  Выборка.СуммаКонечныйОстатокКт;						
		КонецЕсли;
	КонецЦикла;	     		 

	// обработаем результаты проверки
	Если ТаблицаОшибок.Количество() = 0 Тогда
		СтрокаПравила.ОбнаруженыОшибки      = Ложь;
		СтрокаПравила.ПроверкаВыполнена     = Истина;
	Иначе
		СтрокаПравила.ОбнаруженыОшибки      = Истина;
		СтрокаПравила.ПроверкаВыполнена     = Истина;
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ОтрицательноеСальдоТаблицаЗначений", ТаблицаОшибок);
		
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("Счет", "Счет");
		СтруктураЗаголовков.Вставить("СчетНаименование", "Наименование счета");
		СтруктураЗаголовков.Вставить("ОстатокДт", "Остаток Дт");
		СтруктураЗаголовков.Вставить("ОстатокКт", "Остаток Кт");					
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ОтрицательноеСальдоСтруктураЗаголовков", СтруктураЗаголовков);
		
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("Счет", "Счет");
		СтруктураРасшифровки.Вставить("СчетНаименование", "Счет");	
		СтруктураРасшифровки.Вставить("ОстатокДт", "Счет");
		СтруктураРасшифровки.Вставить("ОстатокКт", "Счет");						
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ОтрицательноеСальдоСтруктураРасшифровки", СтруктураРасшифровки);
		
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("Счет", 				20);
		СтруктураШириныКолонок.Вставить("СчетНаименование", 	100);
		СтруктураШириныКолонок.Вставить("ОстатокДт", 		  	50);
		СтруктураШириныКолонок.Вставить("ОстатокКт", 		  	50);
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ОтрицательноеСальдоСтруктураШириныКолонок", СтруктураШириныКолонок);	

	КонецЕсли;
		
КонецПроцедуры

Процедура ПроверитьПравилоРеформацияБаланса(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ЗакрытиеМесяца.Ссылка КАК Документ,
	               |	КОНЕЦПЕРИОДА(ЗакрытиеМесяца.Дата, МЕСЯЦ) КАК Дата
	               |ИЗ
	               |	Документ.ЗакрытиеМесяца КАК ЗакрытиеМесяца
	               |ГДЕ
	               |	ЗакрытиеМесяца.Дата МЕЖДУ &ДатаНач И &ДатаКон
	               |	И ЗакрытиеМесяца.РеформацияБалансаБУ
	               |	И ЗакрытиеМесяца.Проведен
	               |	И НЕ ЗакрытиеМесяца.ПометкаУдаления
	               |	И ЗакрытиеМесяца.Организация = &Организация
	               |	И ЗакрытиеМесяца.СтруктурноеПодразделение = &СтруктурноеПодразделение";   
				   
	Запрос.УстановитьПараметр("ДатаНач"					, ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон"					, КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация"				, ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
		
	Результат = Запрос.Выполнить();
	
	Если НЕ Результат.Пустой() Тогда
		
		// Проверим были ли введены документы задним числом что
		//образовало остатки на доходных или расходных счетах
		ТаблицаОшибок = Новый ТаблицаЗначений;
		ТаблицаОшибок.Колонки.Добавить("Документ");
		ТаблицаОшибок.Колонки.Добавить("Дата");
		ТаблицаОшибок.Колонки.Добавить("ОстатокНаДоходныхСчетах");
		ТаблицаОшибок.Колонки.Добавить("ОстатокНаРасходныхСчетах");
		
		ЗапросОстатки = Новый Запрос;
		ЗапросОстатки.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                      |	ТиповойОстаткиИОбороты.СуммаКонечныйОстаток КАК СуммаКонечныйОстаток,
		                      |	ТиповойОстаткиИОбороты.Период КАК Период,
		                      |	ВЫБОР
		                      |		КОГДА ТиповойОстаткиИОбороты.Счет В ИЕРАРХИИ (&СчетаДоходов)
		                      |			ТОГДА ""6000""
		                      |		ИНАЧЕ ""7000""
		                      |	КОНЕЦ КАК Счет
		                      |ИЗ
		                      |	РегистрБухгалтерии.Типовой.ОстаткиИОбороты(
		                      |			&ДатаНач,
		                      |			&ДатаКон,
		                      |			Месяц,
		                      |			,
		                      |			Счет В ИЕРАРХИИ (&СчетаДоходов)
		                      |				ИЛИ Счет В ИЕРАРХИИ (&СчетаРасходов),
		                      |			,
		                      |			Организация = &Организация
		                      |				И СтруктурноеПодразделение = &СтруктурноеПодразделение) КАК ТиповойОстаткиИОбороты
		                      |ИТОГИ
		                      |	СУММА(СуммаКонечныйОстаток)
		                      |ПО
		                      |	Период ПЕРИОДАМИ(МЕСЯЦ, &ДатаНач, &ДатаКон),
		                      |	Счет";
					   
		ЗапросОстатки.УстановитьПараметр("ДатаНач"				   , ПараметрыОтчета.ДатаНач);
		ЗапросОстатки.УстановитьПараметр("ДатаКон"				   , КонецДня(ПараметрыОтчета.ДатаКон));
		ЗапросОстатки.УстановитьПараметр("Организация"			   , ПараметрыОтчета.Организация);
		ЗапросОстатки.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
		
		СчетаДоходов = Новый СписокЗначений;
		СчетаДоходов.Добавить(ПланыСчетов.Типовой.ДоходОтРеализацииПродукцииИОказанияУслуг_);                 // 6000
		СчетаДоходов.Добавить(ПланыСчетов.Типовой.ДоходыОтФинансирования);                                    // 6100
		СчетаДоходов.Добавить(ПланыСчетов.Типовой.ПрочиеДоходы_);                                             // 6200
		СчетаДоходов.Добавить(ПланыСчетов.Типовой.ДоходыСвязанныеСПрекращаемойДеятельностью_);                // 6300
		СчетаДоходов.Добавить(ПланыСчетов.Типовой.ДоляПрибылиОрганизацийУчитываемыхПоМетодуДолевогоУчастия);  // 6400
		ЗапросОстатки.УстановитьПараметр("СчетаДоходов", СчетаДоходов);
		СчетаРасходов = Новый СписокЗначений;
		СчетаРасходов.Добавить(ПланыСчетов.Типовой.СебестоимостьРеализованнойПродукцииИОказанныхУслуг_);       // 7000
		СчетаРасходов.Добавить(ПланыСчетов.Типовой.РасходыПоРеализацииПродукцииИОказаниюУслуг_);               // 7100
		СчетаРасходов.Добавить(ПланыСчетов.Типовой.АдминистративныеРасходы_);                 				   // 7200
		СчетаРасходов.Добавить(ПланыСчетов.Типовой.РасходыНаФинансирование);                 				   // 7300
		СчетаРасходов.Добавить(ПланыСчетов.Типовой.ПрочиеРасходы_);                 						   // 7400
		СчетаРасходов.Добавить(ПланыСчетов.Типовой.РасходыСвязанныеСПрекращаемойДеятельностью_);               // 7500
		СчетаРасходов.Добавить(ПланыСчетов.Типовой.ДоляВУбыткеОрганизацийУчитываемыхМетодомДолевогоУчастия);   // 7600
		СчетаРасходов.Добавить(ПланыСчетов.Типовой.РасходыПоКорпоративномуПодоходномуНалогу_);                 // 7700
		ЗапросОстатки.УстановитьПараметр("СчетаРасходов", СчетаРасходов);

		РезультатЗапросаОстатки = ЗапросОстатки.Выполнить();
		
		ВыборкаЗапросаОстатки = РезультатЗапросаОстатки.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкамСИерархией);
		
		ВыборкаДокументов = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		
		Пока ВыборкаДокументов.Следующий() Цикл
			
			Документ   = ВыборкаДокументов.Документ;
			ДатаКонМес = ВыборкаДокументов.Дата;
			
			ВыборкаЗапросаОстатки.Сбросить();
			Пока ВыборкаЗапросаОстатки.Следующий() Цикл
				
				Если НачалоМесяца(ДатаКонМес) = ВыборкаЗапросаОстатки.Период Тогда
					
					ВыборкаПериода = ВыборкаЗапросаОстатки.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					ОстатокРасх = 0;
					ОстатокДох = 0;
					Пока ВыборкаПериода.Следующий() Цикл
						Если ВыборкаПериода.Счет = "7000" И НЕ (ВыборкаПериода.СуммаКонечныйОстаток =0 ИЛИ  ВыборкаПериода.СуммаКонечныйОстаток = NULL) Тогда
							//есть остатки на расходных счетах
							ОстатокРасх = ВыборкаПериода.СуммаКонечныйОстаток;
						ИначеЕсли ВыборкаПериода.Счет = "6000" И НЕ (ВыборкаПериода.СуммаКонечныйОстаток =0 ИЛИ  ВыборкаПериода.СуммаКонечныйОстаток = NULL) Тогда
							ОстатокДох = ВыборкаПериода.СуммаКонечныйОстаток;
						КонецЕсли;					
					КонецЦикла;
					Если ОстатокРасх <> 0 ИЛИ ОстатокДох <> 0 Тогда
						НовСтрока = ТаблицаОшибок.Добавить();
						НовСтрока.Документ                 = Документ; 
						НовСтрока.Дата                     = ДатаКонМес; 
						НовСтрока.ОстатокНаДоходныхСчетах  = ОстатокДох; 
						НовСтрока.ОстатокНаРасходныхСчетах = ОстатокРасх; 
					КонецЕсли;
					
					Прервать;
				КонецЕсли;				
				
			КонецЦикла;      			
			
		КонецЦикла;         		 
		
		// обработаем результаты проверки
		Если ТаблицаОшибок.Количество() = 0 Тогда
			СтрокаПравила.ОбнаруженыОшибки      = Ложь;
			СтрокаПравила.ПроверкаВыполнена     = Истина;
		Иначе
			СтрокаПравила.ОбнаруженыОшибки      = Истина;
			СтрокаПравила.ПроверкаВыполнена     = Истина;
			ПараметрыОтчета.ИсходящиеДанные.Вставить("РеформацияБалансаТаблицаЗначений", ТаблицаОшибок);
			СтруктураЗаголовков = Новый Структура;
			СтруктураЗаголовков.Вставить("Документ", "Документ закрытия месяца");
			СтруктураЗаголовков.Вставить("Дата", "Дата конца месяца реформации баланса");
			СтруктураЗаголовков.Вставить("ОстатокНаДоходныхСчетах",  "Остаток на доходных счетах");
			СтруктураЗаголовков.Вставить("ОстатокНаРасходныхСчетах", "Остаток на расходных счетах");			
			ПараметрыОтчета.ИсходящиеДанные.Вставить("РеформацияБалансаСтруктураЗаголовков", СтруктураЗаголовков);
			СтруктураРасшифровки = Новый Структура;
			СтруктураРасшифровки.Вставить("Документ", "Документ");
			ПараметрыОтчета.ИсходящиеДанные.Вставить("РеформацияБалансаСтруктураРасшифровки", СтруктураРасшифровки);
			СтруктураШириныКолонок = Новый Структура;
			СтруктураШириныКолонок.Вставить("Документ",	 				40);
			СтруктураШириныКолонок.Вставить("Дата", 					30);
			ПараметрыОтчета.ИсходящиеДанные.Вставить("РеформацияБалансаСтруктураШириныКолонок", СтруктураШириныКолонок);	
		КонецЕсли;
		
	Иначе
		
		СтрокаПравила.ОбнаруженыОшибки      = Ложь;
		СтрокаПравила.ПроверкаВыполнена     = Истина;
		СтрокаПравила.КомментарийРезультата = "Реформация баланса не была произведена в период проверки.";
		
	КонецЕсли;
	
КонецПроцедуры // ПроверитьПравилоРеформацияБаланса()

Процедура ПроверитьПравилоКорректностьПроводки(СтрокаПравила, ПараметрыОтчета)
	
    Запрос = Новый Запрос;
    Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
                   |	ТиповойОбороты.Регистратор,
                   |	ТиповойОбороты.СчетДт,
                   |	ТиповойОбороты.СчетКт,
                   |	ТиповойОбороты.СуммаОборот КАК Сумма,
                   |	ВЫБОР
                   |		КОГДА ТиповойОбороты.СчетДт.ЗапретитьИспользоватьВПроводках
                   |				И ТиповойОбороты.СчетКт.ЗапретитьИспользоватьВПроводках
                   |			ТОГДА ""Проводка""
                   |		КОГДА ТиповойОбороты.СчетДт.ЗапретитьИспользоватьВПроводках
                   |			ТОГДА ТиповойОбороты.СчетДт
                   |		ИНАЧЕ ТиповойОбороты.СчетКт
                   |	КОНЕЦ КАК ЗапретныйСчет
                   |ИЗ
                   |	РегистрБухгалтерии.Типовой.ОборотыДтКт(
                   |			&ДатаНач,
                   |			&ДатаКон,
                   |			Регистратор,
                   |			,
                   |			,
                   |			,
                   |			,
                   |			Организация = &Организация
                   |				И СтруктурноеПодразделениеДт = &СтруктурноеПодразделениеДт
                   |				И СтруктурноеПодразделениеКт = &СтруктурноеПодразделениеКт) КАК ТиповойОбороты
                   |ГДЕ
                   |	(ТиповойОбороты.СчетДт.ЗапретитьИспользоватьВПроводках
                   |			ИЛИ ТиповойОбороты.СчетКт.ЗапретитьИспользоватьВПроводках)";   
    			   
    Запрос.УстановитьПараметр("ДатаНач"					  , ПараметрыОтчета.ДатаНач);
    Запрос.УстановитьПараметр("ДатаКон"					  , КонецДня(ПараметрыОтчета.ДатаКон));
    Запрос.УстановитьПараметр("Организация"				  , ПараметрыОтчета.Организация);
    Запрос.УстановитьПараметр("СтруктурноеПодразделениеДт", ПараметрыОтчета.СтруктурноеПодразделение);
    Запрос.УстановитьПараметр("СтруктурноеПодразделениеКт", ПараметрыОтчета.СтруктурноеПодразделение);
    
    Результат = Запрос.Выполнить();

    СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
    СтрокаПравила.ПроверкаВыполнена = Истина;
    
    ТаблицаОшибок = Новый ТаблицаЗначений;
    ТаблицаОшибок.Колонки.Добавить("Регистратор");
    ТаблицаОшибок.Колонки.Добавить("СчетДт");
    ТаблицаОшибок.Колонки.Добавить("СчетКт");
    ТаблицаОшибок.Колонки.Добавить("Сумма");
    ТаблицаОшибок.Колонки.Добавить("ЗапретныйСчет");
        
    Если СтрокаПравила.ОбнаруженыОшибки Тогда
    	Выборка = Результат.Выбрать();
    	Пока Выборка.Следующий() Цикл
    		СтрокаОшибки = ТаблицаОшибок.Добавить();
    		ЗаполнитьЗначенияСвойств(СтрокаОшибки, Выборка);
    		Если Выборка.ЗапретныйСчет = "Проводка" Тогда
    			СтрокаОшибки.ЗапретныйСчет = "" + Выборка.СчетДт + ", " + Выборка.СчетКт;
    		КонецЕсли;  			
    	КонецЦикла;
    	
    	ПараметрыОтчета.ИсходящиеДанные.Вставить("КорректностьПроводкиТаблицаЗначений", ТаблицаОшибок);		
    	СтруктураЗаголовков = Новый Структура;
    	СтруктураЗаголовков.Вставить("Регистратор", "Документ");
    	СтруктураЗаголовков.Вставить("СчетДт",       "Счет Дт");
    	СтруктураЗаголовков.Вставить("СчетКт",      "Счет Кт");
    	СтруктураЗаголовков.Вставить("Сумма",   "Сумма проводки");
    	СтруктураЗаголовков.Вставить("ЗапретныйСчет", "Счет, который запрещено использовать в проводках");
    	ПараметрыОтчета.ИсходящиеДанные.Вставить("КорректностьПроводкиСтруктураЗаголовков", СтруктураЗаголовков);
    	
    	
    	СтруктураШириныКолонок = Новый Структура;
    	СтруктураШириныКолонок.Вставить("Регистратор" ,    60);
    	СтруктураШириныКолонок.Вставить("СчетДт"      ,    30);
    	СтруктураШириныКолонок.Вставить("СчетКт"      ,    30);
    	СтруктураШириныКолонок.Вставить("Сумма"       ,    30);
    	СтруктураШириныКолонок.Вставить("ЗапретныйСчет"  , 40);
    	ПараметрыОтчета.ИсходящиеДанные.Вставить("КорректностьПроводкиСтруктураШириныКолонок", СтруктураШириныКолонок);
    	
    	СтруктураРасшифровки = Новый Структура;
    	СтруктураРасшифровки.Вставить("Регистратор", "Регистратор");
    	ПараметрыОтчета.ИсходящиеДанные.Вставить("КорректностьПроводкиСтруктураРасшифровки", СтруктураРасшифровки);

   КонецЕсли;
	
КонецПроцедуры // ПроверитьПравилоКорректностьПроводки()

//ОС и НМА

Процедура ПроверитьПравилоПринятиеКУчетуОС(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
		
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СостоянияОСОрганизаций.ОсновноеСредство КАК ОсновноеСредство,
	               |	МАКСИМУМ(СостоянияОСОрганизаций.ДатаСостояния) КАК ДатаСостояния
	               |ПОМЕСТИТЬ ТекДатаСостояния
	               |ИЗ
	               |	РегистрСведений.СостоянияОСОрганизаций КАК СостоянияОСОрганизаций
	               |ГДЕ
	               |	СостоянияОСОрганизаций.ДатаСостояния <= &ДатаКон
	               |	И СостоянияОСОрганизаций.Организация = &Организация
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	СостоянияОСОрганизаций.ОсновноеСредство
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	ОсновноеСредство,
	               |	ДатаСостояния
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СостоянияОСОрганизаций.ОсновноеСредство КАК ОсновноеСредство,
	               |	ТекДатаСостояния.ДатаСостояния КАК ДатаСостояния,
	               |	МАКСИМУМ(СостоянияОСОрганизаций.Регистратор) КАК Регистратор
	               |ПОМЕСТИТЬ ТекРегистратор
	               |ИЗ
	               |	РегистрСведений.СостоянияОСОрганизаций КАК СостоянияОСОрганизаций
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТекДатаСостояния КАК ТекДатаСостояния
	               |		ПО СостоянияОСОрганизаций.ОсновноеСредство = ТекДатаСостояния.ОсновноеСредство
	               |			И СостоянияОСОрганизаций.ДатаСостояния = ТекДатаСостояния.ДатаСостояния
	               |ГДЕ
	               |	СостоянияОСОрганизаций.Организация = &Организация
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	СостоянияОСОрганизаций.ОсновноеСредство,
	               |	ТекДатаСостояния.ДатаСостояния
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	ОсновноеСредство,
	               |	ДатаСостояния
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СостояниеОС.ОсновноеСредство КАК ОсновноеСредство,
	               |	СостояниеОС.Состояние КАК Состояние,
	               |	ТекРегистратор.ДатаСостояния КАК ДатаСостояния,
	               |	ТекРегистратор.Регистратор КАК Регистратор
	               |ПОМЕСТИТЬ ТекущееСостояние
	               |ИЗ
	               |	РегистрСведений.СостоянияОСОрганизаций КАК СостояниеОС
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТекРегистратор КАК ТекРегистратор
	               |		ПО СостояниеОС.ОсновноеСредство = ТекРегистратор.ОсновноеСредство
	               |			И СостояниеОС.Регистратор = ТекРегистратор.Регистратор
	               |			И СостояниеОС.ДатаСостояния = ТекРегистратор.ДатаСостояния
	               |ГДЕ
	               |	СостояниеОС.Организация = &Организация
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	ОсновноеСредство
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ТиповойОстатки.Субконто1 КАК ОС,
	               |	ТиповойОстатки.СуммаОстатокДт КАК СтоимостьБУ,
	               |	ВЫБОР
	               |		КОГДА ТекущееСостояние.Состояние ЕСТЬ NULL 
	               |			ТОГДА ""Не определено""
	               |		ИНАЧЕ ТекущееСостояние.Состояние
	               |	КОНЕЦ КАК Состояние,
	               |	ТекущееСостояние.Регистратор
	               |ИЗ
	               |	РегистрБухгалтерии.Типовой.Остатки(&КонГраница, Счет В ИЕРАРХИИ (&СчетаУчетаОС), &ВидСубконто, Организация = &Организация) КАК ТиповойОстатки
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ТекущееСостояние КАК ТекущееСостояние
	               |		ПО ТиповойОстатки.Субконто1 = ТекущееСостояние.ОсновноеСредство
	               |ГДЕ
	               |	ВЫБОР
	               |			КОГДА ТиповойОстатки.СуммаОстатокДт <> 0
	               |					И ЕСТЬNULL(ТекущееСостояние.Состояние, """") <> ЗНАЧЕНИЕ(Перечисление.ВидыСостоянийОС.ПринятоКУчету)
	               |				ТОГДА ИСТИНА
	               |			ИНАЧЕ ЛОЖЬ
	               |		КОНЕЦ
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	ОС";

	Запрос.УстановитьПараметр("Организация", ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("ДатаКон"	   , КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("КонГраница" , Новый Граница(КонецДня(ПараметрыОтчета.ДатаКон), ВидГраницы.Включая));
		
	СчетаУчетаОС = Новый СписокЗначений;
	СчетаУчетаОС.Добавить(ПланыСчетов.Типовой.ОсновныеСредства);
	СчетаУчетаОС.Добавить(ПланыСчетов.Типовой.ИнвестицииВНедвижимость);
	СчетаУчетаОС.Добавить(ПланыСчетов.Типовой.АрендованныеОсновныеСредства);
	
	Запрос.УстановитьПараметр("ВидСубконто", ПланыВидовХарактеристик.ВидыСубконтоТиповые.ОсновныеСредства);
	Запрос.УстановитьПараметр("СчетаУчетаОС", СчетаУчетаОС);
	
	Результат = Запрос.Выполнить();
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
		
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПринятиеКУчетуОСРезультатЗапроса", Результат);		
		
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("ОС", 			"Основное средство");
		СтруктураЗаголовков.Вставить("СтоимостьБУ", "Стоимость");
		СтруктураЗаголовков.Вставить("Состояние",   "Текущее состояние");
		СтруктураЗаголовков.Вставить("Регистратор", "Регистратор состояния");
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПринятиеКУчетуОССтруктураЗаголовков", СтруктураЗаголовков);
		
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("ОС", 		 "ОС");
		СтруктураРасшифровки.Вставить("СтоимостьБУ", "ОС");
		СтруктураРасшифровки.Вставить("Состояние", 	 "Регистратор");
		СтруктураРасшифровки.Вставить("Регистратор", "Регистратор");
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("ПринятиеКУчетуОССтруктураРасшифровки", СтруктураРасшифровки);

	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоСнятиеСУчетаОС(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
		
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СостоянияОСОрганизаций.ОсновноеСредство КАК ОсновноеСредство,
	               |	МАКСИМУМ(СостоянияОСОрганизаций.ДатаСостояния) КАК ДатаСостояния
	               |ПОМЕСТИТЬ ТекДатаСостояния
	               |ИЗ
	               |	РегистрСведений.СостоянияОСОрганизаций КАК СостоянияОСОрганизаций
	               |ГДЕ
	               |	СостоянияОСОрганизаций.ДатаСостояния <= &ДатаКон
	               |	И СостоянияОСОрганизаций.Организация = &Организация
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	СостоянияОСОрганизаций.ОсновноеСредство
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	ОсновноеСредство,
	               |	ДатаСостояния
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СостоянияОСОрганизаций.ОсновноеСредство КАК ОсновноеСредство,
	               |	ТекДатаСостояния.ДатаСостояния КАК ДатаСостояния,
	               |	МАКСИМУМ(СостоянияОСОрганизаций.Регистратор) КАК Регистратор
	               |ПОМЕСТИТЬ ТекРегистратор
	               |ИЗ
	               |	РегистрСведений.СостоянияОСОрганизаций КАК СостоянияОСОрганизаций
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТекДатаСостояния КАК ТекДатаСостояния
	               |		ПО СостоянияОСОрганизаций.ОсновноеСредство = ТекДатаСостояния.ОсновноеСредство
	               |			И СостоянияОСОрганизаций.ДатаСостояния = ТекДатаСостояния.ДатаСостояния
	               |ГДЕ
	               |	СостоянияОСОрганизаций.Организация = &Организация
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	СостоянияОСОрганизаций.ОсновноеСредство,
	               |	ТекДатаСостояния.ДатаСостояния
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	ОсновноеСредство,
	               |	ДатаСостояния
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СостояниеОС.ОсновноеСредство КАК ОсновноеСредство,
	               |	СостояниеОС.Состояние КАК Состояние,
	               |	ТекРегистратор.ДатаСостояния КАК ДатаСостояния,
	               |	ТекРегистратор.Регистратор КАК Регистратор
	               |ПОМЕСТИТЬ ТекущееСостояние
	               |ИЗ
	               |	РегистрСведений.СостоянияОСОрганизаций КАК СостояниеОС
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТекРегистратор КАК ТекРегистратор
	               |		ПО СостояниеОС.ОсновноеСредство = ТекРегистратор.ОсновноеСредство
	               |			И СостояниеОС.Регистратор = ТекРегистратор.Регистратор
	               |			И СостояниеОС.ДатаСостояния = ТекРегистратор.ДатаСостояния
	               |ГДЕ
	               |	СостояниеОС.Организация = &Организация
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	ОсновноеСредство
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ТекущееСостояние.ОсновноеСредство КАК ОС,
	               |	ТекущееСостояние.Состояние,
	               |	ТекущееСостояние.Регистратор
	               |ИЗ
	               |	ТекущееСостояние КАК ТекущееСостояние
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Типовой.Остатки(&КонГраница, Счет В ИЕРАРХИИ (&СчетаУчетаОС), &ВидСубконто, Организация = &Организация) КАК ТиповойОстатки
	               |		ПО ТекущееСостояние.ОсновноеСредство = ТиповойОстатки.Субконто1
	               |ГДЕ
	               |	ВЫБОР
	               |			КОГДА ТекущееСостояние.Состояние <> ЗНАЧЕНИЕ(Перечисление.ВидыСостоянийОС.СнятоСУчета)
	               |					И ТекущееСостояние.Состояние <> ЗНАЧЕНИЕ(Перечисление.ВидыСостоянийОС.Поступило)
	               |					И ЕСТЬNULL(ТиповойОстатки.СуммаОстатокДт, 0) = 0
	               |				ТОГДА ИСТИНА
	               |			ИНАЧЕ ЛОЖЬ
	               |		КОНЕЦ
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	ОС";

	Запрос.УстановитьПараметр("Организация", ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("ДатаКон"	   , КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("КонГраница" , Новый Граница(КонецДня(ПараметрыОтчета.ДатаКон), ВидГраницы.Включая));
		
	СчетаУчетаОС = Новый СписокЗначений;
	СчетаУчетаОС.Добавить(ПланыСчетов.Типовой.ОсновныеСредства);
	СчетаУчетаОС.Добавить(ПланыСчетов.Типовой.ИнвестицииВНедвижимость);
	СчетаУчетаОС.Добавить(ПланыСчетов.Типовой.АрендованныеОсновныеСредства);
	
	Запрос.УстановитьПараметр("ВидСубконто", ПланыВидовХарактеристик.ВидыСубконтоТиповые.ОсновныеСредства);
	Запрос.УстановитьПараметр("СчетаУчетаОС", СчетаУчетаОС);
	
	Результат = Запрос.Выполнить();
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;

	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("СнятиеСУчетаОСРезультатЗапроса", Результат);		
		
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("ОС",			"Основное средство");
		СтруктураЗаголовков.Вставить("Состояние",   "Текущее состояние");
		СтруктураЗаголовков.Вставить("Регистратор", "Регистратор состояния");
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("СнятиеСУчетаОССтруктураЗаголовков", СтруктураЗаголовков);
		
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("ОС",			"ОС");
		СтруктураРасшифровки.Вставить("Состояние", 	"Регистратор");
		СтруктураРасшифровки.Вставить("Регистратор","Регистратор");
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("СнятиеСУчетаОССтруктураРасшифровки", СтруктураРасшифровки);

	КонецЕсли; 
	
КонецПроцедуры

Процедура ПроверитьПравилоСоответствиеМестонахожденияНаСчетахИРегистрах(СтрокаПравила, ПараметрыОтчета)
	
	ВедетсяАналитУчетОсПоПодразделениям = УправлениеВнеоборотнымиАктивамиСервер.ВедетсяАналитическийУчетОСПоПодразделениям(ПараметрыОтчета.ДатаКон);
	ВедетсяАналитУчетОсПоМОЛ = УправлениеВнеоборотнымиАктивамиСервер.ВедетсяАналитическийУчетОСПоМОЛ(ПараметрыОтчета.ДатаКон);
	
	Если Не (ВедетсяАналитУчетОсПоМОЛ Или ВедетсяАналитУчетОсПоПодразделениям) Тогда
		СтрокаПравила.ОбнаруженыОшибки  = Ложь;
		СтрокаПравила.ПроверкаВыполнена = Истина;
		Возврат;
	КонецЕсли;	
		
	Запрос = Новый Запрос;
		
	Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	               |	СостоянияОСОрганизацииСрезПоследних.ОсновноеСредство КАК ОсновноеСредство
	               |ПОМЕСТИТЬ ВТ_ОС_СнятыеСУчета
	               |ИЗ
	               |	РегистрСведений.СостоянияОСОрганизаций КАК СостоянияОСОрганизацииСрезПоследних
	               |ГДЕ
	               |	СостоянияОСОрганизацииСрезПоследних.ДатаСостояния < &Дата
	               |	И СостоянияОСОрганизацииСрезПоследних.Организация = &Организация
	               |	И СостоянияОСОрганизацииСрезПоследних.Состояние = ЗНАЧЕНИЕ(Перечисление.ВидыСостоянийОС.СнятоСУчета)
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	ОсновноеСредство
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	ПервоначальныеСведенияОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство КАК ОС,
	               |	СчетаУчетаОССрезПоследних.СчетУчетаБУ,
	               |	СчетаУчетаОССрезПоследних.СчетНачисленияАмортизацииБУ,
	               |	ВЫБОР
	               |		КОГДА ОС_СнятыеСУчета.ОсновноеСредство ЕСТЬ NULL 
	               |			ТОГДА ЛОЖЬ
	               |		ИНАЧЕ ИСТИНА
	               |	КОНЕЦ КАК СнятоСУчета
	               |ПОМЕСТИТЬ СписокОС
	               |ИЗ
	               |	РегистрСведений.ПервоначальныеСведенияОСБухгалтерскийУчет.СрезПоследних(&Дата, Организация = &Организация) КАК ПервоначальныеСведенияОСБухгалтерскийУчетСрезПоследних
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СчетаУчетаОС.СрезПоследних КАК СчетаУчетаОССрезПоследних
	               |		ПО ПервоначальныеСведенияОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство = СчетаУчетаОССрезПоследних.ОсновноеСредство
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОС_СнятыеСУчета КАК ОС_СнятыеСУчета
	               |		ПО ПервоначальныеСведенияОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство = ОС_СнятыеСУчета.ОсновноеСредство
	               |
	               |ИНДЕКСИРОВАТЬ ПО
	               |	ОС
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СписокОС.ОС КАК ОС,
	               |	СписокОС.СчетУчетаБУ КАК СчетУчетаБУ,
				   |	ТиповойОстатки.Субконто2 " + ?(ВедетсяАналитУчетОсПоПодразделениям, " КАК ПодразделениеСтоимость ", " КАК МОЛСтоимость ") + 
	               ?(ВедетсяАналитУчетОсПоПодразделениям И ВедетсяАналитУчетОсПоМОЛ, ",
				   |	ТиповойОстатки.Субконто3 КАК МОЛСтоимость ", "") + "
	               |ПОМЕСТИТЬ ОстаткиСтоимостьБУ
	               |ИЗ
	               |	СписокОС КАК СписокОС
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Типовой.Остатки(&КонГраница, , &ВидыСубконто, Организация = &Организация) КАК ТиповойОстатки
	               |		ПО СписокОС.ОС = ТиповойОстатки.Субконто1
	               |			И СписокОС.СчетУчетаБУ = ТиповойОстатки.Счет
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СписокОС.ОС,
	               |	СписокОС.СчетНачисленияАмортизацииБУ КАК СчетНачисленияАмортизацииБУ,
				   |	ТиповойОстатки.Субконто2 " + ?(ВедетсяАналитУчетОсПоПодразделениям, " КАК ПодразделениеАмортизация ", " КАК МОЛАмортизация ") + 
	               ?(ВедетсяАналитУчетОсПоПодразделениям И ВедетсяАналитУчетОсПоМОЛ, ",
				   |	ТиповойОстатки.Субконто3 КАК МОЛАмортизация ", "") + "
				   |ПОМЕСТИТЬ ОстаткиАмортизацияБУ
	               |ИЗ
	               |	СписокОС КАК СписокОС
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрБухгалтерии.Типовой.Остатки(&КонГраница, , &ВидыСубконто, Организация = &Организация) КАК ТиповойОстатки
	               |		ПО СписокОС.ОС = ТиповойОстатки.Субконто1
	               |			И СписокОС.СчетНачисленияАмортизацииБУ = ТиповойОстатки.Счет
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
	               |	СписокОС.ОС КАК ОС,
	               |	ОстаткиСтоимостьБУ.СчетУчетаБУ КАК СчетУчетаБУ, 
				   |	ОстаткиАмортизацияБУ.СчетНачисленияАмортизацииБУ КАК СчетНачисленияАмортизацииБУ " + 
	               ?(ВедетсяАналитУчетОсПоПодразделениям, ",
				   |	ОстаткиСтоимостьБУ.ПодразделениеСтоимость КАК ПодразделениеСтоимость,
				   |	ОстаткиАмортизацияБУ.ПодразделениеАмортизация КАК ПодразделениеАмортизация,
				   |	МестонахождениеОС.Местонахождение КАК ПодразделениеМестонахождение ", "") + 
				   ?(ВедетсяАналитУчетОсПоМОЛ, ",
	               |	ОстаткиСтоимостьБУ.МОЛСтоимость КАК МОЛСтоимость,
	               |	ОстаткиАмортизацияБУ.МОЛАмортизация КАК МОЛАмортизация,
				   |	МестонахождениеОС.МОЛ КАК МОЛМестонахождение ", "") + "
	               |ИЗ
	               |	СписокОС КАК СписокОС
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиСтоимостьБУ КАК ОстаткиСтоимостьБУ
	               |		ПО СписокОС.ОС = ОстаткиСтоимостьБУ.ОС
	               |		ЛЕВОЕ СОЕДИНЕНИЕ ОстаткиАмортизацияБУ КАК ОстаткиАмортизацияБУ
	               |		ПО СписокОС.ОС = ОстаткиАмортизацияБУ.ОС
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МестонахождениеОСБухгалтерскийУчет.СрезПоследних(&Дата, Организация = &Организация) КАК МестонахождениеОС
	               |		ПО СписокОС.ОС = МестонахождениеОС.ОсновноеСредство
	               |ГДЕ
	               |	СписокОС.СнятоСУчета = ЛОЖЬ И " + 
				   ?(ВедетсяАналитУчетОсПоПодразделениям, "
				   |	(ОстаткиСтоимостьБУ.ПодразделениеСтоимость <> МестонахождениеОС.Местонахождение
	               |			ИЛИ ОстаткиАмортизацияБУ.ПодразделениеАмортизация <> МестонахождениеОС.Местонахождение", "") +
				   ?(ВедетсяАналитУчетОсПоПодразделениям И Не ВедетсяАналитУчетОсПоМОЛ, " ) ", "") + 
				   ?(ВедетсяАналитУчетОсПоПодразделениям И ВедетсяАналитУчетОсПоМОЛ, " ИЛИ ", "") + 
				   ?(Не ВедетсяАналитУчетОсПоПодразделениям И ВедетсяАналитУчетОсПоМОЛ, " ( ", "") + 
				   ?(ВедетсяАналитУчетОсПоМОЛ, "
	               |	ОстаткиСтоимостьБУ.МОЛСтоимость <> МестонахождениеОС.МОЛ
	               |			ИЛИ ОстаткиАмортизацияБУ.МОЛАмортизация <> МестонахождениеОС.МОЛ)", "");
				   
	Запрос.УстановитьПараметр("Организация", ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("Дата"	   , КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("КонГраница" , Новый Граница(КонецДня(ПараметрыОтчета.ДатаКон), ВидГраницы.Включая));
	 
	МассивВидыСубконто = Новый Массив;
	МассивВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.ОсновныеСредства);
	Если ВедетсяАналитУчетОсПоПодразделениям Тогда
		МассивВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.Подразделения);
	КонецЕсли;
	
	Если ВедетсяАналитУчетОсПоМОЛ Тогда
		МассивВидыСубконто.Добавить(ПланыВидовХарактеристик.ВидыСубконтоТиповые.РаботникиОрганизаций);
	КонецЕсли;	
	
	Запрос.УстановитьПараметр("ВидыСубконто", МассивВидыСубконто);
		
	Результат = Запрос.Выполнить();
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;

	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("СоответствиеМестонахожденияНаСчетахИРегистрахРезультатЗапроса", Результат);		
		
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("ОС",							 "Основное средство");
		СтруктураЗаголовков.Вставить("СчетУчетаБУ",					 "Счет учета ОС");
		СтруктураЗаголовков.Вставить("ПодразделениеСтоимость",		 "Подразделение (стоим.)");
		СтруктураЗаголовков.Вставить("МОЛСтоимость",				 "МОЛ (стоим.)");
		СтруктураЗаголовков.Вставить("СчетНачисленияАмортизацииБУ",	 "Счет начисл. амортизации");
		СтруктураЗаголовков.Вставить("ПодразделениеАмортизация",	 "Подразделение (амортиз.)");
		СтруктураЗаголовков.Вставить("МОЛАмортизация",				 "МОЛ (амортиз.)");
		СтруктураЗаголовков.Вставить("ПодразделениеМестонахождение", "Подразделение (рег. свед.)");
		СтруктураЗаголовков.Вставить("МОЛМестонахождение",			 "МОЛ (рег. свед.)");
	                             	    
		ПараметрыОтчета.ИсходящиеДанные.Вставить("СоответствиеМестонахожденияНаСчетахИРегистрахСтруктураЗаголовков", СтруктураЗаголовков);
		
		СтруктураРасшифровки = Новый Структура;
		СтруктураРасшифровки.Вставить("ОС",							 "ОС");
		СтруктураРасшифровки.Вставить("СчетУчетаБУ",				 "СчетУчетаБУ");
		СтруктураРасшифровки.Вставить("ПодразделениеСтоимость",		 "ПодразделениеСтоимость");
		СтруктураРасшифровки.Вставить("МОЛСтоимость",				 "МОЛСтоимость");
		СтруктураРасшифровки.Вставить("СчетНачисленияАмортизацииБУ", "СчетНачисленияАмортизацииБУ");
		СтруктураРасшифровки.Вставить("ПодразделениеАмортизация",	 "ПодразделениеАмортизация)");
		СтруктураРасшифровки.Вставить("МОЛАмортизация",				 "МОЛАмортизация");
		СтруктураРасшифровки.Вставить("ПодразделениеМестонахождение","ПодразделениеМестонахождение");
		СтруктураРасшифровки.Вставить("МОЛМестонахождение",			 "МОЛМестонахождение");
	    
		ПараметрыОтчета.ИсходящиеДанные.Вставить("СоответствиеМестонахожденияНаСчетахИРегистрахСтруктураРасшифровки", СтруктураРасшифровки);
		
	КонецЕсли; 
	
КонецПроцедуры

//Взаиморасчеты с контрагентами

Процедура ПроверитьПравилоАктыВыполненныхРабот(СтрокаПравила, ПараметрыОтчета)
	
	Запрос = Новый Запрос;
		
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	РеализацияТоваровУслуг.Ссылка КАК Документ,
	|	РеализацияТоваровУслуг.Дата КАК Дата,
	|	РеализацияТоваровУслуг.ДатаПодписанияГЗ КАК ДатаПодписанияГЗ,
	|	ЭлектронныйАктВыполненныхРабот.Ссылка КАК ЭАВР,
	|	ЭлектронныйАктВыполненныхРабот.ДатаПодписиПолучателя КАК ДатаПодписиЭАВР
	|ИЗ
	|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭлектронныйАктВыполненныхРабот КАК ЭлектронныйАктВыполненныхРабот
	|		ПО РеализацияТоваровУслуг.Ссылка = ЭлектронныйАктВыполненныхРабот.ДокументОснование
	|ГДЕ
	|	РеализацияТоваровУслуг.ПометкаУдаления = ЛОЖЬ
	|	И РеализацияТоваровУслуг.Дата МЕЖДУ &ДатаНач И &ДатаКон
	|	И РеализацияТоваровУслуг.СпособВыпискиАктовВыполненныхРабот = &НаПорталеИСЭСФ
	|	И РеализацияТоваровУслуг.Организация = &Организация
	|	И НАЧАЛОПЕРИОДА(РеализацияТоваровУслуг.ДатаПодписанияГЗ, ДЕНЬ) <> НАЧАЛОПЕРИОДА(ЭлектронныйАктВыполненныхРабот.ДатаПодписиПолучателя, ДЕНЬ)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	АктОбОказанииПроизводственныхУслуг.Ссылка,
	|	АктОбОказанииПроизводственныхУслуг.Дата,
	|	АктОбОказанииПроизводственныхУслуг.ДатаПодписанияГЗ,
	|	ЭлектронныйАктВыполненныхРабот.Ссылка,
	|	ЭлектронныйАктВыполненныхРабот.ДатаПодписиПолучателя
	|ИЗ
	|	Документ.АктОбОказанииПроизводственныхУслуг КАК АктОбОказанииПроизводственныхУслуг
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭлектронныйАктВыполненныхРабот КАК ЭлектронныйАктВыполненныхРабот
	|		ПО АктОбОказанииПроизводственныхУслуг.Ссылка = ЭлектронныйАктВыполненныхРабот.ДокументОснование
	|ГДЕ
	|	АктОбОказанииПроизводственныхУслуг.ПометкаУдаления = ЛОЖЬ
	|	И АктОбОказанииПроизводственныхУслуг.Дата МЕЖДУ &ДатаНач И &ДатаКон
	|	И АктОбОказанииПроизводственныхУслуг.СпособВыпискиАктовВыполненныхРабот = &НаПорталеИСЭСФ
	|	И АктОбОказанииПроизводственныхУслуг.Организация = &Организация
	|	И НАЧАЛОПЕРИОДА(АктОбОказанииПроизводственныхУслуг.ДатаПодписанияГЗ, ДЕНЬ) <> НАЧАЛОПЕРИОДА(ЭлектронныйАктВыполненныхРабот.ДатаПодписиПолучателя, ДЕНЬ)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	РеализацияУслугПоПереработке.Ссылка,
	|	РеализацияУслугПоПереработке.Дата,
	|	РеализацияУслугПоПереработке.ДатаПодписанияГЗ,
	|	ЭлектронныйАктВыполненныхРабот.Ссылка,
	|	ЭлектронныйАктВыполненныхРабот.ДатаПодписиПолучателя
	|ИЗ
	|	Документ.РеализацияУслугПоПереработке КАК РеализацияУслугПоПереработке
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЭлектронныйАктВыполненныхРабот КАК ЭлектронныйАктВыполненныхРабот
	|		ПО РеализацияУслугПоПереработке.Ссылка = ЭлектронныйАктВыполненныхРабот.ДокументОснование
	|ГДЕ
	|	РеализацияУслугПоПереработке.ПометкаУдаления = ЛОЖЬ
	|	И РеализацияУслугПоПереработке.Дата МЕЖДУ &ДатаНач И &ДатаКон
	|	И РеализацияУслугПоПереработке.СпособВыпискиАктовВыполненныхРабот = &НаПорталеИСЭСФ
	|	И РеализацияУслугПоПереработке.Организация = &Организация
	|	И НАЧАЛОПЕРИОДА(РеализацияУслугПоПереработке.ДатаПодписанияГЗ, ДЕНЬ) <> НАЧАЛОПЕРИОДА(ЭлектронныйАктВыполненныхРабот.ДатаПодписиПолучателя, ДЕНЬ)

	|
	|УПОРЯДОЧИТЬ ПО
	|	Дата,
	|	Документ
	|АВТОУПОРЯДОЧИВАНИЕ";
	
	
	Запрос.УстановитьПараметр("ДатаНач", 				  ПараметрыОтчета.ДатаНач);
	Запрос.УстановитьПараметр("ДатаКон", 				  КонецДня(ПараметрыОтчета.ДатаКон));
	Запрос.УстановитьПараметр("Организация", 			  ПараметрыОтчета.Организация);
	Запрос.УстановитьПараметр("СтатусЭАВР", 			  Перечисления.СтатусыАВР.Подтвержденный);
	Запрос.УстановитьПараметр("НаПорталеИСЭСФ", 		  Перечисления.СпособыВыпискиАктовВыполненныхРабот.НаПорталеИСЭСФ);

	//Запрос.УстановитьПараметр("СтруктурноеПодразделение", ПараметрыОтчета.СтруктурноеПодразделение);
	
	Результат = Запрос.Выполнить();
	
	СтрокаПравила.ОбнаруженыОшибки  = НЕ Результат.Пустой();
	СтрокаПравила.ПроверкаВыполнена = Истина;
	
	Если СтрокаПравила.ОбнаруженыОшибки Тогда
		ПараметрыОтчета.ИсходящиеДанные.Вставить("АктыВыполненныхРаботРезультатЗапроса", Результат);
		СтруктураЗаголовков = Новый Структура;
		СтруктураЗаголовков.Вставить("ДатаПодписанияГЗ", "Дата подписания");
	 		СтруктураЗаголовков.Вставить("ДатаПодписиЭАВР", "Дата подписания ЭАВР");
		
		//СтруктураЗаголовков.Вставить("СуммаДокумента", "Сумма документа");
		ПараметрыОтчета.ИсходящиеДанные.Вставить("АктыВыполненныхРаботСтруктураЗаголовков", СтруктураЗаголовков);
		СтруктураШириныКолонок = Новый Структура;
		СтруктураШириныКолонок.Вставить("Документ" , 50);
		СтруктураШириныКолонок.Вставить("ЭАВР" , 50);

		СтруктураШириныКолонок.Вставить("ДатаПодписанияГЗ" , 25);
		СтруктураШириныКолонок.Вставить("ДатаПодписиЭАВР" , 25);

		СтруктураШириныКолонок.Вставить("Дата", 20);
		СтруктураШириныКолонок.Вставить("Номер"  , 25);
		
		ПараметрыОтчета.ИсходящиеДанные.Вставить("АктыВыполненныхРаботСтруктураШириныКолонок", СтруктураШириныКолонок);
	   	СтруктураРасшифровки = Новый Структура;
	   	СтруктураРасшифровки.Вставить("Документ", "Документ");
		СтруктураРасшифровки.Вставить("ЭАВР", "ЭАВР");

    	ПараметрыОтчета.ИсходящиеДанные.Вставить("АктыВыполненныхРаботСтруктураРасшифровки", СтруктураРасшифровки);
	КонецЕсли; 
	
КонецПроцедуры

// Процедура-оболочка, вызывающая другие процедуры на выполнение или выполняющая текст алгоритма
Процедура ПроверитьПравило(СтрокаПравила, ПараметрыОтчета)
	
	СтрокаПравила.КомментарийРезультата   = "";
	СтрокаПравила.ПричиныОшибокРезультата = "";
	СтрокаПравила.РекомендацииРезультата  = "";
	
	РежимОтладки = СтрокаПравила.РежимОтладки ИЛИ ПустаяСтрока(СтрокаПравила.ТекстАлгоритма);
	
	Если РежимОтладки Тогда
		Попытка
			Выполнить("ПроверитьПравило"+СтрокаПравила.Идентификатор+"(СтрокаПравила, ПараметрыОтчета)");
		Исключение
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru='Ошибка при попытке выполнения процедуры %1 %2'"),
				"ПроверитьПравило",
				СтрокаПравила.Идентификатор);
			ОбщегоНазначения.СообщитьПользователю(ТекстСообщения);
			
			СтрокаПравила.ПроверкаВыполнена = Ложь;
			СтрокаПравила.ОбнаруженыОшибки = Ложь;
		КонецПопытки;
	Иначе
		Попытка
			Выполнить(СтрокаПравила.ТекстАлгоритма);
		Исключение
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru=Ошибка при попытке выполнения алгоритма правила %1'"),
				СтрокаПравила.Идентификатор);
			ОбщегоНазначения.СообщитьПользователю(ТекстСообщения);

			СтрокаПравила.ПроверкаВыполнена = Ложь;
			СтрокаПравила.ОбнаруженыОшибки = Ложь;
		КонецПопытки;
	КонецЕсли;

	КомментарийЗаданВАлгоритме = НЕ ПустаяСтрока(СтрокаПравила.КомментарийРезультата);
	Если НЕ КомментарийЗаданВАлгоритме Тогда
		Если СтрокаПравила.ОбнаруженыОшибки Тогда
			СтрокаПравила.КомментарийРезультата = СтрокаПравила.КомментарийРезультатаОшибка;
		ИначеЕсли СтрокаПравила.ПроверкаВыполнена Тогда
			СтрокаПравила.КомментарийРезультата = СтрокаПравила.КомментарийРезультатаНетОшибок;
		Иначе
			СтрокаПравила.КомментарийРезультата = СтрокаПравила.КомментарийРезультатаНеВыполнена;
		КонецЕсли;
	КонецЕсли;
	
	ПричиныОшибокЗаданыВАлгоритме = НЕ ПустаяСтрока(СтрокаПравила.ПричиныОшибокРезультата);
	Если НЕ ПричиныОшибокЗаданыВАлгоритме Тогда
		СтрокаПравила.ПричиныОшибокРезультата = СтрокаПравила.ПричиныОшибок;
	КонецЕсли;
	
	РекомендацииЗаданыВАлгоритме = НЕ ПустаяСтрока(СтрокаПравила.РекомендацииРезультата);
	Если НЕ РекомендацииЗаданыВАлгоритме Тогда
		СтрокаПравила.РекомендацииРезультата = СтрокаПравила.Рекомендации;
	КонецЕсли;
	
КонецПроцедуры
 
Функция ПолучитьНомерЧислом(НомерСтрокой)

	ЧисловаяЧастьНомера = "";
	ДлинаСтроки = СтрДлина(НомерСтрокой);
	Для Счетчик = 0 По ДлинаСтроки - 1 Цикл
		НомерСимвола = ДлинаСтроки - Счетчик;
		ТекСимвол = Сред(НомерСтрокой, НомерСимвола, 1);
		ЭтоЧисло = Найти("0123456789", ТекСимвол) > 0;
		Если ЭтоЧисло Тогда
			ЧисловаяЧастьНомера = ТекСимвол + ЧисловаяЧастьНомера;
		ИначеЕсли НЕ ПустаяСтрока(ЧисловаяЧастьНомера) Тогда
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	НомерЧислом = Число("0"+ЧисловаяЧастьНомера);
	Возврат НомерЧислом;

КонецФункции 

Процедура ЗаполнитьДеревоПроверокИзМакетаMXL(ДеревоПроверок) Экспорт
	
	ДеревоПроверок.Строки.Очистить();
	МакетПравил   = Обработки.ЭкспрессПроверкаВеденияУчета.ПолучитьМакет("НаборПравилПроверки");
	ОбластьПравил = МакетПравил.Область("Правила");
	
	НомПервойСтрокиПравил    = ОбластьПравил.Верх;
	НомПоследнейСтрокиПравил = ОбластьПравил.Низ;
	
	// На случай, когда строки проверок надо вставлять прямо в корень дерева
	СтрокаРаздела = ДеревоПроверок;
	
	Для НомСтроки = НомПервойСтрокиПравил По НомПоследнейСтрокиПравил Цикл
		ОбластьСтроки    = МакетПравил.Область(НомСтроки, , НомСтроки, );
		ИмяОбластиСтроки = ОбластьСтроки.Имя;
		// Правило идентифицируется по имени области - строки,
		// поэтому строки, для которых не задано имя области, пропускаем 
		ЕстьИмяУСтроки = НЕ (ИмяОбластиСтроки = "R"+Формат(НомСтроки, "ЧГ="));
		Если ЕстьИмяУСтроки Тогда
			// Разбираем строку таблицы
			// Правило это или группа правил
			Если МакетПравил.Область(ИмяОбластиСтроки + "|ЭтоГруппа").Текст = "1" Тогда
				ЭтоГруппа = Истина;
			Иначе
				ЭтоГруппа = Ложь;
			КонецЕсли;
			// Правила не-группы могут быть отключены в макете
			// Отключенные правила не выводим в дерево
			Если НЕ ЭтоГруппа Тогда
				Если МакетПравил.Область(ИмяОбластиСтроки + "|Отключено").Текст = "1" Тогда
					Отключено = Истина;
				Иначе
					Отключено = Ложь;
				КонецЕсли;
				Если Отключено Тогда
					Продолжить;
				КонецЕсли; 
			КонецЕсли;
			
			Наименование = МакетПравил.Область(ИмяОбластиСтроки + "|Наименование").Текст;
			
			ПредметКонтроля = МакетПравил.Область(ИмяОбластиСтроки + "|ПредметКонтроля").Текст;
			ФО              = МакетПравил.Область(ИмяОбластиСтроки + "|ФункциональнаяОпция").Текст;
			Если ЗначениеЗаполнено(ФО) Тогда
				ЗначениеФО 		= ПолучитьФункциональнуюОпцию(ФО);
			Иначе 
				ЗначениеФО      = Истина
			КонецЕсли;
					
			
			// Для групп больше ничего не нужно - добавляем новую строку раздела в дерево
			Если ЭтоГруппа Тогда
				
				Если Не ЗначениеФО Тогда
					Продолжить;
				КонецЕсли;      				
				
				СтрокаРаздела = ДеревоПроверок.Строки.Добавить();
				
				СтрокаРаздела.Идентификатор       = ИмяОбластиСтроки;
				СтрокаРаздела.Наименование        = Наименование;
				СтрокаРаздела.ЭтоГруппа           = Истина;
				СтрокаРаздела.ПредметКонтроля     = ПредметКонтроля;
				СтрокаРаздела.Включить 			  = Истина;

				Продолжить;
			КонецЕсли;
			
			// Для обычных проверок продолжаем разбор строки
			КомментарийРезультатаНетОшибок   = МакетПравил.Область(ИмяОбластиСтроки + "|КомментарийРезультатаНетОшибок").Текст;
			КомментарийРезультатаОшибка      = МакетПравил.Область(ИмяОбластиСтроки + "|КомментарийРезультатаОшибка").Текст;
			КомментарийРезультатаНеВыполнена = МакетПравил.Область(ИмяОбластиСтроки + "|КомментарийРезультатаНеВыполнена").Текст;
			ПричиныОшибок                    = МакетПравил.Область(ИмяОбластиСтроки + "|ПричиныОшибок").Текст;
			Рекомендации                     = МакетПравил.Область(ИмяОбластиСтроки + "|Рекомендации").Текст;
			ТекстАлгоритма                   = МакетПравил.Область(ИмяОбластиСтроки + "|ТекстАлгоритма").Текст;
			ФО                               = МакетПравил.Область(ИмяОбластиСтроки + "|ФункциональнаяОпция").Текст;
			Если МакетПравил.Область(ИмяОбластиСтроки + "|РежимОтладки").Текст = "1" Тогда
				РежимОтладки = Истина;
			Иначе
				РежимОтладки = Ложь;
			КонецЕсли;
			
			Если Не ЗначениеФО Тогда
				Продолжить;
			КонецЕсли;
			

			// Добавляем новую строку проверки
			СтрокаПроверки = СтрокаРаздела.Строки.Добавить();
			
			СтрокаПроверки.Идентификатор                    = ИмяОбластиСтроки;
			СтрокаПроверки.Наименование                     = Наименование;
			СтрокаПроверки.ЭтоГруппа                        = Ложь;
			СтрокаПроверки.ПредметКонтроля                  = ПредметКонтроля;
			СтрокаПроверки.КомментарийРезультатаНетОшибок   = КомментарийРезультатаНетОшибок;
			СтрокаПроверки.КомментарийРезультатаОшибка      = КомментарийРезультатаОшибка;
			СтрокаПроверки.КомментарийРезультатаНеВыполнена = КомментарийРезультатаНеВыполнена;
			СтрокаПроверки.ПричиныОшибок                    = ПричиныОшибок;
			СтрокаПроверки.Рекомендации                     = Рекомендации;
			СтрокаПроверки.ТекстАлгоритма                   = ТекстАлгоритма;
			СтрокаПроверки.РежимОтладки                     = РежимОтладки;
			СтрокаПроверки.Включить							= Истина;
			
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

#КонецЕсли